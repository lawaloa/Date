<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lawal’s note">
<meta name="dcterms.date" content="2024-10-17">

<title>COURSE 16: WORKING WITH DATES AND TIMES IN PYTHON</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(SKYBLUE1.jpeg);
background-size: cover;
      }
</style>


</head>

<body>

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">COURSE 16: WORKING WITH DATES AND TIMES IN PYTHON</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                      </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Lawal’s note </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Associate Data Science Course in Python by DataCamp Inc
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 17, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#chapter-1-dates-and-calendars" id="toc-chapter-1-dates-and-calendars" class="nav-link active" data-scroll-target="#chapter-1-dates-and-calendars"><span class="header-section-number">1</span> CHAPTER 1: DATES AND CALENDARS</a>
  <ul class="collapse">
  <li><a href="#chapter-1.1-dates-in-python" id="toc-chapter-1.1-dates-in-python" class="nav-link" data-scroll-target="#chapter-1.1-dates-in-python"><span class="header-section-number">1.1</span> CHAPTER 1.1: Dates in Python</a>
  <ul class="collapse">
  <li><a href="#course-overview" id="toc-course-overview" class="nav-link" data-scroll-target="#course-overview"><span class="header-section-number">1.1.1</span> Course overview</a></li>
  <li><a href="#dates-in-python" id="toc-dates-in-python" class="nav-link" data-scroll-target="#dates-in-python"><span class="header-section-number">1.1.2</span> Dates in Python</a></li>
  <li><a href="#why-do-we-need-a-date-class-in-python" id="toc-why-do-we-need-a-date-class-in-python" class="nav-link" data-scroll-target="#why-do-we-need-a-date-class-in-python"><span class="header-section-number">1.1.3</span> Why do we need a date class in Python?</a></li>
  <li><a href="#creating-date-objects" id="toc-creating-date-objects" class="nav-link" data-scroll-target="#creating-date-objects"><span class="header-section-number">1.1.4</span> Creating date objects</a></li>
  <li><a href="#attributes-of-a-date" id="toc-attributes-of-a-date" class="nav-link" data-scroll-target="#attributes-of-a-date"><span class="header-section-number">1.1.5</span> Attributes of a date</a></li>
  <li><a href="#finding-the-weekday-of-a-date" id="toc-finding-the-weekday-of-a-date" class="nav-link" data-scroll-target="#finding-the-weekday-of-a-date"><span class="header-section-number">1.1.6</span> Finding the weekday of a date</a></li>
  </ul></li>
  <li><a href="#exercise-1.1" id="toc-exercise-1.1" class="nav-link" data-scroll-target="#exercise-1.1"><span class="header-section-number">1.2</span> Exercise 1.1</a>
  <ul class="collapse">
  <li><a href="#which-day-of-the-week" id="toc-which-day-of-the-week" class="nav-link" data-scroll-target="#which-day-of-the-week"><span class="header-section-number">1.2.1</span> Which day of the week?</a></li>
  <li><a href="#instructions" id="toc-instructions" class="nav-link" data-scroll-target="#instructions"><span class="header-section-number">1.2.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#exercise-1.1.2" id="toc-exercise-1.1.2" class="nav-link" data-scroll-target="#exercise-1.1.2"><span class="header-section-number">1.3</span> Exercise 1.1.2</a>
  <ul class="collapse">
  <li><a href="#how-many-hurricanes-come-early" id="toc-how-many-hurricanes-come-early" class="nav-link" data-scroll-target="#how-many-hurricanes-come-early"><span class="header-section-number">1.3.1</span> How many hurricanes come early?</a></li>
  <li><a href="#instructions-1" id="toc-instructions-1" class="nav-link" data-scroll-target="#instructions-1"><span class="header-section-number">1.3.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#chapter-1.2-math-with-dates" id="toc-chapter-1.2-math-with-dates" class="nav-link" data-scroll-target="#chapter-1.2-math-with-dates"><span class="header-section-number">1.4</span> Chapter 1.2: Math with Dates</a>
  <ul class="collapse">
  <li><a href="#incrementing-variables-with" id="toc-incrementing-variables-with" class="nav-link" data-scroll-target="#incrementing-variables-with"><span class="header-section-number">1.4.1</span> Incrementing variables with +=</a></li>
  </ul></li>
  <li><a href="#exercise-1.2.1" id="toc-exercise-1.2.1" class="nav-link" data-scroll-target="#exercise-1.2.1"><span class="header-section-number">1.5</span> Exercise 1.2.1</a>
  <ul class="collapse">
  <li><a href="#subtracting-dates" id="toc-subtracting-dates" class="nav-link" data-scroll-target="#subtracting-dates"><span class="header-section-number">1.5.1</span> Subtracting dates</a></li>
  <li><a href="#instructions-2" id="toc-instructions-2" class="nav-link" data-scroll-target="#instructions-2"><span class="header-section-number">1.5.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#exercise-1.2.2" id="toc-exercise-1.2.2" class="nav-link" data-scroll-target="#exercise-1.2.2"><span class="header-section-number">1.6</span> Exercise 1.2.2</a>
  <ul class="collapse">
  <li><a href="#counting-events-per-calendar-month" id="toc-counting-events-per-calendar-month" class="nav-link" data-scroll-target="#counting-events-per-calendar-month"><span class="header-section-number">1.6.1</span> Counting events per calendar month</a></li>
  <li><a href="#instructions-3" id="toc-instructions-3" class="nav-link" data-scroll-target="#instructions-3"><span class="header-section-number">1.6.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#exercise-1.2.3" id="toc-exercise-1.2.3" class="nav-link" data-scroll-target="#exercise-1.2.3"><span class="header-section-number">1.7</span> Exercise 1.2.3</a>
  <ul class="collapse">
  <li><a href="#putting-a-list-of-dates-in-order" id="toc-putting-a-list-of-dates-in-order" class="nav-link" data-scroll-target="#putting-a-list-of-dates-in-order"><span class="header-section-number">1.7.1</span> Putting a list of dates in order</a></li>
  <li><a href="#instructions-4" id="toc-instructions-4" class="nav-link" data-scroll-target="#instructions-4"><span class="header-section-number">1.7.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#chapter-1.3-turning-dates-into-strings" id="toc-chapter-1.3-turning-dates-into-strings" class="nav-link" data-scroll-target="#chapter-1.3-turning-dates-into-strings"><span class="header-section-number">1.8</span> Chapter 1.3: Turning dates into strings</a>
  <ul class="collapse">
  <li><a href="#iso-8601-format" id="toc-iso-8601-format" class="nav-link" data-scroll-target="#iso-8601-format"><span class="header-section-number">1.8.1</span> ISO 8601 format</a></li>
  <li><a href="#every-other-format" id="toc-every-other-format" class="nav-link" data-scroll-target="#every-other-format"><span class="header-section-number">1.8.2</span> Every other format</a></li>
  </ul></li>
  <li><a href="#exercise-1.3.1" id="toc-exercise-1.3.1" class="nav-link" data-scroll-target="#exercise-1.3.1"><span class="header-section-number">1.9</span> Exercise 1.3.1</a>
  <ul class="collapse">
  <li><a href="#printing-dates-in-a-friendly-format" id="toc-printing-dates-in-a-friendly-format" class="nav-link" data-scroll-target="#printing-dates-in-a-friendly-format"><span class="header-section-number">1.9.1</span> Printing dates in a friendly format</a></li>
  <li><a href="#instructions-5" id="toc-instructions-5" class="nav-link" data-scroll-target="#instructions-5"><span class="header-section-number">1.9.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#exercise-1.3.2" id="toc-exercise-1.3.2" class="nav-link" data-scroll-target="#exercise-1.3.2"><span class="header-section-number">1.10</span> Exercise 1.3.2</a>
  <ul class="collapse">
  <li><a href="#representing-dates-in-different-ways" id="toc-representing-dates-in-different-ways" class="nav-link" data-scroll-target="#representing-dates-in-different-ways"><span class="header-section-number">1.10.1</span> Representing dates in different ways</a></li>
  <li><a href="#instructions-6" id="toc-instructions-6" class="nav-link" data-scroll-target="#instructions-6"><span class="header-section-number">1.10.2</span> Instructions</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-CHAPTER2" id="toc-sec-CHAPTER2" class="nav-link" data-scroll-target="#sec-CHAPTER2"><span class="header-section-number">2</span> CHAPTER 2: COMBINING DATES AND TIMES</a>
  <ul class="collapse">
  <li><a href="#sec-Chapter2-1" id="toc-sec-Chapter2-1" class="nav-link" data-scroll-target="#sec-Chapter2-1"><span class="header-section-number">2.1</span> Chapter 2.1: Adding time to the mix</a>
  <ul class="collapse">
  <li><a href="#dates-and-times" id="toc-dates-and-times" class="nav-link" data-scroll-target="#dates-and-times"><span class="header-section-number">2.1.1</span> Dates and Times</a></li>
  <li><a href="#replacing-parts-of-a-datetime" id="toc-replacing-parts-of-a-datetime" class="nav-link" data-scroll-target="#replacing-parts-of-a-datetime"><span class="header-section-number">2.1.2</span> Replacing parts of a datetime</a></li>
  <li><a href="#capital-bikeshare" id="toc-capital-bikeshare" class="nav-link" data-scroll-target="#capital-bikeshare"><span class="header-section-number">2.1.3</span> Capital Bikeshare</a></li>
  </ul></li>
  <li><a href="#exercise-2.1.1" id="toc-exercise-2.1.1" class="nav-link" data-scroll-target="#exercise-2.1.1"><span class="header-section-number">2.2</span> Exercise 2.1.1</a>
  <ul class="collapse">
  <li><a href="#creating-datetimes-by-hand" id="toc-creating-datetimes-by-hand" class="nav-link" data-scroll-target="#creating-datetimes-by-hand"><span class="header-section-number">2.2.1</span> Creating datetimes by hand</a></li>
  <li><a href="#instructions-7" id="toc-instructions-7" class="nav-link" data-scroll-target="#instructions-7"><span class="header-section-number">2.2.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#exercise-2.1.2" id="toc-exercise-2.1.2" class="nav-link" data-scroll-target="#exercise-2.1.2"><span class="header-section-number">2.3</span> Exercise 2.1.2</a>
  <ul class="collapse">
  <li><a href="#counting-events-before-and-after-noon" id="toc-counting-events-before-and-after-noon" class="nav-link" data-scroll-target="#counting-events-before-and-after-noon"><span class="header-section-number">2.3.1</span> Counting events before and after noon</a></li>
  <li><a href="#instructions-8" id="toc-instructions-8" class="nav-link" data-scroll-target="#instructions-8"><span class="header-section-number">2.3.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#chapter-2.2-printing-and-parsing-datetimes" id="toc-chapter-2.2-printing-and-parsing-datetimes" class="nav-link" data-scroll-target="#chapter-2.2-printing-and-parsing-datetimes"><span class="header-section-number">2.4</span> Chapter 2.2: Printing and parsing datetimes</a>
  <ul class="collapse">
  <li><a href="#printing-datetimes" id="toc-printing-datetimes" class="nav-link" data-scroll-target="#printing-datetimes"><span class="header-section-number">2.4.1</span> Printing datetimes</a></li>
  <li><a href="#iso-8601-format-1" id="toc-iso-8601-format-1" class="nav-link" data-scroll-target="#iso-8601-format-1"><span class="header-section-number">2.4.2</span> ISO 8601 Format</a></li>
  <li><a href="#parsing-datetimes-with-strptime" id="toc-parsing-datetimes-with-strptime" class="nav-link" data-scroll-target="#parsing-datetimes-with-strptime"><span class="header-section-number">2.4.3</span> Parsing datetimes with strptime</a></li>
  <li><a href="#parsing-datetimes-with-python" id="toc-parsing-datetimes-with-python" class="nav-link" data-scroll-target="#parsing-datetimes-with-python"><span class="header-section-number">2.4.4</span> Parsing datetimes with Python</a></li>
  </ul></li>
  <li><a href="#exercise-2.2.1" id="toc-exercise-2.2.1" class="nav-link" data-scroll-target="#exercise-2.2.1"><span class="header-section-number">2.5</span> Exercise 2.2.1</a>
  <ul class="collapse">
  <li><a href="#turning-strings-into-datetimes" id="toc-turning-strings-into-datetimes" class="nav-link" data-scroll-target="#turning-strings-into-datetimes"><span class="header-section-number">2.5.1</span> Turning strings into datetimes</a></li>
  <li><a href="#instructions-9" id="toc-instructions-9" class="nav-link" data-scroll-target="#instructions-9"><span class="header-section-number">2.5.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#exercise-2.2.2" id="toc-exercise-2.2.2" class="nav-link" data-scroll-target="#exercise-2.2.2"><span class="header-section-number">2.6</span> Exercise 2.2.2</a>
  <ul class="collapse">
  <li><a href="#parsing-pairs-of-strings-as-datetimes" id="toc-parsing-pairs-of-strings-as-datetimes" class="nav-link" data-scroll-target="#parsing-pairs-of-strings-as-datetimes"><span class="header-section-number">2.6.1</span> Parsing pairs of strings as datetimes</a></li>
  <li><a href="#instructions-10" id="toc-instructions-10" class="nav-link" data-scroll-target="#instructions-10"><span class="header-section-number">2.6.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#exercise-2.2.3" id="toc-exercise-2.2.3" class="nav-link" data-scroll-target="#exercise-2.2.3"><span class="header-section-number">2.7</span> Exercise 2.2.3</a>
  <ul class="collapse">
  <li><a href="#recreating-iso-format-with-strftime" id="toc-recreating-iso-format-with-strftime" class="nav-link" data-scroll-target="#recreating-iso-format-with-strftime"><span class="header-section-number">2.7.1</span> Recreating ISO format with strftime()</a></li>
  <li><a href="#instructions-11" id="toc-instructions-11" class="nav-link" data-scroll-target="#instructions-11"><span class="header-section-number">2.7.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#exercise-2.2.4" id="toc-exercise-2.2.4" class="nav-link" data-scroll-target="#exercise-2.2.4"><span class="header-section-number">2.8</span> Exercise 2.2.4</a>
  <ul class="collapse">
  <li><a href="#unix-timestamps" id="toc-unix-timestamps" class="nav-link" data-scroll-target="#unix-timestamps"><span class="header-section-number">2.8.1</span> Unix timestamps</a></li>
  <li><a href="#instructions-12" id="toc-instructions-12" class="nav-link" data-scroll-target="#instructions-12"><span class="header-section-number">2.8.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#chapter-2.3-working-with-durations" id="toc-chapter-2.3-working-with-durations" class="nav-link" data-scroll-target="#chapter-2.3-working-with-durations"><span class="header-section-number">2.9</span> Chapter 2.3: Working with durations</a>
  <ul class="collapse">
  <li><a href="#creating-timedeltas" id="toc-creating-timedeltas" class="nav-link" data-scroll-target="#creating-timedeltas"><span class="header-section-number">2.9.1</span> Creating timedeltas</a></li>
  <li><a href="#negative-timedeltas" id="toc-negative-timedeltas" class="nav-link" data-scroll-target="#negative-timedeltas"><span class="header-section-number">2.9.2</span> Negative timedeltas</a></li>
  </ul></li>
  <li><a href="#exercise-2.3.1" id="toc-exercise-2.3.1" class="nav-link" data-scroll-target="#exercise-2.3.1"><span class="header-section-number">2.10</span> Exercise 2.3.1</a>
  <ul class="collapse">
  <li><a href="#turning-pairs-of-datetimes-into-durations" id="toc-turning-pairs-of-datetimes-into-durations" class="nav-link" data-scroll-target="#turning-pairs-of-datetimes-into-durations"><span class="header-section-number">2.10.1</span> Turning pairs of datetimes into durations</a></li>
  <li><a href="#instructions-13" id="toc-instructions-13" class="nav-link" data-scroll-target="#instructions-13"><span class="header-section-number">2.10.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#exercise-2.3.2" id="toc-exercise-2.3.2" class="nav-link" data-scroll-target="#exercise-2.3.2"><span class="header-section-number">2.11</span> Exercise 2.3.2</a>
  <ul class="collapse">
  <li><a href="#average-trip-time" id="toc-average-trip-time" class="nav-link" data-scroll-target="#average-trip-time"><span class="header-section-number">2.11.1</span> Average trip time</a></li>
  <li><a href="#instructions-14" id="toc-instructions-14" class="nav-link" data-scroll-target="#instructions-14"><span class="header-section-number">2.11.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#exercise-2.3.3" id="toc-exercise-2.3.3" class="nav-link" data-scroll-target="#exercise-2.3.3"><span class="header-section-number">2.12</span> Exercise 2.3.3</a>
  <ul class="collapse">
  <li><a href="#the-long-and-the-short-of-why-time-is-hard" id="toc-the-long-and-the-short-of-why-time-is-hard" class="nav-link" data-scroll-target="#the-long-and-the-short-of-why-time-is-hard"><span class="header-section-number">2.12.1</span> The long and the short of why time is hard</a></li>
  <li><a href="#instructions-15" id="toc-instructions-15" class="nav-link" data-scroll-target="#instructions-15"><span class="header-section-number">2.12.2</span> Instructions</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-CHAPTER3" id="toc-sec-CHAPTER3" class="nav-link" data-scroll-target="#sec-CHAPTER3"><span class="header-section-number">3</span> CHAPTER 3: TIME ZONES AND DAYLIGHT SAVING</a>
  <ul class="collapse">
  <li><a href="#sec-Chapter3-1" id="toc-sec-Chapter3-1" class="nav-link" data-scroll-target="#sec-Chapter3-1"><span class="header-section-number">3.1</span> Chapter 3.1: UTC offsets</a>
  <ul class="collapse">
  <li><a href="#time-zones" id="toc-time-zones" class="nav-link" data-scroll-target="#time-zones"><span class="header-section-number">3.1.1</span> Time zones</a></li>
  <li><a href="#utc" id="toc-utc" class="nav-link" data-scroll-target="#utc"><span class="header-section-number">3.1.2</span> UTC</a></li>
  <li><a href="#adjusting-timezone-vs-changing-tzinfo" id="toc-adjusting-timezone-vs-changing-tzinfo" class="nav-link" data-scroll-target="#adjusting-timezone-vs-changing-tzinfo"><span class="header-section-number">3.1.3</span> Adjusting timezone vs changing tzinfo</a></li>
  </ul></li>
  <li><a href="#exercise-3.1.1" id="toc-exercise-3.1.1" class="nav-link" data-scroll-target="#exercise-3.1.1"><span class="header-section-number">3.2</span> Exercise 3.1.1</a>
  <ul class="collapse">
  <li><a href="#creating-timezone-aware-datetimes" id="toc-creating-timezone-aware-datetimes" class="nav-link" data-scroll-target="#creating-timezone-aware-datetimes"><span class="header-section-number">3.2.1</span> Creating timezone aware datetimes</a></li>
  <li><a href="#instructions-16" id="toc-instructions-16" class="nav-link" data-scroll-target="#instructions-16"><span class="header-section-number">3.2.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#exercise-3.1.2" id="toc-exercise-3.1.2" class="nav-link" data-scroll-target="#exercise-3.1.2"><span class="header-section-number">3.3</span> Exercise 3.1.2</a>
  <ul class="collapse">
  <li><a href="#setting-timezones" id="toc-setting-timezones" class="nav-link" data-scroll-target="#setting-timezones"><span class="header-section-number">3.3.1</span> Setting timezones</a></li>
  <li><a href="#instructions-17" id="toc-instructions-17" class="nav-link" data-scroll-target="#instructions-17"><span class="header-section-number">3.3.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#exercise-3.1.3" id="toc-exercise-3.1.3" class="nav-link" data-scroll-target="#exercise-3.1.3"><span class="header-section-number">3.4</span> Exercise 3.1.3</a>
  <ul class="collapse">
  <li><a href="#what-time-did-the-bike-leave-in-utc" id="toc-what-time-did-the-bike-leave-in-utc" class="nav-link" data-scroll-target="#what-time-did-the-bike-leave-in-utc"><span class="header-section-number">3.4.1</span> What time did the bike leave in UTC?</a></li>
  <li><a href="#instructions-18" id="toc-instructions-18" class="nav-link" data-scroll-target="#instructions-18"><span class="header-section-number">3.4.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#chapter-3.2-time-zone-database" id="toc-chapter-3.2-time-zone-database" class="nav-link" data-scroll-target="#chapter-3.2-time-zone-database"><span class="header-section-number">3.5</span> Chapter 3.2: Time zone database</a></li>
  <li><a href="#exercise-3.2.1" id="toc-exercise-3.2.1" class="nav-link" data-scroll-target="#exercise-3.2.1"><span class="header-section-number">3.6</span> Exercise 3.2.1</a>
  <ul class="collapse">
  <li><a href="#putting-the-bike-trips-into-the-right-time-zone" id="toc-putting-the-bike-trips-into-the-right-time-zone" class="nav-link" data-scroll-target="#putting-the-bike-trips-into-the-right-time-zone"><span class="header-section-number">3.6.1</span> Putting the bike trips into the right time zone</a></li>
  <li><a href="#instructions-19" id="toc-instructions-19" class="nav-link" data-scroll-target="#instructions-19"><span class="header-section-number">3.6.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#exercise-3.2.2" id="toc-exercise-3.2.2" class="nav-link" data-scroll-target="#exercise-3.2.2"><span class="header-section-number">3.7</span> Exercise 3.2.2</a>
  <ul class="collapse">
  <li><a href="#what-time-did-the-bike-leave-global-edition" id="toc-what-time-did-the-bike-leave-global-edition" class="nav-link" data-scroll-target="#what-time-did-the-bike-leave-global-edition"><span class="header-section-number">3.7.1</span> What time did the bike leave? (Global edition)</a></li>
  <li><a href="#instructions-20" id="toc-instructions-20" class="nav-link" data-scroll-target="#instructions-20"><span class="header-section-number">3.7.2</span> Instructions</a></li>
  <li><a href="#sec-Chapter3-3" id="toc-sec-Chapter3-3" class="nav-link" data-scroll-target="#sec-Chapter3-3"><span class="header-section-number">3.7.3</span> Chapter 3.3: Starting Daylight Saving Time</a></li>
  </ul></li>
  <li><a href="#exercise-3.3.1" id="toc-exercise-3.3.1" class="nav-link" data-scroll-target="#exercise-3.3.1"><span class="header-section-number">3.8</span> Exercise 3.3.1</a>
  <ul class="collapse">
  <li><a href="#how-many-hours-elapsed-around-daylight-saving" id="toc-how-many-hours-elapsed-around-daylight-saving" class="nav-link" data-scroll-target="#how-many-hours-elapsed-around-daylight-saving"><span class="header-section-number">3.8.1</span> How many hours elapsed around daylight saving?</a></li>
  <li><a href="#instructions-21" id="toc-instructions-21" class="nav-link" data-scroll-target="#instructions-21"><span class="header-section-number">3.8.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#exercise-3.3.2" id="toc-exercise-3.3.2" class="nav-link" data-scroll-target="#exercise-3.3.2"><span class="header-section-number">3.9</span> Exercise 3.3.2</a>
  <ul class="collapse">
  <li><a href="#march-29-throughout-a-decade" id="toc-march-29-throughout-a-decade" class="nav-link" data-scroll-target="#march-29-throughout-a-decade"><span class="header-section-number">3.9.1</span> March 29, throughout a decade</a></li>
  <li><a href="#instructions-22" id="toc-instructions-22" class="nav-link" data-scroll-target="#instructions-22"><span class="header-section-number">3.9.2</span> Instructions</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#chapter-3.4-ending-daylight-saving-time" id="toc-chapter-3.4-ending-daylight-saving-time" class="nav-link" data-scroll-target="#chapter-3.4-ending-daylight-saving-time"><span class="header-section-number">4</span> Chapter 3.4: Ending Daylight Saving Time</a>
  <ul class="collapse">
  <li><a href="#exercise-3.4.1" id="toc-exercise-3.4.1" class="nav-link" data-scroll-target="#exercise-3.4.1"><span class="header-section-number">4.1</span> Exercise 3.4.1</a>
  <ul class="collapse">
  <li><a href="#finding-ambiguous-datetimes" id="toc-finding-ambiguous-datetimes" class="nav-link" data-scroll-target="#finding-ambiguous-datetimes"><span class="header-section-number">4.1.1</span> Finding ambiguous datetimes</a></li>
  <li><a href="#instructions-23" id="toc-instructions-23" class="nav-link" data-scroll-target="#instructions-23"><span class="header-section-number">4.1.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#exercise-3.4.2" id="toc-exercise-3.4.2" class="nav-link" data-scroll-target="#exercise-3.4.2"><span class="header-section-number">4.2</span> Exercise 3.4.2</a>
  <ul class="collapse">
  <li><a href="#cleaning-daylight-saving-data-with-fold" id="toc-cleaning-daylight-saving-data-with-fold" class="nav-link" data-scroll-target="#cleaning-daylight-saving-data-with-fold"><span class="header-section-number">4.2.1</span> Cleaning daylight saving data with fold</a></li>
  <li><a href="#instructions-24" id="toc-instructions-24" class="nav-link" data-scroll-target="#instructions-24"><span class="header-section-number">4.2.2</span> Instructions</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#chapter-4-easy-and-powerful-dates-and-times-in-pandas" id="toc-chapter-4-easy-and-powerful-dates-and-times-in-pandas" class="nav-link" data-scroll-target="#chapter-4-easy-and-powerful-dates-and-times-in-pandas"><span class="header-section-number">5</span> CHAPTER 4: EASY AND POWERFUL: DATES AND TIMES IN PANDAS</a>
  <ul class="collapse">
  <li><a href="#chapter-4.1-reading-date-and-time-data-in-pandas" id="toc-chapter-4.1-reading-date-and-time-data-in-pandas" class="nav-link" data-scroll-target="#chapter-4.1-reading-date-and-time-data-in-pandas"><span class="header-section-number">5.1</span> Chapter 4.1: Reading date and time data in Pandas</a>
  <ul class="collapse">
  <li><a href="#a-simple-pandas-example" id="toc-a-simple-pandas-example" class="nav-link" data-scroll-target="#a-simple-pandas-example"><span class="header-section-number">5.1.1</span> A simple Pandas example</a></li>
  <li><a href="#loading-datetimes-with-parse_dates" id="toc-loading-datetimes-with-parse_dates" class="nav-link" data-scroll-target="#loading-datetimes-with-parse_dates"><span class="header-section-number">5.1.2</span> Loading datetimes with parse_dates</a></li>
  <li><a href="#timezone-aware-arithmetic" id="toc-timezone-aware-arithmetic" class="nav-link" data-scroll-target="#timezone-aware-arithmetic"><span class="header-section-number">5.1.3</span> Timezone-aware arithmetic</a></li>
  <li><a href="#loading-datetimes-with-parse_dates-1" id="toc-loading-datetimes-with-parse_dates-1" class="nav-link" data-scroll-target="#loading-datetimes-with-parse_dates-1"><span class="header-section-number">5.1.4</span> Loading datetimes with parse_dates</a></li>
  </ul></li>
  <li><a href="#exercise-4.1.1" id="toc-exercise-4.1.1" class="nav-link" data-scroll-target="#exercise-4.1.1"><span class="header-section-number">5.2</span> Exercise 4.1.1</a>
  <ul class="collapse">
  <li><a href="#loading-a-csv-file-in-pandas" id="toc-loading-a-csv-file-in-pandas" class="nav-link" data-scroll-target="#loading-a-csv-file-in-pandas"><span class="header-section-number">5.2.1</span> Loading a csv file in Pandas</a></li>
  <li><a href="#instructions-25" id="toc-instructions-25" class="nav-link" data-scroll-target="#instructions-25"><span class="header-section-number">5.2.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#exercise-4.1.2" id="toc-exercise-4.1.2" class="nav-link" data-scroll-target="#exercise-4.1.2"><span class="header-section-number">5.3</span> Exercise 4.1.2</a>
  <ul class="collapse">
  <li><a href="#making-timedelta-columns" id="toc-making-timedelta-columns" class="nav-link" data-scroll-target="#making-timedelta-columns"><span class="header-section-number">5.3.1</span> Making timedelta columns</a></li>
  <li><a href="#instructions-26" id="toc-instructions-26" class="nav-link" data-scroll-target="#instructions-26"><span class="header-section-number">5.3.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#chapter-4.2-summarizing-datetime-data-in-pandas" id="toc-chapter-4.2-summarizing-datetime-data-in-pandas" class="nav-link" data-scroll-target="#chapter-4.2-summarizing-datetime-data-in-pandas"><span class="header-section-number">5.4</span> CHAPTER 4.2: Summarizing datetime data in Pandas</a></li>
  <li><a href="#exercise-4.2.1" id="toc-exercise-4.2.1" class="nav-link" data-scroll-target="#exercise-4.2.1"><span class="header-section-number">5.5</span> Exercise 4.2.1</a>
  <ul class="collapse">
  <li><a href="#how-many-joyrides" id="toc-how-many-joyrides" class="nav-link" data-scroll-target="#how-many-joyrides"><span class="header-section-number">5.5.1</span> How many joyrides?</a></li>
  <li><a href="#instructions-27" id="toc-instructions-27" class="nav-link" data-scroll-target="#instructions-27"><span class="header-section-number">5.5.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#exercise-4.2.2" id="toc-exercise-4.2.2" class="nav-link" data-scroll-target="#exercise-4.2.2"><span class="header-section-number">5.6</span> Exercise 4.2.2</a>
  <ul class="collapse">
  <li><a href="#instructions-28" id="toc-instructions-28" class="nav-link" data-scroll-target="#instructions-28"><span class="header-section-number">5.6.1</span> Instructions</a></li>
  </ul></li>
  <li><a href="#exercise-4.2.3" id="toc-exercise-4.2.3" class="nav-link" data-scroll-target="#exercise-4.2.3"><span class="header-section-number">5.7</span> Exercise 4.2.3</a>
  <ul class="collapse">
  <li><a href="#members-vs-casual-riders-over-time" id="toc-members-vs-casual-riders-over-time" class="nav-link" data-scroll-target="#members-vs-casual-riders-over-time"><span class="header-section-number">5.7.1</span> Members vs casual riders over time</a></li>
  <li><a href="#instructions-29" id="toc-instructions-29" class="nav-link" data-scroll-target="#instructions-29"><span class="header-section-number">5.7.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#exercise-4.2.4" id="toc-exercise-4.2.4" class="nav-link" data-scroll-target="#exercise-4.2.4"><span class="header-section-number">5.8</span> Exercise 4.2.4</a>
  <ul class="collapse">
  <li><a href="#combining-groupby-and-resample" id="toc-combining-groupby-and-resample" class="nav-link" data-scroll-target="#combining-groupby-and-resample"><span class="header-section-number">5.8.1</span> Combining groupby() and resample()</a></li>
  <li><a href="#instructions-30" id="toc-instructions-30" class="nav-link" data-scroll-target="#instructions-30"><span class="header-section-number">5.8.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#chapter-4.3-additional-datetime-methods-in-pandas" id="toc-chapter-4.3-additional-datetime-methods-in-pandas" class="nav-link" data-scroll-target="#chapter-4.3-additional-datetime-methods-in-pandas"><span class="header-section-number">5.9</span> CHAPTER 4.3: Additional datetime methods in Pandas</a>
  <ul class="collapse">
  <li><a href="#timezones-in-pandas" id="toc-timezones-in-pandas" class="nav-link" data-scroll-target="#timezones-in-pandas"><span class="header-section-number">5.9.1</span> Timezones in Pandas</a></li>
  <li><a href="#other-datetime-operations-in-pandas" id="toc-other-datetime-operations-in-pandas" class="nav-link" data-scroll-target="#other-datetime-operations-in-pandas"><span class="header-section-number">5.9.2</span> Other datetime operations in Pandas</a></li>
  <li><a href="#other-parts-of-pandas" id="toc-other-parts-of-pandas" class="nav-link" data-scroll-target="#other-parts-of-pandas"><span class="header-section-number">5.9.3</span> Other parts of Pandas</a></li>
  </ul></li>
  <li><a href="#exercise-4.3.1" id="toc-exercise-4.3.1" class="nav-link" data-scroll-target="#exercise-4.3.1"><span class="header-section-number">5.10</span> Exercise 4.3.1</a>
  <ul class="collapse">
  <li><a href="#timezones-in-pandas-1" id="toc-timezones-in-pandas-1" class="nav-link" data-scroll-target="#timezones-in-pandas-1"><span class="header-section-number">5.10.1</span> Timezones in Pandas</a></li>
  <li><a href="#instructions-31" id="toc-instructions-31" class="nav-link" data-scroll-target="#instructions-31"><span class="header-section-number">5.10.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#exercise-4.3.2" id="toc-exercise-4.3.2" class="nav-link" data-scroll-target="#exercise-4.3.2"><span class="header-section-number">5.11</span> Exercise 4.3.2</a>
  <ul class="collapse">
  <li><a href="#how-long-per-weekday" id="toc-how-long-per-weekday" class="nav-link" data-scroll-target="#how-long-per-weekday"><span class="header-section-number">5.11.1</span> How long per weekday?</a></li>
  <li><a href="#instructions-32" id="toc-instructions-32" class="nav-link" data-scroll-target="#instructions-32"><span class="header-section-number">5.11.2</span> Instructions</a></li>
  </ul></li>
  <li><a href="#exercise-4.3.3" id="toc-exercise-4.3.3" class="nav-link" data-scroll-target="#exercise-4.3.3"><span class="header-section-number">5.12</span> Exercise 4.3.3</a>
  <ul class="collapse">
  <li><a href="#how-long-between-rides" id="toc-how-long-between-rides" class="nav-link" data-scroll-target="#how-long-between-rides"><span class="header-section-number">5.12.1</span> How long between rides?</a></li>
  <li><a href="#instructions-33" id="toc-instructions-33" class="nav-link" data-scroll-target="#instructions-33"><span class="header-section-number">5.12.2</span> Instructions</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#explore-datasets" id="toc-explore-datasets" class="nav-link" data-scroll-target="#explore-datasets"><span class="header-section-number">6</span> Explore Datasets</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="index.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li><li><a href="index.docx"><i class="bi bi-file-word"></i>MS Word</a></li></ul></div></nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><img src="SOA.jpg" class="img-fluid"></p>
<p>You’ll probably never have a time machine, but how about a machine for analyzing time? As soon as time enters any analysis, things can get weird. It’s easy to get tripped up on day and month boundaries, time zones, daylight saving time, and all sorts of other things that can confuse the unprepared. If you’re going to do any kind of analysis involving time, you’ll want to use Python to sort it out. Working with data sets on hurricanes and bike trips, we’ll cover counting events, figuring out how much time has elapsed between events and plotting data over time. You’ll work in both standard Python and in Pandas, and we’ll touch on the dateutil library, the only timezone library endorsed by the official Python documentation. After this course, you’ll confidently handle date and time data in any format like a champion.</p>
<section id="chapter-1-dates-and-calendars" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> CHAPTER 1: DATES AND CALENDARS</h1>
<section id="chapter-1.1-dates-in-python" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="chapter-1.1-dates-in-python"><span class="header-section-number">1.1</span> CHAPTER 1.1: Dates in Python</h2>
<p>Hi! My name is Max Shron, I will be your instructor for this course on working with dates and times in Python. Dates are everywhere in data science. Stock prices go up and down, experiments begin and end, people are born, politicians take votes, and on and on. All these events happen at a particular point in time. Knowing how to analyze data over time is a core data science skill.</p>
<section id="course-overview" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="course-overview"><span class="header-section-number">1.1.1</span> Course overview</h3>
<p>This course is divided into four chapters. The first chapter will be about working with dates and calendars. In chapter two, we will add time into the mix, and combine dates and times. In chapter three, we’ll tackle one of the toughest parts of working with time: time zones and Daylight Saving. And finally, in chapter four, we’ll connect what we’ve learned about working with dates and times to explore how Pandas can make answering even complex questions about dates much easier.</p>
</section>
<section id="dates-in-python" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2" class="anchored" data-anchor-id="dates-in-python"><span class="header-section-number">1.1.2</span> Dates in Python</h3>
<p>Let’s begin. Python has a special date class, called “date”, which you will use to represent dates. A date, like a string, or a number, or a numpy array, has special rules for creating it and methods for working with it. In this lesson, we’re going to discuss creating dates and extracting some basic information out of them.</p>
</section>
<section id="why-do-we-need-a-date-class-in-python" class="level3" data-number="1.1.3">
<h3 data-number="1.1.3" class="anchored" data-anchor-id="why-do-we-need-a-date-class-in-python"><span class="header-section-number">1.1.3</span> Why do we need a date class in Python?</h3>
<p>Why do we need a special date class? Let’s have a look. To understand how dates work, in this chapter you’re going to be exploring 67 years of Hurricane landfalls in the US state of Florida. two_hurricanes is a list with the dates of two hurricanes represented as strings: the last 2016 hurricane (on October 7th, 2016) and the first 2017 hurricane (on June 21st, 2017). The dates are represented in the US style, with the month, then the day, then the year. Suppose you want to do something interesting with these dates. How would you figure out how many days had elapsed between them? How would you check that they were ordered from earliest to latest? How would you know which day of the week each was? Doing these things manually would be challenging, but Python makes all of them easy. By the end of this chapter, you’ll know how to do each of these things yourself.</p>
</section>
<section id="creating-date-objects" class="level3" data-number="1.1.4">
<h3 data-number="1.1.4" class="anchored" data-anchor-id="creating-date-objects"><span class="header-section-number">1.1.4</span> Creating date objects</h3>
<p>To create a date object, we start by importing the date class. The collection of date and time-related classes are stored in the “datetime” package. We create a date using the <code>date()</code> function. Here we’ve created dates corresponding to the two hurricanes, now as Python date objects. The inputs to <code>date()</code> are the year, month, and day. The first date is October 7, 2016, and the second date is June 21, 2017. The order is easy to remember: it goes from the biggest to smallest. Year, month, day. Later in this chapter, you’ll create dates directly from lists of strings, but in this lesson, you’re going to stick to creating dates by hand or using lists of already created dates.</p>
</section>
<section id="attributes-of-a-date" class="level3" data-number="1.1.5">
<h3 data-number="1.1.5" class="anchored" data-anchor-id="attributes-of-a-date"><span class="header-section-number">1.1.5</span> Attributes of a date</h3>
<p>You can access individual components of a date using the date’s attributes. You can access the year of the date using the year attribute, like so, and the result is 2016. Similarly, you can access the month and day using the month and day attributes like so.</p>
</section>
<section id="finding-the-weekday-of-a-date" class="level3" data-number="1.1.6">
<h3 data-number="1.1.6" class="anchored" data-anchor-id="finding-the-weekday-of-a-date"><span class="header-section-number">1.1.6</span> Finding the weekday of a date</h3>
<p>You can also ask Python to do more complicated work. Here we call the <code>weekday()</code> method on the date, and see that the weekday is 4. What does 4 mean here? Python counts weekdays from 0, starting on Monday. 1 is Tuesday, 2 is Wednesday, and so on, up to 6 being a Sunday. This date was a Friday.</p>
</section>
</section>
<section id="exercise-1.1" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="exercise-1.1"><span class="header-section-number">1.2</span> Exercise 1.1</h2>
<section id="which-day-of-the-week" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="which-day-of-the-week"><span class="header-section-number">1.2.1</span> Which day of the week?</h3>
<p>Hurricane Andrew, which hit Florida on August 24, 1992, was one of the costliest and deadliest hurricanes in US history. Which day of the week did it make landfall?</p>
<p>Let’s walk through all of the steps to figure this out.</p>
</section>
<section id="instructions" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="instructions"><span class="header-section-number">1.2.2</span> Instructions</h3>
<ul>
<li>Import <code>date</code> from <code>datetime</code>.</li>
<li>Create a <code>date</code> object for August 24, 1992.</li>
<li>Now ask Python what day of the week Hurricane Andrew hit (remember that Python counts days of the week starting from Monday as 0, Tuesday as 1, and so on).</li>
</ul>
<div id="7a7460fa" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importing the course packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> date, datetime, timezone, timedelta</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dateutil <span class="im">import</span> tz</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the course datasets</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>rides <span class="op">=</span> pd.read_csv(<span class="st">'datasets/capital-onebike.csv'</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'datasets/florida_hurricane_dates.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> f:</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    florida_hurricane_dates <span class="op">=</span> pickle.load(f)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>florida_hurricane_dates <span class="op">=</span> <span class="bu">sorted</span>(florida_hurricane_dates)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Import date from datetime</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> date</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a date object</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>hurricane_andrew <span class="op">=</span> date(<span class="dv">1992</span>,<span class="dv">8</span>,<span class="dv">24</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Which day of the week is the date?</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(hurricane_andrew.weekday())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>0</code></pre>
</div>
</div>
</section>
</section>
<section id="exercise-1.1.2" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="exercise-1.1.2"><span class="header-section-number">1.3</span> Exercise 1.1.2</h2>
<section id="how-many-hurricanes-come-early" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="how-many-hurricanes-come-early"><span class="header-section-number">1.3.1</span> How many hurricanes come early?</h3>
<p>In this chapter, you will work with a list of the hurricanes that made landfall in Florida from 1950 to 2017. There were 235 in total. Check out the variable <code>florida_hurricane_dates</code>, which has all of these dates.</p>
<p>Atlantic hurricane season officially begins on June 1. How many hurricanes since 1950 have made landfall in Florida before the official start of hurricane season?</p>
</section>
<section id="instructions-1" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="instructions-1"><span class="header-section-number">1.3.2</span> Instructions</h3>
<ul>
<li>Complete the <code>for</code> loop to iterate through <code>florida_hurricane_dates</code>.</li>
<li>Complete the <code>if</code> statement to increment the counter (<code>early_hurricanes</code>) if the hurricane made landfall before June.</li>
</ul>
<div id="d44f8026" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Counter for how many before June 1</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>early_hurricanes <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We loop over the dates</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> hurricane <span class="kw">in</span> florida_hurricane_dates:</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if the month is before June (month number 6)</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> hurricane.month <span class="op">&lt;</span> <span class="dv">6</span>:</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    early_hurricanes <span class="op">=</span> early_hurricanes <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(early_hurricanes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>10</code></pre>
</div>
</div>
</section>
</section>
<section id="chapter-1.2-math-with-dates" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="chapter-1.2-math-with-dates"><span class="header-section-number">1.4</span> Chapter 1.2: Math with Dates</h2>
<p>In the last lesson, we discussed how to create date objects and access their attributes. In this lesson, we’re going to talk about how to do math with dates: counting days between events, moving forward or backward by a number of days, putting them in order, and so on. Let’s take a step back. Think back to when you first learned arithmetic. You probably started with something like this: a number line. This one has the numbers 10 through 16 on it. A number line tells you what order the numbers go in, and how far apart numbers are from each other. Let’s pick two numbers, 11 and 14, and represent them in Python as the variables a and b, respectively. We’ll put them into a list, l. Python can tell us which number in this list is the least, using the <code>min()</code> function. <code>min</code> stands for the minimum. In this case, 11 is the lowest number in the list, so we get 11. We can also subtract numbers. When you subtract two numbers, in this case subtracting 11 from 14, the result is 3. Said another way, if we took three steps from 11, we would get 14. Now let’s think about how this applies to dates. Let’s call this line a calendar line, instead of a number line. Each dot on this calendar line corresponds to a particular day. Let’s put two dates onto this calendar line: November 5th, 2017, and December 4th, 2017. Let’s represent this in Python. We start by importing the date class from the datetime package. We create two date objects: d1 is November 5th, 2017, and d2 is December 4th, 2017. As before, we put them into a list, l. What Python is doing under the hood, so to speak, is not that different from putting the dates onto a calendar line. For example, if we call min of l, we again get the “least” date, which means the earliest one. In this case, that’s November 5th, 2017. And just like numbers, we can subtract two dates. When we do this, we get an object of type “timedelta”. Timedeltas give us the elapsed time between events. If you access the days attribute of this object, you can obtain the number of days between the two dates. We can also use a timedelta in the other direction. First, let’s import timedelta from datetime. Next, we create a 29-day timedelta, by passing days=29 to <code>timedelta()</code>. Now when we add td to our original date we get back December 4th, 2017. Python handled the fact that November has 30 days in it for us, without us having to remember which months are 30 day months, 31 day months, or 28 day months.</p>
<section id="incrementing-variables-with" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="incrementing-variables-with"><span class="header-section-number">1.4.1</span> Incrementing variables with +=</h3>
<p>Finally a quick side note: we will use the “plus-equals” operation a number of times in the rest of the course, so we should discuss it. If you aren’t familiar with it, you can see how it works here. On the left-hand side, we create a variable x, set it to zero. If we set x equal to x + 1, we increment x by 1. Similarly, on the right-hand side, we set x = 0, and then we increment it with x += 1. It has the same effect, and we’ll use it all the time for counting.</p>
</section>
</section>
<section id="exercise-1.2.1" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="exercise-1.2.1"><span class="header-section-number">1.5</span> Exercise 1.2.1</h2>
<section id="subtracting-dates" class="level3" data-number="1.5.1">
<h3 data-number="1.5.1" class="anchored" data-anchor-id="subtracting-dates"><span class="header-section-number">1.5.1</span> Subtracting dates</h3>
<p>Python <code>date</code> objects let us treat calendar dates as something similar to numbers: we can compare them, sort them, add, and even subtract them. This lets us do math with dates in a way that would be a pain to do by hand.</p>
<p>The 2007 Florida hurricane season was one of the busiest on record, with 8 hurricanes in one year. The first one hit on May 9th, 2007, and the last one hit on December 13th, 2007. How many days elapsed between the first and last hurricane in 2007?</p>
</section>
<section id="instructions-2" class="level3" data-number="1.5.2">
<h3 data-number="1.5.2" class="anchored" data-anchor-id="instructions-2"><span class="header-section-number">1.5.2</span> Instructions</h3>
<ul>
<li>Create a <code>date</code> object for May 9th, 2007, and assign it to the <code>start</code> variable.</li>
<li>Create a <code>date</code> object for December 13th, 2007, and assign it to the <code>end</code> variable.</li>
<li>Subtract <code>start</code> from <code>end</code>, to print the number of days in the resulting <code>timedelta</code> object.</li>
</ul>
<div id="5bceb131" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a date object for May 9th, 2007</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> date(<span class="dv">2007</span>, <span class="dv">5</span>, <span class="dv">9</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a date object for December 13th, 2007</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>end <span class="op">=</span> date(<span class="dv">2007</span>, <span class="dv">12</span>, <span class="dv">13</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Subtract the two dates and print the number of days</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>((end <span class="op">-</span> start).days)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>218</code></pre>
</div>
</div>
</section>
</section>
<section id="exercise-1.2.2" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="exercise-1.2.2"><span class="header-section-number">1.6</span> Exercise 1.2.2</h2>
<section id="counting-events-per-calendar-month" class="level3" data-number="1.6.1">
<h3 data-number="1.6.1" class="anchored" data-anchor-id="counting-events-per-calendar-month"><span class="header-section-number">1.6.1</span> Counting events per calendar month</h3>
<p>Hurricanes can make landfall in Florida throughout the year. As we’ve already discussed, some months are more hurricane-prone than others.</p>
<p>Using <code>florida_hurricane_dates</code>, let’s see how hurricanes in Florida were distributed across months throughout the year.</p>
<p>We’ve created a dictionary called <code>hurricanes_each_month</code> to hold your counts and set the initial counts to zero. You will loop over the list of hurricanes, incrementing the correct month in <code>hurricanes_each_month</code> as you go, and then print the result.</p>
</section>
<section id="instructions-3" class="level3" data-number="1.6.2">
<h3 data-number="1.6.2" class="anchored" data-anchor-id="instructions-3"><span class="header-section-number">1.6.2</span> Instructions</h3>
<ul>
<li>Within the <code>for</code> loop:</li>
<li>Assign <code>month</code> to be the month of that hurricane.</li>
<li>Increment <code>hurricanes_each_month</code> for the relevant month by 1.</li>
</ul>
<div id="5d1419d0" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A dictionary to count hurricanes per calendar month</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>hurricanes_each_month <span class="op">=</span> {<span class="dv">1</span>: <span class="dv">0</span>, <span class="dv">2</span>: <span class="dv">0</span>, <span class="dv">3</span>: <span class="dv">0</span>, <span class="dv">4</span>: <span class="dv">0</span>, <span class="dv">5</span>: <span class="dv">0</span>, <span class="dv">6</span>:<span class="dv">0</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                         <span class="dv">7</span>: <span class="dv">0</span>, <span class="dv">8</span>:<span class="dv">0</span>, <span class="dv">9</span>:<span class="dv">0</span>, <span class="dv">10</span>:<span class="dv">0</span>, <span class="dv">11</span>:<span class="dv">0</span>, <span class="dv">12</span>:<span class="dv">0</span>}</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Shuffle the list</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>dates_scrambled <span class="op">=</span> florida_hurricane_dates</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>random.shuffle(dates_scrambled)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the first and last scrambled dates</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dates_scrambled[<span class="dv">0</span>])</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dates_scrambled[<span class="op">-</span><span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>2004-09-16
1971-09-01</code></pre>
</div>
</div>
</section>
</section>
<section id="exercise-1.2.3" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="exercise-1.2.3"><span class="header-section-number">1.7</span> Exercise 1.2.3</h2>
<section id="putting-a-list-of-dates-in-order" class="level3" data-number="1.7.1">
<h3 data-number="1.7.1" class="anchored" data-anchor-id="putting-a-list-of-dates-in-order"><span class="header-section-number">1.7.1</span> Putting a list of dates in order</h3>
<p>Much like numbers and strings, <code>date</code> objects in Python can be put in order. Earlier dates come before later ones, and so we can sort a list of <code>date</code> objects from earliest to latest.</p>
<p>What if our Florida hurricane dates had been scrambled? We’ve gone ahead and shuffled them so they’re in random order and saved the results as <code>dates_scrambled</code>. Your job is to put them back in chronological order, and then print the first and last dates from this sorted list.</p>
</section>
<section id="instructions-4" class="level3" data-number="1.7.2">
<h3 data-number="1.7.2" class="anchored" data-anchor-id="instructions-4"><span class="header-section-number">1.7.2</span> Instructions</h3>
<ul>
<li>Print the first and last dates in <code>dates_scrambled</code>.</li>
<li>Sort <code>dates_scrambled</code> using Python’s built-in <code>sorted()</code> function, and save the results to <code>dates_ordered</code>.</li>
<li>Print the first and last dates in <code>dates_ordered</code>.</li>
</ul>
<div id="69bce429" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Put the dates in order</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>dates_ordered <span class="op">=</span> <span class="bu">sorted</span>(dates_scrambled)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the first and last ordered dates</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dates_ordered[<span class="dv">0</span>])</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dates_ordered[<span class="op">-</span><span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>1950-08-31
2017-10-29</code></pre>
</div>
</div>
</section>
</section>
<section id="chapter-1.3-turning-dates-into-strings" class="level2" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="chapter-1.3-turning-dates-into-strings"><span class="header-section-number">1.8</span> Chapter 1.3: Turning dates into strings</h2>
<p>Python has a very flexible set of tools for turning dates back into strings to be easily read. We want to put dates back into strings when, for example, we want to print results, but also if we want to put dates into filenames, or if we want to write dates out to CSV or Excel files.</p>
<section id="iso-8601-format" class="level3" data-number="1.8.1">
<h3 data-number="1.8.1" class="anchored" data-anchor-id="iso-8601-format"><span class="header-section-number">1.8.1</span> ISO 8601 format</h3>
<p>For example, let’s create a date and see how Python prints it by default. As before, we import date from datetime and let’s again create an object for November 5th, 2017. When we ask Python to print the date, it prints the year, day and then the month, separated by dashes, and always with two digits for the day and month. In the comment, you can see I’ve noted this as YYYY-MM-DD; four digit year, two digit month, and two digit day of the month. This default format is also known as ISO format, or ISO 8601 format, after the international standard ISO 8601 that it is based on. ISO 8601 strings are always the same length since month and day are written with 0s when they are less than 10. We’ll talk about another advantage of ISO 8601 in a moment. If we want the ISO representation of a date as a string, say to write it to a CSV file instead of just printing it, you can call the <code>isoformat()</code> method. In this example, we put it inside a list so you can see that it creates a string. The ISO 8601 format has another nice advantage. To demonstrate, we’ve created a variable called some_dates and represented two dates here as strings: January 1, 2000, and December 31, 1999. Dates formatted as ISO 8601 strings sort correctly. When we print the sorted version of this list, the earlier day is first, and the later date is second. For example, if we use ISO 8601 dates in filenames, they can be correctly sorted from earliest to latest. If we had month or day first, the strings would not sort in chronological order.</p>
</section>
<section id="every-other-format" class="level3" data-number="1.8.2">
<h3 data-number="1.8.2" class="anchored" data-anchor-id="every-other-format"><span class="header-section-number">1.8.2</span> Every other format</h3>
<p>If you don’t want to put dates in ISO 8601 format, Python has a flexible set of options for representing dates in other ways, using the <code>strftime()</code> method. <code>strftime()</code> works by letting you pass a “format string” which Python uses to format your date. Let’s see an example. We again create an example date of January 5th, 2017. We then call <code>strftime()</code> on d, with the format string of % capital Y. Strftime reads the % capital Y and fills in the year in this string for us. <code>strftime()</code> though is very flexible: we can give it arbitrary strings with % capital Y in them for the format string, and it will stick the year in. For example, we can use the format string of “Year is %Y”. Strftime has other placeholders besides %Y: % lowercase m gives the month, and % lowercase d gives the day of the month. Using these, we can represent dates in arbitrary formats for whatever our needs are.</p>
</section>
</section>
<section id="exercise-1.3.1" class="level2" data-number="1.9">
<h2 data-number="1.9" class="anchored" data-anchor-id="exercise-1.3.1"><span class="header-section-number">1.9</span> Exercise 1.3.1</h2>
<section id="printing-dates-in-a-friendly-format" class="level3" data-number="1.9.1">
<h3 data-number="1.9.1" class="anchored" data-anchor-id="printing-dates-in-a-friendly-format"><span class="header-section-number">1.9.1</span> Printing dates in a friendly format</h3>
<p>Because people may want to see dates in many different formats, Python comes with very flexible functions for turning <code>date</code> objects into strings.</p>
<p>Let’s see what event was recorded first in the Florida hurricane data set. In this exercise, you will format the earliest date in the <code>florida_hurricane_dates</code> list in two ways so you can decide which one you want to use: either the ISO standard or the typical US style.</p>
</section>
<section id="instructions-5" class="level3" data-number="1.9.2">
<h3 data-number="1.9.2" class="anchored" data-anchor-id="instructions-5"><span class="header-section-number">1.9.2</span> Instructions</h3>
<ul>
<li>Assign the earliest date in <code>florida_hurricane_dates</code> to first_date.</li>
<li>Print <code>first_date</code> in the ISO standard. For example, December 1st, 2000 would be “2000-12-01”.</li>
<li>Print <code>first_dat</code>e in the US style, using <code>.strftime()</code>. For example, December 1st, 2000 would be “12/1/2000”.</li>
</ul>
<div id="4d93e40d" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign the earliest date to first_date</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>first_date <span class="op">=</span> <span class="bu">min</span>(florida_hurricane_dates)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to ISO and US formats</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>iso <span class="op">=</span> <span class="st">"Our earliest hurricane date: "</span> <span class="op">+</span> first_date.isoformat()</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>us <span class="op">=</span> <span class="st">"Our earliest hurricane date: "</span> <span class="op">+</span> first_date.strftime(<span class="st">"%m/</span><span class="sc">%d</span><span class="st">/%Y"</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"ISO: "</span> <span class="op">+</span> iso)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"US: "</span> <span class="op">+</span> us)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>ISO: Our earliest hurricane date: 1950-08-31
US: Our earliest hurricane date: 08/31/1950</code></pre>
</div>
</div>
</section>
</section>
<section id="exercise-1.3.2" class="level2" data-number="1.10">
<h2 data-number="1.10" class="anchored" data-anchor-id="exercise-1.3.2"><span class="header-section-number">1.10</span> Exercise 1.3.2</h2>
<section id="representing-dates-in-different-ways" class="level3" data-number="1.10.1">
<h3 data-number="1.10.1" class="anchored" data-anchor-id="representing-dates-in-different-ways"><span class="header-section-number">1.10.1</span> Representing dates in different ways</h3>
<p><code>date</code> objects in Python have a great number of ways they can be printed out as strings. In some cases, you want to know the date in a clear, language-agnostic format. In other cases, you want something which can fit into a paragraph and flow naturally.</p>
<p>Let’s try printing out the same date, August 26, 1992 (the day that Hurricane Andrew made landfall in Florida), in a number of different ways, to practice using the <code>.strftime()</code> method.</p>
<p>A date object called <code>andrew</code> has already been created.</p>
</section>
<section id="instructions-6" class="level3" data-number="1.10.2">
<h3 data-number="1.10.2" class="anchored" data-anchor-id="instructions-6"><span class="header-section-number">1.10.2</span> Instructions</h3>
<ul>
<li>Print <code>andrew</code> in the format ‘YYYY-MM’.</li>
<li>Print <code>andrew</code> in the format ‘MONTH (YYYY)’, using <code>%B</code> for the month’s full name, which in this case will be August.</li>
<li>Print <code>andrew</code> in the format ‘YYYY-DDD’ (where DDD is the day of the year) using <code>%j</code>.</li>
</ul>
<div id="8eabcefa" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a date object</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>andrew <span class="op">=</span> date(<span class="dv">1992</span>, <span class="dv">8</span>, <span class="dv">26</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the date in the format 'YYYY-MM'</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(andrew.strftime(<span class="st">"%Y-%m"</span>))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the date in the format 'MONTH (YYYY)'</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(andrew.strftime(<span class="st">'%B (%Y)'</span>))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the date in the format 'YYYY-DDD'</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(andrew.strftime(<span class="st">'%Y-%j'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>1992-08
August (1992)
1992-239</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="sec-CHAPTER2" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> CHAPTER 2: COMBINING DATES AND TIMES</h1>
<section id="sec-Chapter2-1" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="sec-Chapter2-1"><span class="header-section-number">2.1</span> Chapter 2.1: Adding time to the mix</h2>
<p>In this chapter, you are going to move from only working with dates to working with both dates and times: the calendar day AND the time on the clock within that day.</p>
<section id="dates-and-times" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="dates-and-times"><span class="header-section-number">2.1.1</span> Dates and Times</h3>
<p>As always, let’s start with an example. Here is an example of a date and a time together: October 1, 2017, at 3:23:25 PM. Unlike before, where we were only working with the date, we’re now going to also include the time. Let’s see how to represent this in Python. The first thing we have to do is import the datetime class from the datetime package. Ideally, these would have different names, but unfortunately for historical reasons they have the same name. This is just something to get used to. We’re going to create a datetime called “dt” and populate the fields together. The first three arguments to the datetime class are exactly the same as the date class. Year, then month, then day, each as a number. Next, we fill in the hour. Computers generally use 24 hour time, meaning that 3 PM is represented as hour 15 of 24. We put in the minutes, 23 out of 60. And finally, the seconds. October 1, 2017 at 3:23:25PM is represented as a datetime in Python as 2017, 10, 1, 15, 23, 25). All of these arguments need to be whole numbers; if you want to represent point-5 seconds, you can add microseconds to your datetime. Here we’ve added 500,000 microseconds, or point-5 seconds. That is, Python breaks seconds down into millionths of a second for you when you need that kind of precision. If you need billionths of a second precision (which happens sometimes in science and finance) we’ll cover nanoseconds when we get to Pandas at the end of this course. Python defaults to 0 microseconds if you don’t include it. That’s a lot of arguments; if it helps, you can always be more explicit and use named arguments.</p>
</section>
<section id="replacing-parts-of-a-datetime" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="replacing-parts-of-a-datetime"><span class="header-section-number">2.1.2</span> Replacing parts of a datetime</h3>
<p>We can also make new datetimes from existing ones by using the <code>replace()</code> method. For example, we can take the datetime we just made, and make a new one which has the same date but is rounded down to the start of the hour. We call <code>dt.replace()</code> and set minutes, seconds, and microseconds to 0. This creates a new datetime with the same values in all the other fields, but these ones changed.</p>
</section>
<section id="capital-bikeshare" class="level3" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="capital-bikeshare"><span class="header-section-number">2.1.3</span> Capital Bikeshare</h3>
<p>Before we wrap up, let’s talk about the data we will use for the rest of this course. You will be working with data from Capital Bikeshare, the oldest municipal shared bike program in the United States. Throughout the Washington, DC area, you will find these special bike docks, where riders can pay to take a bike, ride it, and return to this or any other station in the network. We will be following one bike, ID number “W20529”, on all the trips it took in October, November, and December of 2017. Each trip consisted of a date and time when a bike was undocked from a station, then some time passed, and the date and time when W20529 was docked again.</p>
</section>
</section>
<section id="exercise-2.1.1" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="exercise-2.1.1"><span class="header-section-number">2.2</span> Exercise 2.1.1</h2>
<section id="creating-datetimes-by-hand" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="creating-datetimes-by-hand"><span class="header-section-number">2.2.1</span> Creating datetimes by hand</h3>
<p>Often you create <code>datetime</code> objects based on outside data. Sometimes though, you want to create a <code>datetime</code> object from scratch.</p>
<p>You’re going to create a few different <code>datetime</code> objects from scratch to get the hang of that process. These come from the bikeshare data set that you’ll use throughout the rest of the chapter.</p>
</section>
<section id="instructions-7" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="instructions-7"><span class="header-section-number">2.2.2</span> Instructions</h3>
<ul>
<li>Import the <code>datetime</code> class.
<ul>
<li>Create a <code>datetime</code> for October 1, 2017 at 15:26:26.</li>
<li>Print the results in ISO format.</li>
<li>Create a <code>datetime</code> for December 31, 2017 at 15:19:13.</li>
<li>Print the results in ISO format.</li>
</ul></li>
<li>Create a new datetime by replacing the year in dt with 1917 (instead of 2017)</li>
</ul>
<div id="c406ad50" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a datetime object</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> datetime(<span class="dv">2017</span>, <span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">15</span>, <span class="dv">26</span>, <span class="dv">26</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results in ISO 8601 format</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dt.isoformat())</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a datetime object</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>dt1 <span class="op">=</span> datetime(<span class="dv">2017</span>, <span class="dv">12</span>, <span class="dv">31</span>, <span class="dv">15</span>, <span class="dv">19</span>, <span class="dv">13</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results in ISO 8601 format</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dt1.isoformat())</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace the year with 1917</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>dt_old <span class="op">=</span> dt1.replace(year<span class="op">=</span><span class="dv">1917</span>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results in ISO 8601 format</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dt_old)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>2017-10-01T15:26:26
2017-12-31T15:19:13
1917-12-31 15:19:13</code></pre>
</div>
</div>
</section>
</section>
<section id="exercise-2.1.2" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="exercise-2.1.2"><span class="header-section-number">2.3</span> Exercise 2.1.2</h2>
<section id="counting-events-before-and-after-noon" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="counting-events-before-and-after-noon"><span class="header-section-number">2.3.1</span> Counting events before and after noon</h3>
<p>In this chapter, you will be working with a list of all bike trips for one Capital Bikeshare bike, W20529, from October 1, 2017 to December 31, 2017. This list has been loaded as <code>onebike_datetimes</code>.</p>
<p>Each element of the list is a dictionary with two entries: <code>Start date</code> is a <code>datetime</code> object corresponding to the start of a trip (when a bike is removed from the dock) and <code>End date</code> is a <code>datetime</code> object corresponding to the end of a trip (when a bike is put back into a dock).</p>
<p>You can use this data set to understand better how this bike was used. Did more trips start before noon or after noon?</p>
</section>
<section id="instructions-8" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="instructions-8"><span class="header-section-number">2.3.2</span> Instructions</h3>
<ul>
<li>Within the <code>for</code> loop, complete the <code>if</code> statement to check if the trip started before noon.</li>
<li>Within the <code>for</code> loop, increment <code>trip_counts['AM']</code> if the trip started before noon, and <code>trip_counts['PM']</code> if it started after noon.</li>
</ul>
<div id="386d3501" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'start' and 'end' columns to datetime format</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>rides[<span class="st">'Start date'</span>] <span class="op">=</span> pd.to_datetime(rides[<span class="st">'Start date'</span>])</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>rides[<span class="st">'End date'</span>] <span class="op">=</span> pd.to_datetime(rides[<span class="st">'End date'</span>])</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list of dictionaries with 'start' and 'end' keys</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>onebike_datetimes <span class="op">=</span> rides.<span class="bu">apply</span>(<span class="kw">lambda</span> row: {<span class="st">'Start date'</span>: row[<span class="st">'Start date'</span>], <span class="st">'End date'</span>: row[<span class="st">'End date'</span>]}, axis<span class="op">=</span><span class="dv">1</span>).tolist()</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dictionary to hold results</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>trip_counts <span class="op">=</span> {<span class="st">'AM'</span>: <span class="dv">0</span>, <span class="st">'PM'</span>: <span class="dv">0</span>}</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over all trips</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trip <span class="kw">in</span> onebike_datetimes:</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check to see if the trip starts before noon</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> trip[<span class="st">'Start date'</span>].hour <span class="op">&lt;</span> <span class="dv">12</span>:</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Increment the counter for before noon</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    trip_counts[<span class="st">'AM'</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Increment the counter for after noon</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    trip_counts[<span class="st">'PM'</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(trip_counts)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="co"># It looks like this bike is used about twice as much after noon than it is before noon. One obvious follow up would be to see _which_ hours the bike is most likely to be taken out for a ride.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>{'AM': 94, 'PM': 196}</code></pre>
</div>
</div>
</section>
</section>
<section id="chapter-2.2-printing-and-parsing-datetimes" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="chapter-2.2-printing-and-parsing-datetimes"><span class="header-section-number">2.4</span> Chapter 2.2: Printing and parsing datetimes</h2>
<p>Much like dates, datetimes can be printed in many ways. Python also has another trick: you can take a string and turn it directly into a datetime. Let’s start with printing dates and then move on to asking Python to parse them.</p>
<section id="printing-datetimes" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="printing-datetimes"><span class="header-section-number">2.4.1</span> Printing datetimes</h3>
<p>First, let’s create a datetime again. dt corresponds to December 30, 2017 at 15:19:13, the end of the last trip that W20529 takes in our data set. Just like with date objects, we use <code>strftime()</code> to create a string with a particular format. First, we’ll just print the year, month and date, using the same format codes we used for dates. % capital Y stands for the four digit year, % lowercase m for the month, and % lowercase d for the day of the month. Now we can add in the hours, minutes and seconds. Again, we print the year, month and day, and now we add three more format codes: % capital H gives us the hour, % capital M gives us the minute, and % capital S gives us the seconds. There are also format codes for 12-hour clocks, and for printing the correct AM or PM. As before, we can make these formatting strings as complicated as we need. Here’s another version of the previous string.</p>
</section>
<section id="iso-8601-format-1" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="iso-8601-format-1"><span class="header-section-number">2.4.2</span> ISO 8601 Format</h3>
<p>Finally, we can use the <code>isoformat()</code> method, just like with dates, to get a standards-compliant way of writing down a datetime. The officially correct way of writing a datetime is the year, month, day, then a capital T, then the time in 24 hour time, followed by the minute and second. When in doubt, this is a good format to use.</p>
</section>
<section id="parsing-datetimes-with-strptime" class="level3" data-number="2.4.3">
<h3 data-number="2.4.3" class="anchored" data-anchor-id="parsing-datetimes-with-strptime"><span class="header-section-number">2.4.3</span> Parsing datetimes with strptime</h3>
<p>We can also parse dates from strings, using the same format codes we used for printing. You’ll use this often when getting date and time data from the Internet since dates and times are often represented as strings. We start, as before, by importing the datetime class. The method we’re going to use is called <code>strptime()</code>, which is short for string parse time. <code>strptime()</code> takes two arguments: the first argument is the string to turn into a datetime, and the second argument is the format string that says how to do it. First we pass the string we want to parse. In this case, a string representing December 30, 2017, at 15:19:13. Then we pass the format string, which as mentioned before uses the same format codes we used with <code>strftime()</code>. In this case, first the month, then the day, then the year, all separated by slashes, then a space, and then the hour, minutes, and seconds separated by colons. You usually need to figure this out once per data set. If we look and see what kind of object we’ve made, by printing the type of <code>dt</code>, we see that we’ve got a datetime. And if we print that datetime, we get a string representation of the datetime. We can see that the parsing worked correctly. We need an exact match to do a string conversion. For example, if we leave out how to parse the time, Python will throw an error. And similarly, if there is an errant comma or other symbols, <code>strptime()</code> will not be happy.</p>
</section>
<section id="parsing-datetimes-with-python" class="level3" data-number="2.4.4">
<h3 data-number="2.4.4" class="anchored" data-anchor-id="parsing-datetimes-with-python"><span class="header-section-number">2.4.4</span> Parsing datetimes with Python</h3>
<p>Finally, there is another kind of datetime you will sometimes encounter: the Unix timestamp. Many computers store datetime information behind the scenes as the number of seconds since January 1, 1970. This date is largely considered the birth of modern-style computers. To read a Unix timestamp, use the <code>datetime.fromtimestamp()</code> method. Python will read your timestamp and return a datetime.</p>
</section>
</section>
<section id="exercise-2.2.1" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="exercise-2.2.1"><span class="header-section-number">2.5</span> Exercise 2.2.1</h2>
<section id="turning-strings-into-datetimes" class="level3" data-number="2.5.1">
<h3 data-number="2.5.1" class="anchored" data-anchor-id="turning-strings-into-datetimes"><span class="header-section-number">2.5.1</span> Turning strings into datetimes</h3>
<p>When you download data from the Internet, dates and times usually come to you as strings. Often the first step is to turn those strings into <code>datetime</code> objects.</p>
<p>In this exercise, you will practice this transformation.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><strong>Reference</strong></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>%Y</td>
<td>4 digit year (0000-9999)</td>
</tr>
<tr class="even">
<td>%m</td>
<td>2 digit month (1-12)</td>
</tr>
<tr class="odd">
<td>%d</td>
<td>2 digit day (1-31)</td>
</tr>
<tr class="even">
<td>%H</td>
<td>2 digit hour (0-23)</td>
</tr>
<tr class="odd">
<td>%M</td>
<td>2 digit minute (0-59)</td>
</tr>
<tr class="even">
<td>%S</td>
<td>2 digit second (0-59)</td>
</tr>
</tbody>
</table>
</section>
<section id="instructions-9" class="level3" data-number="2.5.2">
<h3 data-number="2.5.2" class="anchored" data-anchor-id="instructions-9"><span class="header-section-number">2.5.2</span> Instructions</h3>
<ul>
<li>Determine the format needed to convert <code>s</code> to datetime and assign it to <code>fmt</code>.
<ul>
<li>Convert the string s to datetime using fmt.</li>
</ul></li>
<li>Determine the format needed to convert <code>s1</code> to datetime and assign it to <code>fmt1</code>.
<ul>
<li>Convert the string <code>s1</code> to datetime using <code>fmt1</code>.</li>
</ul></li>
<li>Determine the format needed to convert <code>s2</code> to datetime and assign it to <code>fmt2</code>.
<ul>
<li>Convert the string <code>s2</code> to datetime using <code>fmt2</code></li>
</ul></li>
</ul>
<div id="a6575349" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Starting string, in YYYY-MM-DD HH:MM:SS format</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> <span class="st">'2017-02-03 00:00:01'</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Write a format string to parse s</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>fmt <span class="op">=</span> <span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S'</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a datetime object d</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> datetime.strptime(s, fmt)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print d</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(d)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Starting string, in YYYY-MM-DD format</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>s1 <span class="op">=</span> <span class="st">'2030-10-15'</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Write a format string to parse s</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>fmt1 <span class="op">=</span> <span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a datetime object d</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>d1 <span class="op">=</span> datetime.strptime(s1, fmt1)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Print d</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(d1)</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Starting string, in MM/DD/YYYY HH:MM:SS format</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>s2 <span class="op">=</span> <span class="st">'12/15/1986 08:00:00'</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Write a format string to parse s</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>fmt2 <span class="op">=</span> <span class="st">'%m/</span><span class="sc">%d</span><span class="st">/%Y %H:%M:%S'</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a datetime object d</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>d2 <span class="op">=</span> datetime.strptime(s2, fmt2)</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Print d</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(d2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>2017-02-03 00:00:01
2030-10-15 00:00:00
1986-12-15 08:00:00</code></pre>
</div>
</div>
</section>
</section>
<section id="exercise-2.2.2" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="exercise-2.2.2"><span class="header-section-number">2.6</span> Exercise 2.2.2</h2>
<section id="parsing-pairs-of-strings-as-datetimes" class="level3" data-number="2.6.1">
<h3 data-number="2.6.1" class="anchored" data-anchor-id="parsing-pairs-of-strings-as-datetimes"><span class="header-section-number">2.6.1</span> Parsing pairs of strings as datetimes</h3>
<p>Up until now, you’ve been working with a pre-processed list of datetimes for W20529’s trips. For this exercise, you’re going to go one step back in the data cleaning pipeline and work with the strings that the data started as.</p>
<p>Explore <code>onebike_datetime_strings</code> in the IPython shell to determine the correct format.</p>
</section>
<section id="instructions-10" class="level3" data-number="2.6.2">
<h3 data-number="2.6.2" class="anchored" data-anchor-id="instructions-10"><span class="header-section-number">2.6.2</span> Instructions</h3>
<ul>
<li>Outside the <code>for</code> loop, fill out the <code>fmt</code> string with the correct parsing format for the data.</li>
<li>Within the <code>for</code> loop, parse the <code>start</code> and <code>end</code> strings into the <code>trip</code> dictionary with <code>Start date</code> and <code>End date</code> keys and <code>datetime</code> objects for values.</li>
</ul>
<div id="735c6a46" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert specific columns to lists</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>selected_columns <span class="op">=</span> [<span class="st">'Start date'</span>, <span class="st">'End date'</span>]</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>onebike_datetime_strings <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(rides[<span class="st">'Start date'</span>].astype(<span class="bu">str</span>), rides[<span class="st">'End date'</span>].astype(<span class="bu">str</span>)))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Write down the format string</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>fmt <span class="op">=</span> <span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S"</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize a list for holding the pairs of datetime objects</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>onebike_datetimes <span class="op">=</span> []</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over all trips</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> start, end <span class="kw">in</span> onebike_datetime_strings:</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  trip <span class="op">=</span> {<span class="st">'start'</span>: datetime.strptime(start, fmt),</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>          <span class="st">'end'</span>: datetime.strptime(end, fmt)}</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Append the trip</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  onebike_datetimes.append(trip)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Many complex data cleaning tasks follow this same format: start with a list, process each element, and add the processed data to a new list.</strong></p>
</section>
</section>
<section id="exercise-2.2.3" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="exercise-2.2.3"><span class="header-section-number">2.7</span> Exercise 2.2.3</h2>
<section id="recreating-iso-format-with-strftime" class="level3" data-number="2.7.1">
<h3 data-number="2.7.1" class="anchored" data-anchor-id="recreating-iso-format-with-strftime"><span class="header-section-number">2.7.1</span> Recreating ISO format with strftime()</h3>
<p>In the last chapter, you used <code>strftime()</code> to create strings from <code>date</code> objects. Now that you know about <code>datetime</code> objects, let’s practice doing something similar.</p>
<p>Re-create the <code>.isoformat()</code> method, using <code>.strftime()</code>, and print the first trip start in our data set.</p>
</section>
<section id="instructions-11" class="level3" data-number="2.7.2">
<h3 data-number="2.7.2" class="anchored" data-anchor-id="instructions-11"><span class="header-section-number">2.7.2</span> Instructions</h3>
<ul>
<li>Complete <code>fmt</code> to match the format of ISO 8601.</li>
<li>Print <code>first_start</code> with both <code>.isoformat()</code> and <code>.strftime()</code>; they should match.</li>
</ul>
<div id="110e6fc9" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pull out the start of the first trip</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>first_start <span class="op">=</span> onebike_datetimes[<span class="dv">0</span>][<span class="st">'start'</span>]</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Format to feed to strftime()</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>fmt <span class="op">=</span> <span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">T%H:%M:%S"</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print out date with .isoformat(), then with .strftime() to compare</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(first_start.isoformat())</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(first_start.strftime(fmt))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>2017-10-01T15:23:25
2017-10-01T15:23:25</code></pre>
</div>
</div>
</section>
</section>
<section id="exercise-2.2.4" class="level2" data-number="2.8">
<h2 data-number="2.8" class="anchored" data-anchor-id="exercise-2.2.4"><span class="header-section-number">2.8</span> Exercise 2.2.4</h2>
<section id="unix-timestamps" class="level3" data-number="2.8.1">
<h3 data-number="2.8.1" class="anchored" data-anchor-id="unix-timestamps"><span class="header-section-number">2.8.1</span> Unix timestamps</h3>
<p>Datetimes are sometimes stored as Unix timestamps: the number of seconds since January 1, 1970. This is especially common with computer infrastructure, like the log files that websites keep when they get visitors.</p>
</section>
<section id="instructions-12" class="level3" data-number="2.8.2">
<h3 data-number="2.8.2" class="anchored" data-anchor-id="instructions-12"><span class="header-section-number">2.8.2</span> Instructions</h3>
<ul>
<li>Complete the <code>for</code> loop to loop over <code>timestamps</code>.</li>
<li>Complete the code to turn each timestamp <code>ts</code> into a <code>datetime</code>.</li>
</ul>
<div id="37967776" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Starting timestamps</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>timestamps <span class="op">=</span> [<span class="dv">1514665153</span>, <span class="dv">1514664543</span>]</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Datetime objects</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>dts <span class="op">=</span> []</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ts <span class="kw">in</span> timestamps:</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  dts.append(datetime.fromtimestamp(ts))</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[datetime.datetime(2017, 12, 30, 21, 19, 13), datetime.datetime(2017, 12, 30, 21, 9, 3)]</code></pre>
</div>
</div>
</section>
</section>
<section id="chapter-2.3-working-with-durations" class="level2" data-number="2.9">
<h2 data-number="2.9" class="anchored" data-anchor-id="chapter-2.3-working-with-durations"><span class="header-section-number">2.9</span> Chapter 2.3: Working with durations</h2>
<p>Much like dates, datetimes have a kind of arithmetic; we can compare them, subtract them, and add intervals to them. Because we are working with both days and times, the logic for durations is a little more complicated, but not by much. Let’s have a look. Just as with dates, to get a sense for what’s going on we put our datetimes on a timeline. These two datetimes here correspond to the start and end of one ride in our data set. To follow along in Python, we’ll load these two in as “start” and “end”. When we subtract datetimes, we get a timedelta. A timedelta represents what is called a duration: the elapsed time between events. When we call the method <code>total_seconds()</code>, we get back the number of seconds that our timedelta represents. In this case, 1450 seconds elapsed between our start and end. 1450 seconds is 24 minutes and 10 seconds.</p>
<section id="creating-timedeltas" class="level3" data-number="2.9.1">
<h3 data-number="2.9.1" class="anchored" data-anchor-id="creating-timedeltas"><span class="header-section-number">2.9.1</span> Creating timedeltas</h3>
<p>You can also create a timedelta by hand. You start by importing timedelta from datetime. To create a timedelta, you specify the amount of time which has elapsed. For example, we make delta1, a timedelta which corresponds to a one second duration. Now when we add delta1 to start, we see that we get back a datetime which is one second later. We also create a timedelta, delta2, which is one day and one second in duration. Now when we add it to start, we get a new datetime which is the next day and one second later. Timedeltas can be created with any number of weeks, days, minutes, hours, seconds, or microseconds, and can be as small as a microsecond or as large as 2-point-7 million years.</p>
</section>
<section id="negative-timedeltas" class="level3" data-number="2.9.2">
<h3 data-number="2.9.2" class="anchored" data-anchor-id="negative-timedeltas"><span class="header-section-number">2.9.2</span> Negative timedeltas</h3>
<p>Timedeltas can also be negative. For example, if we create delta3, whose argument is -1 weeks, and we add it to start we get a datetime corresponding to one week earlier. We can also subtract a positive timedelta and get the same result. We create delta4, which corresponds to a 1 week duration, and we subtract it from start. As you can see, we get the same answer as when we added a negative timedelta.</p>
</section>
</section>
<section id="exercise-2.3.1" class="level2" data-number="2.10">
<h2 data-number="2.10" class="anchored" data-anchor-id="exercise-2.3.1"><span class="header-section-number">2.10</span> Exercise 2.3.1</h2>
<section id="turning-pairs-of-datetimes-into-durations" class="level3" data-number="2.10.1">
<h3 data-number="2.10.1" class="anchored" data-anchor-id="turning-pairs-of-datetimes-into-durations"><span class="header-section-number">2.10.1</span> Turning pairs of datetimes into durations</h3>
<p>When working with timestamps, we often want to know how much time has elapsed between events. Thankfully, we can use <code>datetime</code> arithmetic to ask Python to do the heavy lifting for us so we don’t need to worry about day, month, or year boundaries. Let’s calculate the number of seconds that the bike was out of the dock for each trip.</p>
<p>Continuing our work from a previous coding exercise, the bike trip data has been loaded as the list <code>onebike_datetimes</code>. Each element of the list consists of two datetime objects, corresponding to the <code>start</code> and <code>end</code> of a trip, respectively.</p>
</section>
<section id="instructions-13" class="level3" data-number="2.10.2">
<h3 data-number="2.10.2" class="anchored" data-anchor-id="instructions-13"><span class="header-section-number">2.10.2</span> Instructions</h3>
<ul>
<li>Within the loop:
<ul>
<li>Use arithmetic on the <code>start</code> and <code>end</code> elements to find the length of the trip</li>
<li>Save the results to <code>trip_duration</code>.</li>
<li>Calculate <code>trip_length_seconds</code> from <code>trip_duration</code>.</li>
</ul></li>
</ul>
<div id="093e4053" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize a list for all the trip durations</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>onebike_durations <span class="op">=</span> []</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trip <span class="kw">in</span> onebike_datetimes:</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a timedelta object corresponding to the length of the trip</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  trip_duration <span class="op">=</span> trip[<span class="st">'end'</span>] <span class="op">-</span> trip[<span class="st">'start'</span>]</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the total elapsed seconds in trip_duration</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  trip_length_seconds <span class="op">=</span> trip_duration.total_seconds()</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Append the results to our list</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  onebike_durations.append(trip_length_seconds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="exercise-2.3.2" class="level2" data-number="2.11">
<h2 data-number="2.11" class="anchored" data-anchor-id="exercise-2.3.2"><span class="header-section-number">2.11</span> Exercise 2.3.2</h2>
<section id="average-trip-time" class="level3" data-number="2.11.1">
<h3 data-number="2.11.1" class="anchored" data-anchor-id="average-trip-time"><span class="header-section-number">2.11.1</span> Average trip time</h3>
<p>W20529 took 291 trips in our data set. How long were the trips on average? We can use the built-in Python functions <code>sum()</code> and <code>len()</code> to make this calculation.</p>
<p>Based on your last coding exercise, the data has been loaded as <code>onebike_durations</code>. Each entry is a number of seconds that the bike was out of the dock.</p>
</section>
<section id="instructions-14" class="level3" data-number="2.11.2">
<h3 data-number="2.11.2" class="anchored" data-anchor-id="instructions-14"><span class="header-section-number">2.11.2</span> Instructions</h3>
<ul>
<li>Calculate <code>total_elapsed_time</code> across all trips in <code>onebike_durations</code>.</li>
<li>Calculate <code>number_of_trips</code> for <code>onebike_durations</code>.</li>
<li>Divide <code>total_elapsed_time</code> by <code>number_of_trips</code> to get the <code>average trip length</code>.</li>
</ul>
<div id="7b70e6f1" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># What was the total duration of all trips?</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>total_elapsed_time <span class="op">=</span> <span class="bu">sum</span>(onebike_durations)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># What was the total number of trips?</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>number_of_trips <span class="op">=</span> <span class="bu">len</span>(onebike_durations)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Divide the total duration by the number of trips</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(total_elapsed_time <span class="op">/</span> number_of_trips)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>1178.9310344827586</code></pre>
</div>
</div>
</section>
</section>
<section id="exercise-2.3.3" class="level2" data-number="2.12">
<h2 data-number="2.12" class="anchored" data-anchor-id="exercise-2.3.3"><span class="header-section-number">2.12</span> Exercise 2.3.3</h2>
<section id="the-long-and-the-short-of-why-time-is-hard" class="level3" data-number="2.12.1">
<h3 data-number="2.12.1" class="anchored" data-anchor-id="the-long-and-the-short-of-why-time-is-hard"><span class="header-section-number">2.12.1</span> The long and the short of why time is hard</h3>
<p>Out of 291 trips taken by W20529, how long was the longest? How short was the shortest? Does anything look fishy?</p>
</section>
<section id="instructions-15" class="level3" data-number="2.12.2">
<h3 data-number="2.12.2" class="anchored" data-anchor-id="instructions-15"><span class="header-section-number">2.12.2</span> Instructions</h3>
<ul>
<li>Calculate <code>shortest_trip</code> from <code>onebike_durations</code>.</li>
<li>Calculate <code>longest_trip</code> from <code>onebike_durations</code>.</li>
<li>Print the results, turning <code>shortest_trip</code> and <code>longest_trip</code> into strings so they can print.</li>
</ul>
<div id="bd754801" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate shortest and longest trips</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>shortest_trip <span class="op">=</span> <span class="bu">min</span>(onebike_durations)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>longest_trip <span class="op">=</span> <span class="bu">max</span>(onebike_durations)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Print out the results</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The shortest trip was "</span> <span class="op">+</span> <span class="bu">str</span>(shortest_trip) <span class="op">+</span> <span class="st">" seconds"</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The longest trip was "</span> <span class="op">+</span> <span class="bu">str</span>(longest_trip) <span class="op">+</span> <span class="st">" seconds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The shortest trip was -3346.0 seconds
The longest trip was 76913.0 seconds</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="sec-CHAPTER3" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> CHAPTER 3: TIME ZONES AND DAYLIGHT SAVING</h1>
<section id="sec-Chapter3-1" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="sec-Chapter3-1"><span class="header-section-number">3.1</span> Chapter 3.1: UTC offsets</h2>
<p>Sometimes, you really need to know exactly when something happened. Up until now, the datetime objects you have worked with are what is called “naive”, and can’t be compared across different parts of the world. They don’t know anything about their time zone.</p>
<section id="time-zones" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="time-zones"><span class="header-section-number">3.1.1</span> Time zones</h3>
<p>Why does this matter? Before time zones, each town or city set its clock so that noon was directly overhead. Another city 100 miles away would also set their clocks to be noon when the sun was overhead. But this meant that these two cities had clocks that were different, by maybe 15 or 20 minutes. When people moved by foot or horseback, this wasn’t a problem. Then railroads, and later telegraphs, came into existence. Now you could move or communicate with someone 100 or even 1000 miles away fast enough that time had to be consistent. Governments solved this problem by declaring that all clocks within a wide area would agree on the hour, even if some were ahead or behind of their solar time. The United States, for example, has 4 major time zones, plus one for Alaska and another for Hawaii. Our bike data was collected in Washington, DC, which observes Eastern time.</p>
</section>
<section id="utc" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="utc"><span class="header-section-number">3.1.2</span> UTC</h3>
<p>But since we’re not using the sun anymore, how do we know how to set the clock? Because the United Kingdom was the first to standardize its time, everyone in the world sets their clocks relative to the original historical UK standard. This standard time is called UTC. Because all clocks are set relative to UTC, we can compare time around the world. Generally, clocks west of the UK are set earlier than UTC, and clocks east of the UK are set later than UTC. For example, the eastern United States is typically UTC minus 5 hours, while India is typically UTC plus 5 hours 30 minutes. Let’s see this in code. As before, you import datetime and timedelta. Now you also import timezone. This will let you specify what timezone the clock was in when our data was recorded. We create a timezone object, which accepts a timedelta that explains how to translate your datetime into UTC. In this case, since the clock that measured our bicycle data set was five hours behind UTC, we create ET to be at UTC-5. We can specify what time zone the clock was in when the last ride started in our data set. The clock that recorded the ride was 5 hours behind UTC. Now if you print it, your datetime includes the UTC offset. Making a datetime “aware” of its timezone means you can ask Python new questions. For example, suppose you want to know what the date and time would have been if the clock had been set to India Standard Time instead. First, create a new timezone object set to UTC plus 5 hours 30 minutes. Now use the <code>astimezone()</code> method to ask Python to create a new datetime object corresponding to the same moment, but adjusted to a different time zone. In this case, because clocks in India would have been set 10-point-5 hours ahead of clocks on the eastern US, the last ride would have taken place on December 31, at 1 hour, 39 minutes, and 3 seconds past midnight local time. Same moment, different clock.</p>
</section>
<section id="adjusting-timezone-vs-changing-tzinfo" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="adjusting-timezone-vs-changing-tzinfo"><span class="header-section-number">3.1.3</span> Adjusting timezone vs changing tzinfo</h3>
<p>Finally, there is an important difference between adjusting timezones and changing the <code>tzinfo</code> directly. You can set the <code>tzinfo</code> directly, using the <code>replace()</code> method. Here we’ve set the <code>tzinfo</code> to be <code>timezone.utc</code>, a convenient object with zero UTC offset. The clock stays the same, but the UTC offset has shifted. Or, just like before, you can call the <code>astimezone()</code> method. Now if we adjust into UTC with astimezone(<code>timezone.utc</code>), we change both the UTC offset and the clock itself.</p>
</section>
</section>
<section id="exercise-3.1.1" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="exercise-3.1.1"><span class="header-section-number">3.2</span> Exercise 3.1.1</h2>
<section id="creating-timezone-aware-datetimes" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="creating-timezone-aware-datetimes"><span class="header-section-number">3.2.1</span> Creating timezone aware datetimes</h3>
<p>In this exercise, you will practice setting timezones manually.</p>
</section>
<section id="instructions-16" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="instructions-16"><span class="header-section-number">3.2.2</span> Instructions</h3>
<ul>
<li>Import <code>timezone</code>.
<ul>
<li>Set the <code>tzinfo</code> to <code>UTC</code>, without using <code>timedelta</code>.</li>
</ul></li>
<li>Set <code>pst</code> to be a timezone set for UTC-8.
<ul>
<li>Set <code>dt1</code>’s timezone to be <code>pst</code>.</li>
</ul></li>
<li>Set <code>aedt</code> to be a timezone set for UTC+11.
<ul>
<li>Set <code>dt2</code>’s timezone to be <code>aedt</code>.</li>
</ul></li>
</ul>
<div id="4fb7c136" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># October 1, 2017 at 15:26:26, UTC</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> datetime(<span class="dv">2017</span>, <span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">15</span>, <span class="dv">26</span>, <span class="dv">26</span>, tzinfo<span class="op">=</span>timezone.utc)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dt.isoformat())</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a timezone for Pacific Standard Time, or UTC-8</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>pst <span class="op">=</span> timezone(timedelta(hours<span class="op">=-</span><span class="dv">8</span>))</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co"># October 1, 2017 at 15:26:26, UTC-8</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>dt1 <span class="op">=</span> datetime(<span class="dv">2017</span>, <span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">15</span>, <span class="dv">26</span>, <span class="dv">26</span>, tzinfo<span class="op">=</span>pst)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dt1.isoformat())</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a timezone for Australian Eastern Daylight Time, or UTC+11</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>aedt <span class="op">=</span> timezone(timedelta(hours<span class="op">=</span><span class="dv">11</span>))</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="co"># October 1, 2017 at 15:26:26, UTC+11</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>dt2 <span class="op">=</span> datetime(<span class="dv">2017</span>, <span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">15</span>, <span class="dv">26</span>, <span class="dv">26</span>, tzinfo<span class="op">=</span>aedt)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dt2.isoformat())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>2017-10-01T15:26:26+00:00
2017-10-01T15:26:26-08:00
2017-10-01T15:26:26+11:00</code></pre>
</div>
</div>
</section>
</section>
<section id="exercise-3.1.2" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="exercise-3.1.2"><span class="header-section-number">3.3</span> Exercise 3.1.2</h2>
<section id="setting-timezones" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="setting-timezones"><span class="header-section-number">3.3.1</span> Setting timezones</h3>
<p>Now that you have the hang of setting timezones one at a time, let’s look at setting them for the first ten trips that W20529 took.</p>
<p>Make the change using <code>.replace()</code></p>
</section>
<section id="instructions-17" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="instructions-17"><span class="header-section-number">3.3.2</span> Instructions</h3>
<ul>
<li>Create <code>edt</code>, a <code>timezone</code> object whose UTC offset is -4 hours.</li>
<li>Within the <code>for</code> loop:</li>
<li>Set the <code>tzinfo</code> for <code>trip['start']</code>.</li>
<li>Set the <code>tzinfo</code> for <code>trip['end']</code>.</li>
</ul>
<div id="32c0cbd0" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a timezone object corresponding to UTC-4</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>edt <span class="op">=</span> timezone(timedelta(hours<span class="op">=-</span><span class="dv">4</span>))</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over trips, updating the start and end datetimes to be in UTC-4</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trip <span class="kw">in</span> onebike_datetimes[:<span class="dv">10</span>]:</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Update trip['start'] and trip['end']</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  trip[<span class="st">'start'</span>] <span class="op">=</span> trip[<span class="st">'start'</span>].replace(tzinfo<span class="op">=</span>edt)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  trip[<span class="st">'end'</span>] <span class="op">=</span> trip[<span class="st">'end'</span>].replace(tzinfo<span class="op">=</span>edt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="exercise-3.1.3" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="exercise-3.1.3"><span class="header-section-number">3.4</span> Exercise 3.1.3</h2>
<section id="what-time-did-the-bike-leave-in-utc" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="what-time-did-the-bike-leave-in-utc"><span class="header-section-number">3.4.1</span> What time did the bike leave in UTC?</h3>
<p>Having set the timezone for the first ten rides that W20529 took, let’s see what time the bike left in UTC.</p>
</section>
<section id="instructions-18" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="instructions-18"><span class="header-section-number">3.4.2</span> Instructions</h3>
<ul>
<li>Within the <code>for</code> loop, move <code>dt</code> to be in UTC. Use <code>timezone.utc</code> as a convenient shortcut for UTC.</li>
</ul>
<div id="81a5d3a9" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over the trips</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trip <span class="kw">in</span> onebike_datetimes[:<span class="dv">10</span>]:</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pull out the start</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  dt3 <span class="op">=</span> trip[<span class="st">'start'</span>]</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Move dt to be in UTC</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  dt3 <span class="op">=</span> dt3.astimezone(timezone.utc)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the start time in UTC</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">'Original:'</span>, trip[<span class="st">'start'</span>], <span class="st">'| UTC:'</span>, dt3.isoformat())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Original: 2017-10-01 15:23:25-04:00 | UTC: 2017-10-01T19:23:25+00:00
Original: 2017-10-01 15:42:57-04:00 | UTC: 2017-10-01T19:42:57+00:00
Original: 2017-10-02 06:37:10-04:00 | UTC: 2017-10-02T10:37:10+00:00
Original: 2017-10-02 08:56:45-04:00 | UTC: 2017-10-02T12:56:45+00:00
Original: 2017-10-02 18:23:48-04:00 | UTC: 2017-10-02T22:23:48+00:00
Original: 2017-10-02 18:48:08-04:00 | UTC: 2017-10-02T22:48:08+00:00
Original: 2017-10-02 19:18:10-04:00 | UTC: 2017-10-02T23:18:10+00:00
Original: 2017-10-02 19:37:32-04:00 | UTC: 2017-10-02T23:37:32+00:00
Original: 2017-10-03 08:24:16-04:00 | UTC: 2017-10-03T12:24:16+00:00
Original: 2017-10-03 18:17:07-04:00 | UTC: 2017-10-03T22:17:07+00:00</code></pre>
</div>
</div>
</section>
</section>
<section id="chapter-3.2-time-zone-database" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="chapter-3.2-time-zone-database"><span class="header-section-number">3.5</span> Chapter 3.2: Time zone database</h2>
<p>Now that you understand how UTC offsets work, it’s time to talk about how you use timezones in practice. This is a picture of all of the different time zones in the world, as of 2017. They cut across countries, and within countries, and sometimes one is even totally surrounded by another one. How could you possibly know all of these when you need to align your data to UTC? Do you need to look up the offset for each one in some big spreadsheet somewhere? Can’t a computer help with this? Thankfully, yes. There is a database called tz, updated 3-4 times a year as timezone rules change. This database is used by computer programs across many programming languages. Because timezone information changes so quickly, it doesn’t make sense to bundle it directly into Python. Instead, you will use a package called <code>dateutil</code>. Let’s start by making a <code>timezone</code> object that corresponds to the eastern United States, where our bicycle data comes from. Within tz, time zones are defined first by the continent they are on, and then by the nearest major city. For example, the time zone used on the eastern seaboard of the United States is ‘America/New York’. We fetch this <code>timezone</code> by calling <code>tz.gettz()</code>, and passing ‘America/New York’ as the string. Here are a few more examples: ‘America/Mexico_City’. ‘Europe/London’. ‘Africa/Accra’. Let’s look at our last ride again. Instead of specifying the UTC offset yourself, you pass the timezone you got from tz. Look at the result, and you can see that it’s got the right UTC offset. Even more excitingly, this same object will adjust the UTC offset depending on the date and time. If we call <code>datetime()</code> with the time of our first ride, and pass in the same timezone info, we see that it gives us a different UTC offset. We will discuss daylight savings time in the next lesson, but suffice to say that in some places the clocks change twice a year. Instead of having to look up when these things change, we just ask the timezone database to know for us. tz includes rules for UTC offsets going all the way back to the late 1960s, and sometimes earlier. If you have data stretching over a long period of time, and you really care about getting the exact hours and minutes correct, you can use tz to put all of your date and timestamps on to a common scale.</p>
</section>
<section id="exercise-3.2.1" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="exercise-3.2.1"><span class="header-section-number">3.6</span> Exercise 3.2.1</h2>
<section id="putting-the-bike-trips-into-the-right-time-zone" class="level3" data-number="3.6.1">
<h3 data-number="3.6.1" class="anchored" data-anchor-id="putting-the-bike-trips-into-the-right-time-zone"><span class="header-section-number">3.6.1</span> Putting the bike trips into the right time zone</h3>
<p>Instead of setting the timezones for W20529 by hand, let’s assign them to their IANA timezone: ‘America/New_York’. Since we know their political jurisdiction, we don’t need to look up their UTC offset. Python will do that for us.</p>
</section>
<section id="instructions-19" class="level3" data-number="3.6.2">
<h3 data-number="3.6.2" class="anchored" data-anchor-id="instructions-19"><span class="header-section-number">3.6.2</span> Instructions</h3>
<ul>
<li>Import <code>tz</code> from <code>dateutil</code>.</li>
<li>Assign <code>et</code> to be the timezone <code>'America/New_York'</code>.</li>
<li>Within the <code>for</code> loop, set <code>start</code> and <code>end</code> to have <code>et</code> as their timezone (use <code>.replace()</code>).</li>
</ul>
<div id="d14643ec" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># Import tz</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dateutil <span class="im">import</span> tz </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a timezone object for Eastern Time</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>et <span class="op">=</span> tz.gettz(<span class="st">'America/New_York'</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over trips, updating the datetimes to be in Eastern Time</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trip <span class="kw">in</span> onebike_datetimes[:<span class="dv">10</span>]:</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Update trip['start'] and trip['end']</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  trip[<span class="st">'start'</span>] <span class="op">=</span> trip[<span class="st">'start'</span>].replace(tzinfo<span class="op">=</span>et)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  trip[<span class="st">'end'</span>] <span class="op">=</span> trip[<span class="st">'end'</span>].replace(tzinfo<span class="op">=</span>et)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="exercise-3.2.2" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="exercise-3.2.2"><span class="header-section-number">3.7</span> Exercise 3.2.2</h2>
<section id="what-time-did-the-bike-leave-global-edition" class="level3" data-number="3.7.1">
<h3 data-number="3.7.1" class="anchored" data-anchor-id="what-time-did-the-bike-leave-global-edition"><span class="header-section-number">3.7.1</span> What time did the bike leave? (Global edition)</h3>
<p>When you need to move a datetime from one <code>timezone</code> into another, use <code>.astimezone()</code> and <code>tz</code>. Often you will be moving things into UTC, but for fun let’s try moving things from ‘America/New_York’ into a few different time zones.</p>
</section>
<section id="instructions-20" class="level3" data-number="3.7.2">
<h3 data-number="3.7.2" class="anchored" data-anchor-id="instructions-20"><span class="header-section-number">3.7.2</span> Instructions</h3>
<ul>
<li>Set <code>uk</code> to be the timezone for the UK: ‘Europe/London’.
<ul>
<li>Change <code>local</code> to be in the <code>uk</code> timezone and assign it to <code>notlocal</code>.</li>
</ul></li>
<li>Set <code>ist</code> to be the timezone for India: ‘Asia/Kolkata’.
<ul>
<li>Change <code>local1</code> to be in the <code>ist</code> timezone and assign it to <code>notlocal1</code>.</li>
</ul></li>
<li>Set <code>sm</code> to be the timezone for Samoa: ‘Pacific/Apia’.
<ul>
<li>Change <code>local2</code> to be in the <code>sm</code> timezone and assign it to <code>notlocal2</code>.</li>
</ul></li>
</ul>
<div id="5cf07142" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the timezone object</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>uk <span class="op">=</span> tz.gettz(<span class="st">'Europe/London'</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Pull out the start of the first trip</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>local <span class="op">=</span> onebike_datetimes[<span class="dv">0</span>][<span class="st">'start'</span>]</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co"># What time was it in the UK?</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>notlocal <span class="op">=</span> local.astimezone(uk)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print them out and see the difference</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(local.isoformat())</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(notlocal.isoformat())</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the timezone object</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>ist <span class="op">=</span> tz.gettz(<span class="st">'Asia/Kolkata'</span>)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Pull out the start of the first trip</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>local1 <span class="op">=</span> onebike_datetimes[<span class="dv">0</span>][<span class="st">'start'</span>]</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="co"># What time was it in India?</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>notlocal1 <span class="op">=</span> local1.astimezone(ist)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Print them out and see the difference</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(local1.isoformat())</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(notlocal1.isoformat())</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the timezone object</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>sm <span class="op">=</span> tz.gettz(<span class="st">'Pacific/Apia'</span>)</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Pull out the start of the first trip</span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>local2 <span class="op">=</span> onebike_datetimes[<span class="dv">0</span>][<span class="st">'start'</span>]</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a><span class="co"># What time was it in Samoa?</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>notlocal2 <span class="op">=</span> local2.astimezone(sm)</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Print them out and see the difference</span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(local2.isoformat())</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(notlocal2.isoformat())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>2017-10-01T15:23:25-04:00
2017-10-01T20:23:25+01:00
2017-10-01T15:23:25-04:00
2017-10-02T00:53:25+05:30
2017-10-01T15:23:25-04:00
2017-10-02T09:23:25+14:00</code></pre>
</div>
</div>
</section>
<section id="sec-Chapter3-3" class="level3" data-number="3.7.3">
<h3 data-number="3.7.3" class="anchored" data-anchor-id="sec-Chapter3-3"><span class="header-section-number">3.7.3</span> Chapter 3.3: Starting Daylight Saving Time</h3>
<p>Some places change their clocks twice a year to create longer summer evenings. This practice is called daylight saving time, but it would better be called daylight shifting time. In some countries it is called “summer time”. Dealing with daylight saving time can be one of the most fiendish challenges in dealing with dates and times. To keep things simple, let’s start with the situation where the clocks move forward in the spring. In the next lesson, we’ll discuss handling the opposite case, when the clocks move back in the fall. Let’s look at an example. On March 12, 2017, in Washington, DC, the clock jumped straight from 1:59 am to 3 am. The clock “springs forward”. It never officially struck 2 am anywhere on the East Coast of the United States that day. Just like before, to make our clock in Washington, DC comparable to clocks in other places, we need to represent it with a UTC offset. Only now the UTC offset is going to change. On this date, at 1 AM in Washington, DC, we were in Eastern Standard Time. It was 6 AM UTC, a five-hour difference. At 3 AM in Washington, DC, we were in Eastern Daylight Time. It was 7 AM UTC, a four-hour difference. Let’s see the same thing in code. To be as clear as possible, let’s create the UTC offsets by hand for now instead of using <code>dateutil.tz</code> . We start by creating a datetime object, spring_ahead_159am, for March 12th, at 1:59:59, without any <code>timezone</code> information. We print the results out with <code>isoformat()</code> to check that we have the time right, and we make another object for spring_ahead_3am. We subtract the two <code>datetime</code> objects and ask how much time has elapsed by calling <code>total_seconds()</code>. As expected, they’re an hour and one second apart. As before, to fix problems with comparing datetimes we start by creating timezone objects. We define Eastern Standard Time, or EST, using the <code>timezone</code> constructor. We set the offset to -5 hours. Similarly, we define Eastern Daylight Time, or EDT, with an offset of -4 hours. We assign our first timestamp, at 1:59 am to be in EST. When we call <code>isoformat()</code>, we see it has the correct offset. We assign our second timestamp, at 3:00 am, to be in EDT, and again check the output with <code>isoformat()</code>. When we subtract the two datetime objects, we see correctly that one second has elapsed. Putting things in terms of UTC once again allowed us to make proper comparisons. But how do we know when the cutoff is without looking it up ourselves? <code>dateuti</code>l to the rescue again. Just like before when it saved us from having to define <code>timezones</code> by hand, <code>dateutil</code> saves us from having to know daylight savings rules. We create a <code>timezone</code> object by calling <code>tz.gettz()</code> and pass our timezone description string. Recall that since Washington, DC is in the America/New_York time zone, that’s what we use. Once again we create a datetime corresponding to 1:59 am on the day that the east coast of the US springs forward. This time though, we set the tzinfo to eastern time. Similarly, we create a datetime set to 3 am on March 12th, and when we set tzinfo to be eastern time, <code>dateutil</code> figures out for us that it should be in EDT.</p>
</section>
</section>
<section id="exercise-3.3.1" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="exercise-3.3.1"><span class="header-section-number">3.8</span> Exercise 3.3.1</h2>
<section id="how-many-hours-elapsed-around-daylight-saving" class="level3" data-number="3.8.1">
<h3 data-number="3.8.1" class="anchored" data-anchor-id="how-many-hours-elapsed-around-daylight-saving"><span class="header-section-number">3.8.1</span> How many hours elapsed around daylight saving?</h3>
<p>Since our bike data takes place in the fall, you’ll have to do something else to learn about the start of daylight savings time.</p>
<p>Let’s look at March 12, 2017, in the Eastern United States, when Daylight Saving kicked in at 2 AM.</p>
<p>If you create a <code>datetime</code> for midnight that night, and add 6 hours to it, how much time will have elapsed?</p>
</section>
<section id="instructions-21" class="level3" data-number="3.8.2">
<h3 data-number="3.8.2" class="anchored" data-anchor-id="instructions-21"><span class="header-section-number">3.8.2</span> Instructions</h3>
<ul>
<li>You already have a <code>datetime</code> called <code>start</code>, set for March 12, 2017 at midnight, set to the timezone <code>'America/New_York'</code>.</li>
</ul>
<p>Add six hours to <code>start</code> and assign it to <code>end</code>. Look at the UTC offset for the two results.</p>
<ul>
<li>You added 6 hours, and got 6 AM, despite the fact that the clocks springing forward means only 5 hours would have actually elapsed!</li>
</ul>
<p>Calculate the time between <code>start</code> and <code>end</code>. How much time does Python think has elapsed?</p>
<ul>
<li>Move your <code>datetime</code> objects into UTC and calculate the elapsed time again.</li>
</ul>
<p>Once you’re in UTC, what result do you get?</p>
<div id="9575d7ef" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Start on March 12, 2017, midnight, then add 6 hours</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> datetime(<span class="dv">2017</span>, <span class="dv">3</span>, <span class="dv">12</span>, tzinfo <span class="op">=</span> tz.gettz(<span class="st">'America/New_York'</span>))</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>end <span class="op">=</span> start <span class="op">+</span>  timedelta(hours<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(start.isoformat() <span class="op">+</span> <span class="st">" to "</span> <span class="op">+</span> end.isoformat())</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co"># How many hours have elapsed?</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>((end <span class="op">-</span> start).total_seconds()<span class="op">/</span>(<span class="dv">60</span><span class="op">*</span><span class="dv">60</span>))</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co"># What if we move to UTC?</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>((end.astimezone(timezone.utc) <span class="op">-</span> start.astimezone(timezone.utc))<span class="op">\</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>      .total_seconds()<span class="op">/</span>(<span class="dv">60</span><span class="op">*</span><span class="dv">60</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>2017-03-12T00:00:00-05:00 to 2017-03-12T06:00:00-04:00
6.0
5.0</code></pre>
</div>
</div>
</section>
</section>
<section id="exercise-3.3.2" class="level2" data-number="3.9">
<h2 data-number="3.9" class="anchored" data-anchor-id="exercise-3.3.2"><span class="header-section-number">3.9</span> Exercise 3.3.2</h2>
<section id="march-29-throughout-a-decade" class="level3" data-number="3.9.1">
<h3 data-number="3.9.1" class="anchored" data-anchor-id="march-29-throughout-a-decade"><span class="header-section-number">3.9.1</span> March 29, throughout a decade</h3>
<p>Daylight Saving rules are complicated: they’re different in different places, they change over time, and they usually start on a Sunday (and so they move around the calendar).</p>
<p>For example, in the United Kingdom, as of the time this lesson was written, Daylight Saving begins on the last Sunday in March. Let’s look at the UTC offset for March 29, at midnight, for the years 2000 to 2010.</p>
</section>
<section id="instructions-22" class="level3" data-number="3.9.2">
<h3 data-number="3.9.2" class="anchored" data-anchor-id="instructions-22"><span class="header-section-number">3.9.2</span> Instructions</h3>
<ul>
<li>Using <code>tz</code>, set the timezone for dt to be <code>'Europe/London'</code>.</li>
<li>Within the <code>for</code> loop:</li>
<li>Use the <code>.replace()</code> method to change the year for <code>dt4</code> to be <code>y</code>.</li>
<li>Call <code>.isoformat()</code> on the result to observe the results.</li>
</ul>
<div id="ae697750" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create starting date</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>dt4 <span class="op">=</span> datetime(<span class="dv">2000</span>, <span class="dv">3</span>, <span class="dv">29</span>, tzinfo <span class="op">=</span> tz.gettz(<span class="st">'Europe/London'</span>))</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over the dates, replacing the year, and print the ISO timestamp</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2000</span>, <span class="dv">2011</span>):</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(dt4.replace(year<span class="op">=</span>y).isoformat())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>2000-03-29T00:00:00+01:00
2001-03-29T00:00:00+01:00
2002-03-29T00:00:00+00:00
2003-03-29T00:00:00+00:00
2004-03-29T00:00:00+01:00
2005-03-29T00:00:00+01:00
2006-03-29T00:00:00+01:00
2007-03-29T00:00:00+01:00
2008-03-29T00:00:00+00:00
2009-03-29T00:00:00+00:00
2010-03-29T00:00:00+01:00</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="chapter-3.4-ending-daylight-saving-time" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Chapter 3.4: Ending Daylight Saving Time</h1>
<p>In the previous lesson <a href="#sec-Chapter3-3" class="quarto-xref">Section&nbsp;3.7.3</a>, we discussed how to handle when the clock “springs ahead” and we enter daylight saving. In the fall, when the clocks are reset back to standard time, an interesting wrinkle occurs. In this lesson, we’ll finish our discussion of daylight saving time by showing what happens when we “fall back”, and also talk about how to unambiguously handle events which bridge a daylight savings jump. Let’s look back at our example in Washington, DC, on the day that daylight saving time ended. On November 5th, 2017, at 2 AM the clocks jumped back an hour. That means there were two 1 AMs! We’ve represented this by “folding” over our timeline to show the repeat. As before, in order to make sense of this situation, we need to map everything back to UTC. The first 1 AM maps to 5 AM UTC. This is the minus 4 hour UTC offset for Eastern Daylight Time we discussed in the previous lesson. At 1:59:59 local time, we’re at 5:59:59 UTC. The next moment, our local clock jumps back, but since time has not actually gone backward, the clock continues to tick in UTC. We switch to a UTC offset of minus 5 hours (colored in blue), and the second 1 AM corresponds to 6 AM UTC. First, let’s make a <code>tzinfo</code> object corresponding to our bike data’s <code>timezone</code>. We make a datetime for November 5th and 1 am. Let’s check and see if this time is ambiguous, meaning we need to tell it apart somehow. We call <code>tz.datetime_ambiguous()</code>, and see that, yes, this is a time which could occur at two different UTC moments in this <code>timezone</code> Now we create a second datetime, with the same date and time. This time, we call <code>tz.enfold()</code>, which takes the argument of the datetime we want to mark. enfold says, this datetime belongs to the <em>second</em> time the wall clock struck 1 AM this day, and not the first. The thing is, enfold by itself doesn’t change any of the behavior of a datetime. You can see here that Python doesn’t take it into account when doing datetime arithmetic. Fold is just a placeholder, and it’s up to further parts of the program to pay attention to fold and do something with it. What are we going to do?! We need to convert to UTC, which is unambiguous. When we really want to make sure that everything is accounted for, putting everything into UTC is the way to do it. Now when we ask Python to take the difference, we see that it correctly tells us these two timestamps are an hour apart. In general, whenever we really want to be sure of the duration between events that might cross a daylight saving boundary, we need to do our math in UTC. We’ve covered how to handle springing forward and falling back, both with hand-coded UTC offsets and with <code>dateutil</code>. Python often tries to be helpful by glossing over daylight saving time difference, and oftentimes that’s what you want. However, when you do care about it, use <code>dateutil</code> to set the <code>timezone</code> information correctly and then switch into UTC for the most accurate comparisons between events.</p>
<section id="exercise-3.4.1" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="exercise-3.4.1"><span class="header-section-number">4.1</span> Exercise 3.4.1</h2>
<section id="finding-ambiguous-datetimes" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="finding-ambiguous-datetimes"><span class="header-section-number">4.1.1</span> Finding ambiguous datetimes</h3>
<p>At the end of lesson 2(<a href="#sec-CHAPTER2" class="quarto-xref">Section&nbsp;2</a>), we saw something anomalous in our bike trip duration data. Let’s see if we can identify what the problem might be.</p>
</section>
<section id="instructions-23" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="instructions-23"><span class="header-section-number">4.1.2</span> Instructions</h3>
<ul>
<li>Loop over the trips in <code>onebike_datetimes</code>:
<ul>
<li>Print any rides whose start is ambiguous.</li>
<li>Print any rides whose end is ambiguous.</li>
</ul></li>
</ul>
<div id="dc7f4772" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To add a tzinfo (timezone information) field to a list of dictionaries with two key values in Python, you can follow these steps:</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.Import the required library</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pytz</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.Timezone object for America/New_York</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>ny_tz <span class="op">=</span> pytz.timezone(<span class="st">'America/New_York'</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.Iterate over each dictionary and add tzinfo to 'start' and 'end' keys</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trip <span class="kw">in</span> onebike_datetimes:</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    trip[<span class="st">'start'</span>] <span class="op">=</span> trip[<span class="st">'start'</span>].replace(tzinfo<span class="op">=</span><span class="va">None</span>)  <span class="co"># Remove existing timezone info</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    trip[<span class="st">'end'</span>] <span class="op">=</span> trip[<span class="st">'end'</span>].replace(tzinfo<span class="op">=</span><span class="va">None</span>)      <span class="co"># Remove existing timezone info</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    trip[<span class="st">'start'</span>] <span class="op">=</span> ny_tz.localize(trip[<span class="st">'start'</span>])  <span class="co"># Add timezone info to 'start'</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    trip[<span class="st">'end'</span>] <span class="op">=</span> ny_tz.localize(trip[<span class="st">'end'</span>])      <span class="co"># Add timezone info to 'end'</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over trips</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trip <span class="kw">in</span> onebike_datetimes:</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rides with ambiguous start</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> tz.datetime_ambiguous(trip[<span class="st">'start'</span>]):</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Ambiguous start at "</span> <span class="op">+</span> <span class="bu">str</span>(trip[<span class="st">'start'</span>]))</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rides with ambiguous end</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> tz.datetime_ambiguous(trip[<span class="st">'end'</span>]):</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Ambiguous end at "</span> <span class="op">+</span> <span class="bu">str</span>(trip[<span class="st">'end'</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="exercise-3.4.2" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="exercise-3.4.2"><span class="header-section-number">4.2</span> Exercise 3.4.2</h2>
<section id="cleaning-daylight-saving-data-with-fold" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="cleaning-daylight-saving-data-with-fold"><span class="header-section-number">4.2.1</span> Cleaning daylight saving data with fold</h3>
<p>As we’ve just discovered, there is a ride in our data set which is being messed up by a Daylight Savings shift. Let’s clean up the data set so we actually have a correct minimum ride length. We can use the fact that we know the end of the ride happened after the beginning to fix up the duration messed up by the shift out of Daylight Savings.</p>
<p>Since Python does not handle <code>tz.enfold()</code> when doing arithmetic, we must put our datetime objects into UTC, where ambiguities have been resolved.</p>
<p><code>onebike_datetimes</code> is already loaded and in the right timezone. <code>tz</code> and <code>timezone</code> have been imported. Use <code>tz.UTC</code> for the timezone.</p>
</section>
<section id="instructions-24" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="instructions-24"><span class="header-section-number">4.2.2</span> Instructions</h3>
<ul>
<li>Complete the <code>if</code> statement to be true only when a ride’s <code>start</code> comes after its <code>end</code>.</li>
<li>When <code>start</code> is after <code>end</code>, call <code>tz.enfold()</code> on the <code>end</code> so you know it refers to the one after the daylight savings time change.</li>
<li>After the <code>if</code> statement, convert the start and end to UTC so you can make a proper comparison.</li>
</ul>
<div id="7a042c8f" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>trip_durations <span class="op">=</span> []</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trip <span class="kw">in</span> onebike_datetimes:</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># When the start is later than the end, set the fold to be 1</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> trip[<span class="st">'start'</span>] <span class="op">&gt;</span> trip[<span class="st">'end'</span>]:</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    trip[<span class="st">'end'</span>] <span class="op">=</span> tz.enfold(trip[<span class="st">'end'</span>])</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to UTC</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  start <span class="op">=</span> trip[<span class="st">'start'</span>].astimezone(tz.UTC)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  end <span class="op">=</span> trip[<span class="st">'end'</span>].astimezone(tz.UTC)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Subtract the difference</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  trip_length_seconds <span class="op">=</span> (end<span class="op">-</span>start).total_seconds()</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>  trip_durations.append(trip_length_seconds)</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Take the shortest trip duration</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Shortest trip: "</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">min</span>(trip_durations)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Shortest trip: -3346.0</code></pre>
</div>
</div>
<p><strong>To give a sense for how tricky these things are: we actually still don’t know how long the rides are which only started or ended in our ambiguous hour but not both. If you’re collecting data, store it in UTC or with a fixed UTC offset!</strong></p>
</section>
</section>
</section>
<section id="chapter-4-easy-and-powerful-dates-and-times-in-pandas" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> CHAPTER 4: EASY AND POWERFUL: DATES AND TIMES IN PANDAS</h1>
<section id="chapter-4.1-reading-date-and-time-data-in-pandas" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="chapter-4.1-reading-date-and-time-data-in-pandas"><span class="header-section-number">5.1</span> Chapter 4.1: Reading date and time data in Pandas</h2>
<p>In this chapter, you will use the Pandas library to work with dates and times. You should have encountered Pandas before, but now we will add datetimes to the mix.</p>
<section id="a-simple-pandas-example" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="a-simple-pandas-example"><span class="header-section-number">5.1.1</span> A simple Pandas example</h3>
<p>To start with, let’s load data with Pandas. First, we import pandas, and as is customary we use the alias pd. Our data is in a csv file, so we load it with the <code>read_csv()</code> function. <code>pd.read_csv()</code> has one required argument, the name of the file to load, which in this case is capital-onebike-dot-csv. We save the result to the variable rides. Let’s print the first three rows to see what we’ve got. Note that the index, listed all the way to the left, starts with zero. Because the table is too wide, it wraps around. Each of these three rows has a start date, an end date, a start station, and end station, the bike number, and whether the ride was from someone who is a member or someone who walked up to the kiosk and bought a ride on the spot. We can also select a particular column by using the brackets, as here where we call <code>rides['Start date']</code>. And we can get a particular row with <code>.iloc[]</code>, in this case row number 2. Because we didn’t tell Pandas to treat the start date and end date columns as <code>datetimes</code>, they are simply strings or objects. We want them to be <code>datetimes</code> so we can work with them effectively, using the tools from the first three chapters of this course.</p>
</section>
<section id="loading-datetimes-with-parse_dates" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="loading-datetimes-with-parse_dates"><span class="header-section-number">5.1.2</span> Loading datetimes with parse_dates</h3>
<p>If we want Pandas to treat these columns as <code>datetimes</code>, we can make use of the argument <code>parse_dates</code> in <code>read_csv()</code>, and set it to be a list of column names, passed as strings. Now Pandas will read these columns and convert them for us to datetimes. Pandas will try and be intelligent and figure out the format of your datetime strings. In the rare case that this doesn’t work, you can use the <code>to_datetime()</code> method that lets you specify the format manually. For more details, see the Pandas documentation. Now when we again ask for the Start date for row 2, we get back a Pandas Timestamp, which for essentially all purposes you can imagine is a Python Datetime object with a different name. They behave basically exactly the same.</p>
</section>
<section id="timezone-aware-arithmetic" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="timezone-aware-arithmetic"><span class="header-section-number">5.1.3</span> Timezone-aware arithmetic</h3>
<p>Since our Start date and End date columns are now datetimes, we can deal with them the way we usually deal with datetimes. For example, we can create a new column, Duration, by subtracting Start date from End date. Because each of these columns are datetimes, when we subtract them we get <code>timedeltas</code>. If we print out the first 5 rows, we get that the first ride lasted for only 3 minutes and 1 second, the second ride lasted for 2 hours and 7 minutes, the third ride lasted for 5 minutes 43 seconds, and so on.</p>
</section>
<section id="loading-datetimes-with-parse_dates-1" class="level3" data-number="5.1.4">
<h3 data-number="5.1.4" class="anchored" data-anchor-id="loading-datetimes-with-parse_dates-1"><span class="header-section-number">5.1.4</span> Loading datetimes with parse_dates</h3>
<p>Pandas has two features worth noting here. Let’s see an example of converting our Duration to seconds, and looking at the first 5 rows. First, Pandas code is often written in a “method chaining” style, where we call a method, and then another, and then another. For readability, it’s common to break them up with a backslash and a linebreak at the end of each. Second, you can access all of the typical <code>datetime</code> methods within the namespace <code>.dt</code>. For example, we can convert our <code>timedeltas</code> into numbers with <code>.dt.total_seconds()</code>. Now when we look at the results, we see that we’ve got seconds instead of <code>timedeltas</code>. Our first ride lasted 181 seconds, our second ride 7622 seconds, and so on. Reading date and time data in Pandas In this lesson, we discussed loading data in Pandas, and handling basic datetime elements. We talked about using slashes to continue lines, and selecting subsets of rows. Time to practice!</p>
</section>
</section>
<section id="exercise-4.1.1" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="exercise-4.1.1"><span class="header-section-number">5.2</span> Exercise 4.1.1</h2>
<section id="loading-a-csv-file-in-pandas" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="loading-a-csv-file-in-pandas"><span class="header-section-number">5.2.1</span> Loading a csv file in Pandas</h3>
<p>The <code>capital_onebike.csv</code> file covers the October, November and December rides of the Capital Bikeshare bike W20529.</p>
<p>Here are the first two columns:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Start date</th>
<th>End date</th>
<th>….</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2017-10-01 15:23:25</td>
<td>2017-10-01 15:26:26</td>
<td>….</td>
</tr>
<tr class="even">
<td>2017-10-01 15:42:57</td>
<td>2017-10-01 17:49:59</td>
<td>….</td>
</tr>
</tbody>
</table>
</section>
<section id="instructions-25" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="instructions-25"><span class="header-section-number">5.2.2</span> Instructions</h3>
<ul>
<li>Import Pandas.</li>
<li>Complete the call to <code>read_csv()</code> so that it correctly parses the date columns <code>Start date</code> and <code>End date</code>.</li>
</ul>
<div id="04dda028" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import pandas</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load CSV into the rides variable</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>rides <span class="op">=</span> pd.read_csv(<span class="st">'datasets/capital-onebike.csv'</span>, </span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>                    parse_dates <span class="op">=</span> [<span class="st">'Start date'</span>, <span class="st">'End date'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="exercise-4.1.2" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="exercise-4.1.2"><span class="header-section-number">5.3</span> Exercise 4.1.2</h2>
<section id="making-timedelta-columns" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="making-timedelta-columns"><span class="header-section-number">5.3.1</span> Making timedelta columns</h3>
<p>Earlier in this course, you wrote a loop to subtract <code>datetime</code> objects and determine how long our sample bike had been out of the docks. Now you’ll do the same thing with Pandas.</p>
</section>
<section id="instructions-26" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="instructions-26"><span class="header-section-number">5.3.2</span> Instructions</h3>
<ul>
<li>Subtract the <code>Start date</code> column from the <code>End date</code> column to get a Series of timedeltas; assign the result to <code>ride_durations</code>.</li>
<li>Convert <code>ride_durations</code> into seconds and assign the result to the <code>'Duration'</code> column of <code>rides</code>.</li>
</ul>
<div id="60dee38e" class="cell" data-execution_count="27">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the initial (0th) row</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rides.iloc[<span class="dv">0</span>])</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Subtract the start date from the end date</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>ride_durations <span class="op">=</span> rides[<span class="st">'End date'</span>] <span class="op">-</span> rides[<span class="st">'Start date'</span>]</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the results to seconds</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>rides[<span class="st">'Duration'</span>] <span class="op">=</span> ride_durations.dt.total_seconds()</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rides[<span class="st">'Duration'</span>].head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Start date                        2017-10-01 15:23:25
End date                          2017-10-01 15:26:26
Start station number                            31038
Start station                    Glebe Rd &amp; 11th St N
End station number                              31036
End station             George Mason Dr &amp; Wilson Blvd
Bike number                                    W20529
Member type                                    Member
Name: 0, dtype: object
0     181.0
1    7622.0
2     343.0
3    1278.0
4    1277.0
Name: Duration, dtype: float64</code></pre>
</div>
</div>
</section>
</section>
<section id="chapter-4.2-summarizing-datetime-data-in-pandas" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="chapter-4.2-summarizing-datetime-data-in-pandas"><span class="header-section-number">5.4</span> CHAPTER 4.2: Summarizing datetime data in Pandas</h2>
<p>In this lesson, we will discuss how to summarize Pandas tables, especially when we have datetime columns. One note: Pandas continues to evolve quickly. Many of the techniques in this chapter don’t work on versions of Pandas more than a few years old. If anything breaks on your personal computer, make sure you’re using at least Pandas version 0.23. Summarizing data in Pandas First things first, let’s review some general principles for summarizing data in Pandas. You can call <code>.mean()</code>, <code>.median()</code>, <code>.sum()</code> and so on, on any column where it makes sense. For example, <code>rides['Duration'].mean()</code> returns that the average time the bike was out of the dock was 19 minutes and 38 seconds. We also can ask: how much is this column in total? By using the <code>.sum()</code> method, we can see that the bike was out of the dock for a total of 3 days, 22 hours, 58 minutes and 10 seconds during this time period. The output of Pandas operations mix perfectly well with the rest of Python. For example, if we divide this sum by 91 days (the number of days from October 1 to December 31), we see that the bike was out about 4.3% of the time, meaning about 96% of the time the bike was in the dock. For non-numeric columns, we have other ways of making summaries. The <code>.value_counts()</code> method tells us how many times a given value appears. In this case, we want to know how often the Member type is Member or Casual. 236 rides were from Members, and 54 were from Casual riders, who bought a ride at the bike kiosk without a membership. We can also divide by the total number of rides, using <code>len(rides)</code>, and Pandas handles the division for us across our result. 81.4% of rides were from members, whereas 18.6% of rides were from casual riders. To make this next section easy, let’s make a column called ‘Duration seconds’, which will be the original column ‘Duration’ converted to seconds. Pandas has powerful ways to group rows together. First, we can group by values in any column, using the <code>.groupby()</code> method. <code>.groupby()</code> takes a column name and does all subsequent operations on each group. For example, we can groupby Member type, and ask for the mean duration in seconds for each member type. Rides from casual members last nearly twice as long on average. Second, we can also group by time, using the <code>.resample()</code> method. <code>.resample()</code> takes a unit of time (for example, ‘M’ for month), and a datetime column to group on, in this case ‘Start date’. From this we can see that, in the month ending on October 31st, average rides were 1886 seconds, or about 30 minutes, whereas for the month ending December 31, average rides were 635 seconds, or closer to ten minutes. There are also others methods which operate on groups. For example, we can call <code>.size()</code> to get the size of each group. Or we can call <code>.first()</code> to get the first row of each group.</p>
<p>Pandas also makes it easy to plot results. Just add the <code>.plot()</code> method at the end of your call and it will pass the results to the Python plotting library Matplotlib. It will usually have sensible defaults, though if you want to change things further you can. We can also change the resampling rate from ‘M’ for months to ‘D’ for days, and plot again. Now we can see that there is at least one big outlier skewing our data: some ride in the middle of October was 25000 seconds long, or nearly 7 hours. We identified this ride in an earlier chapter as possibly a bike repair. Now we can see that it happened after many days with zero rides, which lends strength to that idea. If the bike was broken and sitting in the dock for awhile, eventually it would have been removed for repairs, then returned. In this lesson, we discussed how to use basic Pandas operations, such as <code>.mean()</code>, <code>.median()</code> and <code>.sum()</code>, and also <code>.groupby()</code> and <code>.resample()</code> to combine our rows into different groups. Time to practice what you’ve learned!</p>
</section>
<section id="exercise-4.2.1" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="exercise-4.2.1"><span class="header-section-number">5.5</span> Exercise 4.2.1</h2>
<section id="how-many-joyrides" class="level3" data-number="5.5.1">
<h3 data-number="5.5.1" class="anchored" data-anchor-id="how-many-joyrides"><span class="header-section-number">5.5.1</span> How many joyrides?</h3>
<p>Suppose you have a theory that some people take long bike rides before putting their bike back in the same dock. Let’s call these rides “joyrides”.</p>
<p>You only have data on one bike, so while you can’t draw any bigger conclusions, it’s certainly worth a look.</p>
<p>Are there many joyrides? How long were they in our data set? Use the median instead of the mean, because we know there are some very long trips in our data set that might skew the answer, and the median is less sensitive to outliers.</p>
</section>
<section id="instructions-27" class="level3" data-number="5.5.2">
<h3 data-number="5.5.2" class="anchored" data-anchor-id="instructions-27"><span class="header-section-number">5.5.2</span> Instructions</h3>
<ul>
<li>Create a Pandas Series which is <code>True</code> when <code>Start station</code> and <code>End station</code> are the same, and assign the result to <code>joyrides</code>.</li>
<li>Calculate the median duration of all rides.</li>
<li>Calculate the median duration of <code>joyrides</code>.</li>
</ul>
<div id="7351852b" class="cell" data-execution_count="28">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create joyrides</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>joyrides <span class="op">=</span> (rides[<span class="st">'Start station'</span>] <span class="op">==</span> rides[<span class="st">'End station'</span>])</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Total number of joyrides</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="sc">{}</span><span class="st"> rides were joyrides"</span>.<span class="bu">format</span>(joyrides.<span class="bu">sum</span>()))</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Median of all rides</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The median duration overall was </span><span class="sc">{:.2f}</span><span class="st"> seconds"</span>\</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>      .<span class="bu">format</span>(rides[<span class="st">'Duration'</span>].median()))</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Median of joyrides</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The median duration for joyrides was </span><span class="sc">{:.2f}</span><span class="st"> seconds"</span>\</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>      .<span class="bu">format</span>(rides[joyrides][<span class="st">'Duration'</span>].median()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>6 rides were joyrides
The median duration overall was 660.00 seconds
The median duration for joyrides was 2642.50 seconds</code></pre>
</div>
</div>
</section>
</section>
<section id="exercise-4.2.2" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="exercise-4.2.2"><span class="header-section-number">5.6</span> Exercise 4.2.2</h2>
<p>It’s getting cold outside, W20529 Washington, D.C. has mild weather overall, but the average high temperature in October (68ºF / 20ºC) is certainly higher than the average high temperature in December (47ºF / 8ºC). People also travel more in December, and they work fewer days so they commute less.</p>
<p>How might the weather or the season have affected the length of bike trips?</p>
<section id="instructions-28" class="level3" data-number="5.6.1">
<h3 data-number="5.6.1" class="anchored" data-anchor-id="instructions-28"><span class="header-section-number">5.6.1</span> Instructions</h3>
<ul>
<li>Resample <code>rides</code> to the daily level, based on the <code>Start date</code> column.
<ul>
<li>Plot the <code>.size()</code> of each result.</li>
</ul></li>
<li>Since the daily time series is so noisy for this one bike, change the resampling to be monthly.</li>
</ul>
<div id="41246146" class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import matplotlib</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample rides to daily, take the size, plot the results</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>rides.resample(<span class="st">'D'</span>, on <span class="op">=</span> <span class="st">'Start date'</span>)<span class="op">\</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  .size()<span class="op">\</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  .plot(ylim <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">15</span>])</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the results</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample rides to monthly, take the size, plot the results</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>rides.resample(<span class="st">'M'</span>, on <span class="op">=</span> <span class="st">'Start date'</span>)<span class="op">\</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>  .size()<span class="op">\</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>  .plot(ylim <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">150</span>])</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the results</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-30-output-1.png" width="566" height="474" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-30-output-2.png" width="588" height="442" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>The pattern is clearer at the monthly level: there were fewer rides in November, and then fewer still in December, possibly because the temperature got colder.</strong></p>
</section>
</section>
<section id="exercise-4.2.3" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="exercise-4.2.3"><span class="header-section-number">5.7</span> Exercise 4.2.3</h2>
<section id="members-vs-casual-riders-over-time" class="level3" data-number="5.7.1">
<h3 data-number="5.7.1" class="anchored" data-anchor-id="members-vs-casual-riders-over-time"><span class="header-section-number">5.7.1</span> Members vs casual riders over time</h3>
<p>Riders can either be <code>"Members"</code>, meaning they pay yearly for the ability to take a bike at any time, or <code>"Casual"</code>, meaning they pay at the kiosk attached to the bike dock.</p>
<p>Do members and casual riders drop off at the same rate over October to December, or does one drop off faster than the other?</p>
<p>As before, <code>rides</code> has been loaded for you. You’re going to use the Pandas method <code>.value_counts()</code>, which returns the number of instances of each value in a Series. In this case, the counts of <code>"Member"</code> or <code>"Casual</code>.</p>
</section>
<section id="instructions-29" class="level3" data-number="5.7.2">
<h3 data-number="5.7.2" class="anchored" data-anchor-id="instructions-29"><span class="header-section-number">5.7.2</span> Instructions</h3>
<ul>
<li>Set <code>monthly_rides</code> to be a resampled version of <code>rides</code>, by month, based on start date.</li>
<li>Use the method <code>.value_counts()</code> to find out how many Member and Casual rides there were, and divide them by the total number of rides per month.</li>
</ul>
<div id="916a0342" class="cell" data-execution_count="30">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample rides to be monthly on the basis of Start date</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>monthly_rides <span class="op">=</span> rides.resample(<span class="st">'M'</span>, on <span class="op">=</span> (<span class="st">'Start date'</span>))[<span class="st">'Member type'</span>]</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Take the ratio of the .value_counts() over the total number of rides</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(monthly_rides.value_counts() <span class="op">/</span> monthly_rides.size())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Start date  Member type
2017-10-31  Member         0.768519
            Casual         0.231481
2017-11-30  Member         0.825243
            Casual         0.174757
2017-12-31  Member         0.860759
            Casual         0.139241
dtype: float64</code></pre>
</div>
</div>
</section>
</section>
<section id="exercise-4.2.4" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="exercise-4.2.4"><span class="header-section-number">5.8</span> Exercise 4.2.4</h2>
<section id="combining-groupby-and-resample" class="level3" data-number="5.8.1">
<h3 data-number="5.8.1" class="anchored" data-anchor-id="combining-groupby-and-resample"><span class="header-section-number">5.8.1</span> Combining groupby() and resample()</h3>
<p>A very powerful method in Pandas is <code>.groupby()</code>. Whereas <code>.resample()</code> groups rows by some time or date information, <code>.groupby()</code> groups rows based on the values in one or more columns. For example, <code>rides.groupby('Member type').size()</code> would tell us how many rides there were by member type in our entire DataFrame.</p>
<p><code>.resample()</code> can be called after <code>.groupby()</code>. For example, how long was the median ride by month, and by Membership type?</p>
</section>
<section id="instructions-30" class="level3" data-number="5.8.2">
<h3 data-number="5.8.2" class="anchored" data-anchor-id="instructions-30"><span class="header-section-number">5.8.2</span> Instructions</h3>
<ul>
<li>Complete the <code>.groupby()</code> call to group by <code>'Member type'</code>, and the <code>.resample()</code> call to resample according to <code>'Start date'</code>, by month.</li>
<li>Print the median <code>Duration</code> for each group.</li>
</ul>
<div id="e7600545" class="cell" data-execution_count="31">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group rides by member type, and resample to the month</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>grouped <span class="op">=</span> rides.groupby(<span class="st">'Member type'</span>)<span class="op">\</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  .resample(<span class="st">'M'</span>, on <span class="op">=</span> (<span class="st">'Start date'</span>))</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the median duration for each group</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(grouped[<span class="st">'Duration'</span>].median())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Member type  Start date
Casual       2017-10-31    1636.0
             2017-11-30    1159.5
             2017-12-31     850.0
Member       2017-10-31     671.0
             2017-11-30     655.0
             2017-12-31     387.5
Name: Duration, dtype: float64</code></pre>
</div>
</div>
</section>
</section>
<section id="chapter-4.3-additional-datetime-methods-in-pandas" class="level2" data-number="5.9">
<h2 data-number="5.9" class="anchored" data-anchor-id="chapter-4.3-additional-datetime-methods-in-pandas"><span class="header-section-number">5.9</span> CHAPTER 4.3: Additional datetime methods in Pandas</h2>
<p>In this final lesson, we will cover some additional Pandas methods for working with dates and times. By the end of this lesson, you will understand how to handle timezones in Pandas, as well as other common datetime operations.</p>
<section id="timezones-in-pandas" class="level3" data-number="5.9.1">
<h3 data-number="5.9.1" class="anchored" data-anchor-id="timezones-in-pandas"><span class="header-section-number">5.9.1</span> Timezones in Pandas</h3>
<p>First, a reminder of the importance of timezones. If we ask Pandas to tell us the smallest ride duration in seconds, using the <code>dt.total_seconds()</code> method and then the <code>.min()</code> method, we get -3346 seconds, or -55 minutes. Yikes! Something is wrong, since our ride durations shouldn’t ever be negative. The answer, as it was when we looked at this data set in standard Python, is Daylight Saving. Just like with standard Python, these datetime objects start off as timezone-naive. They’re not tied to any absolute time with a UTC offset. Let’s see the first three Start dates so we can see how they’re displayed and check that there is no UTC offset. To start, we want those same three datetimes to be put into a timezone. The method for this in Pandas is <code>dt.tz_localize()</code>. Now when we look at the localized datetimes, we can see that they have a UTC offset. However, if we try to convert our entire Start date column to the America/New_York timezone, Pandas will throw an AmbiguousTimeError. As expected, we have one datetime that occurs during the Daylight Saving shift. Following the advice of the error message, we can set the ambiguous argument in the <code>dt.tz_localize()</code> method. By default, it raises an error, as we saw before. We also can pass the string ‘NaT’, which says that if the converter gets confused, it should set the bad result as Not a Time. Pandas is smart enough to skip over NaTs when it sees them, so our <code>.min()</code> and other methods will just ignore this one row. Now that we’ve fixed the timezones, we should recalculate our durations, in case any rides had been across Daylight Saving boundaries. This time, when we take Durations, convert it to seconds, and take the minimum, we get a much more sensible 116.0 seconds, or about two minutes. Just to know what we’re looking at, let’s pull up our problematic row. Here, both the start and end time were ambiguous, so they’ve been set to NaT. As a result, our Duration, since it’s the difference of two undefined times, is also NaT.</p>
</section>
<section id="other-datetime-operations-in-pandas" class="level3" data-number="5.9.2">
<h3 data-number="5.9.2" class="anchored" data-anchor-id="other-datetime-operations-in-pandas"><span class="header-section-number">5.9.2</span> Other datetime operations in Pandas</h3>
<p>There are other datetime operations you should know about too. The simplest are ones you’re already familiar with: .year, .month, and so on. In Pandas, these are accessed with dt-dot-year, dt-dot-month, etc. For example, here is the year of the first three rows. There are other useful things that Pandas gives you, some of which are not available in standard Python. For example, the method <code>dt.day_name()</code> gives you the day of the week for each element in a datetime Series. You can even specify if you want weekday names in a language other than English. These results can be aggregated with <code>.groupby()</code> call, to summarize data by year, month, day of the week, and so on.</p>
</section>
<section id="other-parts-of-pandas" class="level3" data-number="5.9.3">
<h3 data-number="5.9.3" class="anchored" data-anchor-id="other-parts-of-pandas"><span class="header-section-number">5.9.3</span> Other parts of Pandas</h3>
<p>Pandas also lets you shift rows up or down with the <code>.shift()</code> method. Here we’ve shifted the rides one row forward so that our zeroth row is now NaT, and our first row has the same value that our zeroth row had before. This is useful if you want to, for example, line up the end times of each row with the start time of the next one. Now you can answer questions about how each ride compares to the previous one! You’ll cover this in an exercise shortly.</p>
</section>
</section>
<section id="exercise-4.3.1" class="level2" data-number="5.10">
<h2 data-number="5.10" class="anchored" data-anchor-id="exercise-4.3.1"><span class="header-section-number">5.10</span> Exercise 4.3.1</h2>
<section id="timezones-in-pandas-1" class="level3" data-number="5.10.1">
<h3 data-number="5.10.1" class="anchored" data-anchor-id="timezones-in-pandas-1"><span class="header-section-number">5.10.1</span> Timezones in Pandas</h3>
<p>Earlier in this course, you assigned a timezone to each <code>datetime</code> in a list. Now with Pandas you can do that with a single method call.</p>
<p>(Note that, just as before, your data set actually includes some ambiguous datetimes on account of daylight saving; for now, we’ll tell Pandas to not even try on those ones. Figuring them out would require more work.)</p>
</section>
<section id="instructions-31" class="level3" data-number="5.10.2">
<h3 data-number="5.10.2" class="anchored" data-anchor-id="instructions-31"><span class="header-section-number">5.10.2</span> Instructions</h3>
<ul>
<li>Make the <code>Start date</code> column timezone aware by localizing it to <code>'America/New_York'</code> while ignoring any ambiguous datetimes.</li>
<li>Now switch the <code>Start date</code> column to the timezone <code>'Europe/London'</code> using the <code>.dt.tz_convert()</code> method.</li>
</ul>
<div id="ca1fca90" class="cell" data-execution_count="32">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Localize the Start date column to America/New_York</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>rides[<span class="st">'Start date'</span>] <span class="op">=</span> rides[<span class="st">'Start date'</span>]<span class="op">\</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>.dt.tz_localize(<span class="st">'America/New_York'</span>, ambiguous<span class="op">=</span> <span class="st">'NaT'</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Localize the End date column to America/New_York</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>rides[<span class="st">'End date'</span>] <span class="op">=</span> rides[<span class="st">'End date'</span>]<span class="op">\</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>.dt.tz_localize(<span class="st">'America/New_York'</span>, ambiguous<span class="op">=</span> <span class="st">'NaT'</span>)</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Print first value</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rides[<span class="st">'Start date'</span>].iloc[<span class="dv">0</span>])</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the Start date column to Europe/London</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>rides[<span class="st">'Start date'</span>] <span class="op">=</span> rides[<span class="st">'Start date'</span>].dt.tz_convert(<span class="st">'Europe/London'</span>)</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the new value</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rides[<span class="st">'Start date'</span>].iloc[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>2017-10-01 15:23:25-04:00
2017-10-01 20:23:25+01:00</code></pre>
</div>
</div>
</section>
</section>
<section id="exercise-4.3.2" class="level2" data-number="5.11">
<h2 data-number="5.11" class="anchored" data-anchor-id="exercise-4.3.2"><span class="header-section-number">5.11</span> Exercise 4.3.2</h2>
<section id="how-long-per-weekday" class="level3" data-number="5.11.1">
<h3 data-number="5.11.1" class="anchored" data-anchor-id="how-long-per-weekday"><span class="header-section-number">5.11.1</span> How long per weekday?</h3>
<p>Pandas has a number of datetime-related attributes within the <code>.dt</code> accessor. Many of them are ones you’ve encountered before, like <code>.dt.month</code>. Others are convenient and save time compared to standard Python, like <code>.dt.day_name()</code>.</p>
</section>
<section id="instructions-32" class="level3" data-number="5.11.2">
<h3 data-number="5.11.2" class="anchored" data-anchor-id="instructions-32"><span class="header-section-number">5.11.2</span> Instructions</h3>
<ul>
<li>Add a new column to <code>rides</code> called <code>'Ride start weekday'</code>, which is the weekday of the <code>Start date</code>.</li>
<li>Print the median ride duration for each weekday.</li>
</ul>
<div id="b14d5d07" class="cell" data-execution_count="33">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a column for the weekday of the start of the ride</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>rides[<span class="st">'Ride start weekday'</span>] <span class="op">=</span> rides[<span class="st">'Start date'</span>].dt.day_name()</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the median trip time per weekday</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rides.groupby(<span class="st">'Ride start weekday'</span>)[<span class="st">'Duration'</span>].median())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Ride start weekday
Friday       684.0
Monday       922.5
Saturday     610.0
Sunday       625.0
Thursday     659.0
Tuesday      644.0
Wednesday    629.0
Name: Duration, dtype: float64</code></pre>
</div>
</div>
</section>
</section>
<section id="exercise-4.3.3" class="level2" data-number="5.12">
<h2 data-number="5.12" class="anchored" data-anchor-id="exercise-4.3.3"><span class="header-section-number">5.12</span> Exercise 4.3.3</h2>
<section id="how-long-between-rides" class="level3" data-number="5.12.1">
<h3 data-number="5.12.1" class="anchored" data-anchor-id="how-long-between-rides"><span class="header-section-number">5.12.1</span> How long between rides?</h3>
<p>For your final exercise, let’s take advantage of Pandas indexing to do something interesting. How much time elapsed between rides?</p>
</section>
<section id="instructions-33" class="level3" data-number="5.12.2">
<h3 data-number="5.12.2" class="anchored" data-anchor-id="instructions-33"><span class="header-section-number">5.12.2</span> Instructions</h3>
<ul>
<li>Calculate the difference in the <code>Start date</code> of the current row and the <code>End date</code> of the previous row and assign it to <code>rides['Time since']</code>.</li>
<li>Convert <code>rides['Time since']</code> to seconds to make it easier to work with.</li>
<li>Resample <code>rides</code> to be in monthly buckets according to the <code>Start date</code>.</li>
<li>Divide the average by (60*60) to get the number of hours on average that W20529 waited in the dock before being picked up again.</li>
</ul>
<div id="65fc08aa" class="cell" data-execution_count="34">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shift the index of the end date up one; now subract it from the start date</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>rides[<span class="st">'Time since'</span>] <span class="op">=</span> rides[<span class="st">'Start date'</span>] <span class="op">-</span> (rides[<span class="st">'End date'</span>].shift(<span class="dv">1</span>))</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Move from a timedelta to a number of seconds, which is easier to work with</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>rides[<span class="st">'Time since'</span>] <span class="op">=</span> rides[<span class="st">'Time since'</span>].dt.total_seconds()</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample to the month</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>monthly <span class="op">=</span> rides.resample(<span class="st">'M'</span>, on<span class="op">=</span><span class="st">'Start date'</span>)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the average hours between rides each month</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(monthly[<span class="st">'Time since'</span>].mean()<span class="op">/</span>(<span class="dv">60</span><span class="op">*</span><span class="dv">60</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Start date
2017-10-31 00:00:00+00:00    5.519242
2017-11-30 00:00:00+00:00    7.256474
2017-12-31 00:00:00+00:00    9.202380
Name: Time since, dtype: float64</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Note that by default, <code>.resample()</code> labels Monthly resampling with the last day in the month and not the first. It certainly looks like the fraction of Casual riders went down as the number of rides dropped. With a little more digging, you could figure out if keeping Member rides only would be enough to stabilize the usage numbers throughout the fall.</p>
<p>It looks like casual riders consistently took longer rides, but that both groups took shorter rides as the months went by. Note that, by combining grouping and resampling, you can answer a lot of questions about nearly any data set that includes time as a feature. Keep in mind that you can also group by more than one column at once.</p>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="explore-datasets" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Explore Datasets</h1>
<p>Use the DataFrames imported in the first code cell to explore the data and practice your skills!</p>
<ul>
<li>Count how many hurricanes made landfall each year in Florida using <code>florida_hurricane_dates</code>.</li>
<li>Reload the dataset <code>datasets/capital-onebike.csv</code> so that it correctly parses date and time columns.</li>
<li>Calculate the average trip duration of bike rentals on weekends in <code>rides</code>. Compare it with the average trip duration of bike rentals on weekdays.</li>
</ul>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb62" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "COURSE 16: WORKING WITH DATES AND TIMES IN PYTHON"</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="an">title-block-banner:</span><span class="co"> "SKYBLUE1.jpeg"</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="co">  - name:  "Lawal's note"</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: "Associate Data Science Course in Python by DataCamp Inc"</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2024-10-17"</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="an">number-sections:</span><span class="co"> true</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="an">highlight-style:</span><span class="co"> pygments</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf:</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a><span class="co">    geometry:</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a><span class="co">      - top=30mm</span></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a><span class="co">      - left=20mm</span></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a><span class="co">  docx: default</span></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true   </span></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a><span class="co">  eval: true  </span></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a><span class="co">  output: true </span></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a><span class="co">  error: false   </span></span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a><span class="co">  cache: false</span></span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a><span class="co">  include_metadata: false</span></span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a><span class="al">![](SOA.jpg)</span></span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>You'll probably never have a time machine, but how about a machine for analyzing time? As soon as time enters any analysis, things can get weird. It's easy to get tripped up on day and month boundaries, time zones, daylight saving time, and all sorts of other things that can confuse the unprepared. If you're going to do any kind of analysis involving time, you’ll want to use Python to sort it out. Working with data sets on hurricanes and bike trips, we’ll cover counting events, figuring out how much time has elapsed between events and plotting data over time. You'll work in both standard Python and in Pandas, and we'll touch on the dateutil library, the only timezone library endorsed by the official Python documentation. After this course, you'll confidently handle date and time data in any format like a champion.</span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a><span class="fu"># CHAPTER 1: DATES AND CALENDARS</span></span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a><span class="fu">## CHAPTER 1.1: Dates in Python</span></span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a>Hi! My name is Max Shron, I will be your instructor for this course on working with dates and times in Python. Dates are everywhere in data science. Stock prices go up and down, experiments begin and end, people are born, politicians take votes, and on and on. All these events happen at a particular point in time. Knowing how to analyze data over time is a core data science skill.</span>
<span id="cb62-40"><a href="#cb62-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a><span class="fu">### Course overview</span></span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a>This course is divided into four chapters. The first chapter will be about working with dates and calendars. In chapter two, we will add time into the mix, and combine dates and times. In chapter three, we'll tackle one of the toughest parts of working with time: time zones and Daylight Saving. And finally, in chapter four, we'll connect what we've learned about working with dates and times to explore how Pandas can make answering even complex questions about dates much easier.</span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-45"><a href="#cb62-45" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dates in Python</span></span>
<span id="cb62-46"><a href="#cb62-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-47"><a href="#cb62-47" aria-hidden="true" tabindex="-1"></a>Let's begin. Python has a special date class, called "date", which you will use to represent dates. A date, like a string, or a number, or a numpy array, has special rules for creating it and methods for working with it. In this lesson, we're going to discuss creating dates and extracting some basic information out of them.</span>
<span id="cb62-48"><a href="#cb62-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-49"><a href="#cb62-49" aria-hidden="true" tabindex="-1"></a><span class="fu">### Why do we need a date class in Python?</span></span>
<span id="cb62-50"><a href="#cb62-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-51"><a href="#cb62-51" aria-hidden="true" tabindex="-1"></a>Why do we need a special date class? Let's have a look. To understand how dates work, in this chapter you're going to be exploring 67 years of Hurricane landfalls in the US state of Florida. two_hurricanes is a list with the dates of two hurricanes represented as strings: the last 2016 hurricane (on October 7th, 2016) and the first 2017 hurricane (on June 21st, 2017). The dates are represented in the US style, with the month, then the day, then the year. Suppose you want to do something interesting with these dates. How would you figure out how many days had elapsed between them? How would you check that they were ordered from earliest to latest? How would you know which day of the week each was? Doing these things manually would be challenging, but Python makes all of them easy. By the end of this chapter, you'll know how to do each of these things yourself.</span>
<span id="cb62-52"><a href="#cb62-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-53"><a href="#cb62-53" aria-hidden="true" tabindex="-1"></a><span class="fu">### Creating date objects</span></span>
<span id="cb62-54"><a href="#cb62-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-55"><a href="#cb62-55" aria-hidden="true" tabindex="-1"></a>To create a date object, we start by importing the date class. The collection of date and time-related classes are stored in the "datetime" package. We create a date using the <span class="in">`date()`</span> function. Here we've created dates corresponding to the two hurricanes, now as Python date objects. The inputs to <span class="in">`date()`</span> are the year, month, and day. The first date is October 7, 2016, and the second date is June 21, 2017. The order is easy to remember: it goes from the biggest to smallest. Year, month, day. Later in this chapter, you'll create dates directly from lists of strings, but in this lesson, you're going to stick to creating dates by hand or using lists of already created dates.</span>
<span id="cb62-56"><a href="#cb62-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-57"><a href="#cb62-57" aria-hidden="true" tabindex="-1"></a><span class="fu">### Attributes of a date</span></span>
<span id="cb62-58"><a href="#cb62-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-59"><a href="#cb62-59" aria-hidden="true" tabindex="-1"></a>You can access individual components of a date using the date's attributes. You can access the year of the date using the year attribute, like so, and the result is 2016. Similarly, you can access the month and day using the month and day attributes like so.</span>
<span id="cb62-60"><a href="#cb62-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-61"><a href="#cb62-61" aria-hidden="true" tabindex="-1"></a><span class="fu">### Finding the weekday of a date</span></span>
<span id="cb62-62"><a href="#cb62-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-63"><a href="#cb62-63" aria-hidden="true" tabindex="-1"></a>You can also ask Python to do more complicated work. Here we call the <span class="in">`weekday()`</span> method on the date, and see that the weekday is 4. What does 4 mean here? Python counts weekdays from 0, starting on Monday. 1 is Tuesday, 2 is Wednesday, and so on, up to 6 being a Sunday. This date was a Friday.</span>
<span id="cb62-64"><a href="#cb62-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-65"><a href="#cb62-65" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 1.1</span></span>
<span id="cb62-66"><a href="#cb62-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-67"><a href="#cb62-67" aria-hidden="true" tabindex="-1"></a><span class="fu">### Which day of the week?</span></span>
<span id="cb62-68"><a href="#cb62-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-69"><a href="#cb62-69" aria-hidden="true" tabindex="-1"></a>Hurricane Andrew, which hit Florida on August 24, 1992, was one of the costliest and deadliest hurricanes in US history. Which day of the week did it make landfall?</span>
<span id="cb62-70"><a href="#cb62-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-71"><a href="#cb62-71" aria-hidden="true" tabindex="-1"></a>Let's walk through all of the steps to figure this out.</span>
<span id="cb62-72"><a href="#cb62-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-73"><a href="#cb62-73" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-74"><a href="#cb62-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-75"><a href="#cb62-75" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Import <span class="in">`date`</span> from <span class="in">`datetime`</span>.</span>
<span id="cb62-76"><a href="#cb62-76" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Create a <span class="in">`date`</span> object for August 24, 1992.</span>
<span id="cb62-77"><a href="#cb62-77" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now ask Python what day of the week Hurricane Andrew hit (remember that Python counts days of the week starting from Monday as 0, Tuesday as 1, and so on).</span>
<span id="cb62-78"><a href="#cb62-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-81"><a href="#cb62-81" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-82"><a href="#cb62-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Importing the course packages</span></span>
<span id="cb62-83"><a href="#cb62-83" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb62-84"><a href="#cb62-84" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb62-85"><a href="#cb62-85" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb62-86"><a href="#cb62-86" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> date, datetime, timezone, timedelta</span>
<span id="cb62-87"><a href="#cb62-87" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dateutil <span class="im">import</span> tz</span>
<span id="cb62-88"><a href="#cb62-88" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb62-89"><a href="#cb62-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-90"><a href="#cb62-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the course datasets</span></span>
<span id="cb62-91"><a href="#cb62-91" aria-hidden="true" tabindex="-1"></a>rides <span class="op">=</span> pd.read_csv(<span class="st">'datasets/capital-onebike.csv'</span>)</span>
<span id="cb62-92"><a href="#cb62-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-93"><a href="#cb62-93" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'datasets/florida_hurricane_dates.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> f:</span>
<span id="cb62-94"><a href="#cb62-94" aria-hidden="true" tabindex="-1"></a>    florida_hurricane_dates <span class="op">=</span> pickle.load(f)</span>
<span id="cb62-95"><a href="#cb62-95" aria-hidden="true" tabindex="-1"></a>florida_hurricane_dates <span class="op">=</span> <span class="bu">sorted</span>(florida_hurricane_dates)</span>
<span id="cb62-96"><a href="#cb62-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-97"><a href="#cb62-97" aria-hidden="true" tabindex="-1"></a><span class="co"># Import date from datetime</span></span>
<span id="cb62-98"><a href="#cb62-98" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> date</span>
<span id="cb62-99"><a href="#cb62-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-100"><a href="#cb62-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a date object</span></span>
<span id="cb62-101"><a href="#cb62-101" aria-hidden="true" tabindex="-1"></a>hurricane_andrew <span class="op">=</span> date(<span class="dv">1992</span>,<span class="dv">8</span>,<span class="dv">24</span>)</span>
<span id="cb62-102"><a href="#cb62-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-103"><a href="#cb62-103" aria-hidden="true" tabindex="-1"></a><span class="co"># Which day of the week is the date?</span></span>
<span id="cb62-104"><a href="#cb62-104" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(hurricane_andrew.weekday())</span>
<span id="cb62-105"><a href="#cb62-105" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-106"><a href="#cb62-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-107"><a href="#cb62-107" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 1.1.2</span></span>
<span id="cb62-108"><a href="#cb62-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-109"><a href="#cb62-109" aria-hidden="true" tabindex="-1"></a><span class="fu">### How many hurricanes come early?</span></span>
<span id="cb62-110"><a href="#cb62-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-111"><a href="#cb62-111" aria-hidden="true" tabindex="-1"></a>In this chapter, you will work with a list of the hurricanes that made landfall in Florida from 1950 to 2017. There were 235 in total. Check out the variable <span class="in">`florida_hurricane_dates`</span>, which has all of these dates.</span>
<span id="cb62-112"><a href="#cb62-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-113"><a href="#cb62-113" aria-hidden="true" tabindex="-1"></a>Atlantic hurricane season officially begins on June 1. How many hurricanes since 1950 have made landfall in Florida before the official start of hurricane season?</span>
<span id="cb62-114"><a href="#cb62-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-115"><a href="#cb62-115" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-116"><a href="#cb62-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-117"><a href="#cb62-117" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Complete the <span class="in">`for`</span> loop to iterate through <span class="in">`florida_hurricane_dates`</span>.</span>
<span id="cb62-118"><a href="#cb62-118" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Complete the <span class="in">`if`</span> statement to increment the counter (<span class="in">`early_hurricanes`</span>) if the hurricane made landfall before June.</span>
<span id="cb62-119"><a href="#cb62-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-122"><a href="#cb62-122" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-123"><a href="#cb62-123" aria-hidden="true" tabindex="-1"></a><span class="co"># Counter for how many before June 1</span></span>
<span id="cb62-124"><a href="#cb62-124" aria-hidden="true" tabindex="-1"></a>early_hurricanes <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb62-125"><a href="#cb62-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-126"><a href="#cb62-126" aria-hidden="true" tabindex="-1"></a><span class="co"># We loop over the dates</span></span>
<span id="cb62-127"><a href="#cb62-127" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> hurricane <span class="kw">in</span> florida_hurricane_dates:</span>
<span id="cb62-128"><a href="#cb62-128" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if the month is before June (month number 6)</span></span>
<span id="cb62-129"><a href="#cb62-129" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> hurricane.month <span class="op">&lt;</span> <span class="dv">6</span>:</span>
<span id="cb62-130"><a href="#cb62-130" aria-hidden="true" tabindex="-1"></a>    early_hurricanes <span class="op">=</span> early_hurricanes <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb62-131"><a href="#cb62-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-132"><a href="#cb62-132" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(early_hurricanes)</span>
<span id="cb62-133"><a href="#cb62-133" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-134"><a href="#cb62-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-135"><a href="#cb62-135" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 1.2: Math with Dates</span></span>
<span id="cb62-136"><a href="#cb62-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-137"><a href="#cb62-137" aria-hidden="true" tabindex="-1"></a>In the last lesson, we discussed how to create date objects and access their attributes. In this lesson, we're going to talk about how to do math with dates: counting days between events, moving forward or backward by a number of days, putting them in order, and so on.</span>
<span id="cb62-138"><a href="#cb62-138" aria-hidden="true" tabindex="-1"></a>Let's take a step back. Think back to when you first learned arithmetic. You probably started with something like this: a number line. This one has the numbers 10 through 16 on it. A number line tells you what order the numbers go in, and how far apart numbers are from each other. Let's pick two numbers, 11 and 14, and represent them in Python as the variables a and b, respectively. We'll put them into a list, l. Python can tell us which number in this list is the least, using the <span class="in">`min()`</span> function. <span class="in">`min`</span> stands for the minimum. In this case, 11 is the lowest number in the list, so we get 11.</span>
<span id="cb62-139"><a href="#cb62-139" aria-hidden="true" tabindex="-1"></a>We can also subtract numbers. When you subtract two numbers, in this case subtracting 11 from 14, the result is 3. Said another way, if we took three steps from 11, we would get 14.</span>
<span id="cb62-140"><a href="#cb62-140" aria-hidden="true" tabindex="-1"></a>Now let's think about how this applies to dates. Let's call this line a calendar line, instead of a number line. Each dot on this calendar line corresponds to a particular day.</span>
<span id="cb62-141"><a href="#cb62-141" aria-hidden="true" tabindex="-1"></a>Let's put two dates onto this calendar line: November 5th, 2017, and December 4th, 2017. Let's represent this in Python. We start by importing the date class from the datetime package. We create two date objects: d1 is November 5th, 2017, and d2 is December 4th, 2017. As before, we put them into a list, l. What Python is doing under the hood, so to speak, is not that different from putting the dates onto a calendar line. For example, if we call min of l, we again get the "least" date, which means the earliest one. In this case, that's November 5th, 2017.</span>
<span id="cb62-142"><a href="#cb62-142" aria-hidden="true" tabindex="-1"></a>And just like numbers, we can subtract two dates. When we do this, we get an object of type "timedelta". Timedeltas give us the elapsed time between events. If you access the days attribute of this object, you can obtain the number of days between the two dates.</span>
<span id="cb62-143"><a href="#cb62-143" aria-hidden="true" tabindex="-1"></a>We can also use a timedelta in the other direction. First, let's import timedelta from datetime. Next, we create a 29-day timedelta, by passing days=29 to <span class="in">`timedelta()`</span>. Now when we add td to our original date we get back December 4th, 2017. Python handled the fact that November has 30 days in it for us, without us having to remember which months are 30 day months, 31 day months, or 28 day months.</span>
<span id="cb62-144"><a href="#cb62-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-145"><a href="#cb62-145" aria-hidden="true" tabindex="-1"></a><span class="fu">### Incrementing variables with +=</span></span>
<span id="cb62-146"><a href="#cb62-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-147"><a href="#cb62-147" aria-hidden="true" tabindex="-1"></a>Finally a quick side note: we will use the "plus-equals" operation a number of times in the rest of the course, so we should discuss it. If you aren't familiar with it, you can see how it works here. On the left-hand side, we create a variable x, set it to zero. If we set x equal to x + 1, we increment x by 1. Similarly, on the right-hand side, we set x = 0, and then we increment it with x += 1. It has the same effect, and we'll use it all the time for counting.</span>
<span id="cb62-148"><a href="#cb62-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-149"><a href="#cb62-149" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 1.2.1</span></span>
<span id="cb62-150"><a href="#cb62-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-151"><a href="#cb62-151" aria-hidden="true" tabindex="-1"></a><span class="fu">### Subtracting dates</span></span>
<span id="cb62-152"><a href="#cb62-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-153"><a href="#cb62-153" aria-hidden="true" tabindex="-1"></a>Python <span class="in">`date`</span> objects let us treat calendar dates as something similar to numbers: we can compare them, sort them, add, and even subtract them. This lets us do math with dates in a way that would be a pain to do by hand.</span>
<span id="cb62-154"><a href="#cb62-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-155"><a href="#cb62-155" aria-hidden="true" tabindex="-1"></a>The 2007 Florida hurricane season was one of the busiest on record, with 8 hurricanes in one year. The first one hit on May 9th, 2007, and the last one hit on December 13th, 2007. How many days elapsed between the first and last hurricane in 2007?</span>
<span id="cb62-156"><a href="#cb62-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-157"><a href="#cb62-157" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-158"><a href="#cb62-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-159"><a href="#cb62-159" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Create a <span class="in">`date`</span> object for May 9th, 2007, and assign it to the <span class="in">`start`</span> variable.</span>
<span id="cb62-160"><a href="#cb62-160" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Create a <span class="in">`date`</span> object for December 13th, 2007, and assign it to the <span class="in">`end`</span> variable.</span>
<span id="cb62-161"><a href="#cb62-161" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Subtract <span class="in">`start`</span> from <span class="in">`end`</span>, to print the number of days in the resulting <span class="in">`timedelta`</span> object.</span>
<span id="cb62-162"><a href="#cb62-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-165"><a href="#cb62-165" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-166"><a href="#cb62-166" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a date object for May 9th, 2007</span></span>
<span id="cb62-167"><a href="#cb62-167" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> date(<span class="dv">2007</span>, <span class="dv">5</span>, <span class="dv">9</span>)</span>
<span id="cb62-168"><a href="#cb62-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-169"><a href="#cb62-169" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a date object for December 13th, 2007</span></span>
<span id="cb62-170"><a href="#cb62-170" aria-hidden="true" tabindex="-1"></a>end <span class="op">=</span> date(<span class="dv">2007</span>, <span class="dv">12</span>, <span class="dv">13</span>)</span>
<span id="cb62-171"><a href="#cb62-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-172"><a href="#cb62-172" aria-hidden="true" tabindex="-1"></a><span class="co"># Subtract the two dates and print the number of days</span></span>
<span id="cb62-173"><a href="#cb62-173" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>((end <span class="op">-</span> start).days)</span>
<span id="cb62-174"><a href="#cb62-174" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-175"><a href="#cb62-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-176"><a href="#cb62-176" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 1.2.2</span></span>
<span id="cb62-177"><a href="#cb62-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-178"><a href="#cb62-178" aria-hidden="true" tabindex="-1"></a><span class="fu">### Counting events per calendar month</span></span>
<span id="cb62-179"><a href="#cb62-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-180"><a href="#cb62-180" aria-hidden="true" tabindex="-1"></a>Hurricanes can make landfall in Florida throughout the year. As we've already discussed, some months are more hurricane-prone than others.</span>
<span id="cb62-181"><a href="#cb62-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-182"><a href="#cb62-182" aria-hidden="true" tabindex="-1"></a>Using <span class="in">`florida_hurricane_dates`</span>, let's see how hurricanes in Florida were distributed across months throughout the year.</span>
<span id="cb62-183"><a href="#cb62-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-184"><a href="#cb62-184" aria-hidden="true" tabindex="-1"></a>We've created a dictionary called <span class="in">`hurricanes_each_month`</span> to hold your counts and set the initial counts to zero. You will loop over the list of hurricanes, incrementing the correct month in <span class="in">`hurricanes_each_month`</span> as you go, and then print the result.</span>
<span id="cb62-185"><a href="#cb62-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-186"><a href="#cb62-186" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-187"><a href="#cb62-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-188"><a href="#cb62-188" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Within the <span class="in">`for`</span> loop:</span>
<span id="cb62-189"><a href="#cb62-189" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Assign <span class="in">`month`</span> to be the month of that hurricane.</span>
<span id="cb62-190"><a href="#cb62-190" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Increment <span class="in">`hurricanes_each_month`</span> for the relevant month by 1.</span>
<span id="cb62-191"><a href="#cb62-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-194"><a href="#cb62-194" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-195"><a href="#cb62-195" aria-hidden="true" tabindex="-1"></a><span class="co"># A dictionary to count hurricanes per calendar month</span></span>
<span id="cb62-196"><a href="#cb62-196" aria-hidden="true" tabindex="-1"></a>hurricanes_each_month <span class="op">=</span> {<span class="dv">1</span>: <span class="dv">0</span>, <span class="dv">2</span>: <span class="dv">0</span>, <span class="dv">3</span>: <span class="dv">0</span>, <span class="dv">4</span>: <span class="dv">0</span>, <span class="dv">5</span>: <span class="dv">0</span>, <span class="dv">6</span>:<span class="dv">0</span>,</span>
<span id="cb62-197"><a href="#cb62-197" aria-hidden="true" tabindex="-1"></a>                         <span class="dv">7</span>: <span class="dv">0</span>, <span class="dv">8</span>:<span class="dv">0</span>, <span class="dv">9</span>:<span class="dv">0</span>, <span class="dv">10</span>:<span class="dv">0</span>, <span class="dv">11</span>:<span class="dv">0</span>, <span class="dv">12</span>:<span class="dv">0</span>}</span>
<span id="cb62-198"><a href="#cb62-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-199"><a href="#cb62-199" aria-hidden="true" tabindex="-1"></a><span class="co"># Shuffle the list</span></span>
<span id="cb62-200"><a href="#cb62-200" aria-hidden="true" tabindex="-1"></a>dates_scrambled <span class="op">=</span> florida_hurricane_dates</span>
<span id="cb62-201"><a href="#cb62-201" aria-hidden="true" tabindex="-1"></a>random.shuffle(dates_scrambled)</span>
<span id="cb62-202"><a href="#cb62-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-203"><a href="#cb62-203" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the first and last scrambled dates</span></span>
<span id="cb62-204"><a href="#cb62-204" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dates_scrambled[<span class="dv">0</span>])</span>
<span id="cb62-205"><a href="#cb62-205" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dates_scrambled[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb62-206"><a href="#cb62-206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-207"><a href="#cb62-207" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 1.2.3</span></span>
<span id="cb62-208"><a href="#cb62-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-209"><a href="#cb62-209" aria-hidden="true" tabindex="-1"></a><span class="fu">### Putting a list of dates in order</span></span>
<span id="cb62-210"><a href="#cb62-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-211"><a href="#cb62-211" aria-hidden="true" tabindex="-1"></a>Much like numbers and strings, <span class="in">`date`</span> objects in Python can be put in order. Earlier dates come before later ones, and so we can sort a list of <span class="in">`date`</span> objects from earliest to latest.</span>
<span id="cb62-212"><a href="#cb62-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-213"><a href="#cb62-213" aria-hidden="true" tabindex="-1"></a>What if our Florida hurricane dates had been scrambled? We've gone ahead and shuffled them so they're in random order and saved the results as <span class="in">`dates_scrambled`</span>. Your job is to put them back in chronological order, and then print the first and last dates from this sorted list.</span>
<span id="cb62-214"><a href="#cb62-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-215"><a href="#cb62-215" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions </span></span>
<span id="cb62-216"><a href="#cb62-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-217"><a href="#cb62-217" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Print the first and last dates in <span class="in">`dates_scrambled`</span>.</span>
<span id="cb62-218"><a href="#cb62-218" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Sort <span class="in">`dates_scrambled`</span> using Python's built-in <span class="in">`sorted()`</span> function, and save the results to <span class="in">`dates_ordered`</span>.</span>
<span id="cb62-219"><a href="#cb62-219" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Print the first and last dates in <span class="in">`dates_ordered`</span>.</span>
<span id="cb62-220"><a href="#cb62-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-223"><a href="#cb62-223" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-224"><a href="#cb62-224" aria-hidden="true" tabindex="-1"></a><span class="co"># Put the dates in order</span></span>
<span id="cb62-225"><a href="#cb62-225" aria-hidden="true" tabindex="-1"></a>dates_ordered <span class="op">=</span> <span class="bu">sorted</span>(dates_scrambled)</span>
<span id="cb62-226"><a href="#cb62-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-227"><a href="#cb62-227" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the first and last ordered dates</span></span>
<span id="cb62-228"><a href="#cb62-228" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dates_ordered[<span class="dv">0</span>])</span>
<span id="cb62-229"><a href="#cb62-229" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dates_ordered[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb62-230"><a href="#cb62-230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-231"><a href="#cb62-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-232"><a href="#cb62-232" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 1.3: Turning dates into strings</span></span>
<span id="cb62-233"><a href="#cb62-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-234"><a href="#cb62-234" aria-hidden="true" tabindex="-1"></a>Python has a very flexible set of tools for turning dates back into strings to be easily read. We want to put dates back into strings when, for example, we want to print results, but also if we want to put dates into filenames, or if we want to write dates out to CSV or Excel files.</span>
<span id="cb62-235"><a href="#cb62-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-236"><a href="#cb62-236" aria-hidden="true" tabindex="-1"></a><span class="fu">### ISO 8601 format</span></span>
<span id="cb62-237"><a href="#cb62-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-238"><a href="#cb62-238" aria-hidden="true" tabindex="-1"></a>For example, let's create a date and see how Python prints it by default. As before, we import date from datetime and let's again create an object for November 5th, 2017. When we ask Python to print the date, it prints the year, day and then the month, separated by dashes, and always with two digits for the day and month. In the comment, you can see I've noted this as YYYY-MM-DD; four digit year, two digit month, and two digit day of the month. This default format is also known as ISO format, or ISO 8601 format, after the international standard ISO 8601 that it is based on. ISO 8601 strings are always the same length since month and day are written with 0s when they are less than 10. We'll talk about another advantage of ISO 8601 in a moment. If we want the ISO representation of a date as a string, say to write it to a CSV file instead of just printing it, you can call the <span class="in">`isoformat()`</span> method. In this example, we put it inside a list so you can see that it creates a string.</span>
<span id="cb62-239"><a href="#cb62-239" aria-hidden="true" tabindex="-1"></a>The ISO 8601 format has another nice advantage. To demonstrate, we've created a variable called some_dates and represented two dates here as strings: January 1, 2000, and December 31, 1999. Dates formatted as ISO 8601 strings sort correctly. When we print the sorted version of this list, the earlier day is first, and the later date is second. For example, if we use ISO 8601 dates in filenames, they can be correctly sorted from earliest to latest. If we had month or day first, the strings would not sort in chronological order.</span>
<span id="cb62-240"><a href="#cb62-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-241"><a href="#cb62-241" aria-hidden="true" tabindex="-1"></a><span class="fu">### Every other format</span></span>
<span id="cb62-242"><a href="#cb62-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-243"><a href="#cb62-243" aria-hidden="true" tabindex="-1"></a>If you don't want to put dates in ISO 8601 format, Python has a flexible set of options for representing dates in other ways, using the <span class="in">`strftime()`</span> method.</span>
<span id="cb62-244"><a href="#cb62-244" aria-hidden="true" tabindex="-1"></a><span class="in">`strftime()`</span> works by letting you pass a "format string" which Python uses to format your date. Let's see an example. We again create an example date of January 5th, 2017. We then call <span class="in">`strftime()`</span> on d, with the format string of % capital Y. Strftime reads the % capital Y and fills in the year in this string for us. <span class="in">`strftime()`</span> though is very flexible: we can give it arbitrary strings with % capital Y in them for the format string, and it will stick the year in. For example, we can use the format string of "Year is %Y".</span>
<span id="cb62-245"><a href="#cb62-245" aria-hidden="true" tabindex="-1"></a>Strftime has other placeholders besides %Y: % lowercase m gives the month, and % lowercase d gives the day of the month. Using these, we can represent dates in arbitrary formats for whatever our needs are.</span>
<span id="cb62-246"><a href="#cb62-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-247"><a href="#cb62-247" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 1.3.1</span></span>
<span id="cb62-248"><a href="#cb62-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-249"><a href="#cb62-249" aria-hidden="true" tabindex="-1"></a><span class="fu">### Printing dates in a friendly format</span></span>
<span id="cb62-250"><a href="#cb62-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-251"><a href="#cb62-251" aria-hidden="true" tabindex="-1"></a>Because people may want to see dates in many different formats, Python comes with very flexible functions for turning <span class="in">`date`</span> objects into strings.</span>
<span id="cb62-252"><a href="#cb62-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-253"><a href="#cb62-253" aria-hidden="true" tabindex="-1"></a>Let's see what event was recorded first in the Florida hurricane data set. In this exercise, you will format the earliest date in the <span class="in">`florida_hurricane_dates`</span> list in two ways so you can decide which one you want to use: either the ISO standard or the typical US style.</span>
<span id="cb62-254"><a href="#cb62-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-255"><a href="#cb62-255" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-256"><a href="#cb62-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-257"><a href="#cb62-257" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Assign the earliest date in <span class="in">`florida_hurricane_dates`</span> to first_date.</span>
<span id="cb62-258"><a href="#cb62-258" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Print <span class="in">`first_date`</span> in the ISO standard. For example, December 1st, 2000 would be "2000-12-01".</span>
<span id="cb62-259"><a href="#cb62-259" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Print <span class="in">`first_dat`</span>e in the US style, using <span class="in">`.strftime()`</span>. For example, December 1st, 2000 would be "12/1/2000".</span>
<span id="cb62-260"><a href="#cb62-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-263"><a href="#cb62-263" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-264"><a href="#cb62-264" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign the earliest date to first_date</span></span>
<span id="cb62-265"><a href="#cb62-265" aria-hidden="true" tabindex="-1"></a>first_date <span class="op">=</span> <span class="bu">min</span>(florida_hurricane_dates)</span>
<span id="cb62-266"><a href="#cb62-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-267"><a href="#cb62-267" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to ISO and US formats</span></span>
<span id="cb62-268"><a href="#cb62-268" aria-hidden="true" tabindex="-1"></a>iso <span class="op">=</span> <span class="st">"Our earliest hurricane date: "</span> <span class="op">+</span> first_date.isoformat()</span>
<span id="cb62-269"><a href="#cb62-269" aria-hidden="true" tabindex="-1"></a>us <span class="op">=</span> <span class="st">"Our earliest hurricane date: "</span> <span class="op">+</span> first_date.strftime(<span class="st">"%m/</span><span class="sc">%d</span><span class="st">/%Y"</span>)</span>
<span id="cb62-270"><a href="#cb62-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-271"><a href="#cb62-271" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"ISO: "</span> <span class="op">+</span> iso)</span>
<span id="cb62-272"><a href="#cb62-272" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"US: "</span> <span class="op">+</span> us)</span>
<span id="cb62-273"><a href="#cb62-273" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-274"><a href="#cb62-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-275"><a href="#cb62-275" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 1.3.2</span></span>
<span id="cb62-276"><a href="#cb62-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-277"><a href="#cb62-277" aria-hidden="true" tabindex="-1"></a><span class="fu">### Representing dates in different ways</span></span>
<span id="cb62-278"><a href="#cb62-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-279"><a href="#cb62-279" aria-hidden="true" tabindex="-1"></a><span class="in">`date`</span> objects in Python have a great number of ways they can be printed out as strings. In some cases, you want to know the date in a clear, language-agnostic format. In other cases, you want something which can fit into a paragraph and flow naturally.</span>
<span id="cb62-280"><a href="#cb62-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-281"><a href="#cb62-281" aria-hidden="true" tabindex="-1"></a>Let's try printing out the same date, August 26, 1992 (the day that Hurricane Andrew made landfall in Florida), in a number of different ways, to practice using the <span class="in">`.strftime()`</span> method.</span>
<span id="cb62-282"><a href="#cb62-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-283"><a href="#cb62-283" aria-hidden="true" tabindex="-1"></a>A date object called <span class="in">`andrew`</span> has already been created.</span>
<span id="cb62-284"><a href="#cb62-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-285"><a href="#cb62-285" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-286"><a href="#cb62-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-287"><a href="#cb62-287" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Print <span class="in">`andrew`</span> in the format 'YYYY-MM'.</span>
<span id="cb62-288"><a href="#cb62-288" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Print <span class="in">`andrew`</span> in the format 'MONTH (YYYY)', using <span class="in">`%B`</span> for the month's full name, which in this case will be August.</span>
<span id="cb62-289"><a href="#cb62-289" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Print <span class="in">`andrew`</span> in the format 'YYYY-DDD' (where DDD is the day of the year) using <span class="in">`%j`</span>.</span>
<span id="cb62-290"><a href="#cb62-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-293"><a href="#cb62-293" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-294"><a href="#cb62-294" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a date object</span></span>
<span id="cb62-295"><a href="#cb62-295" aria-hidden="true" tabindex="-1"></a>andrew <span class="op">=</span> date(<span class="dv">1992</span>, <span class="dv">8</span>, <span class="dv">26</span>)</span>
<span id="cb62-296"><a href="#cb62-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-297"><a href="#cb62-297" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the date in the format 'YYYY-MM'</span></span>
<span id="cb62-298"><a href="#cb62-298" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(andrew.strftime(<span class="st">"%Y-%m"</span>))</span>
<span id="cb62-299"><a href="#cb62-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-300"><a href="#cb62-300" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the date in the format 'MONTH (YYYY)'</span></span>
<span id="cb62-301"><a href="#cb62-301" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(andrew.strftime(<span class="st">'%B (%Y)'</span>))</span>
<span id="cb62-302"><a href="#cb62-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-303"><a href="#cb62-303" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the date in the format 'YYYY-DDD'</span></span>
<span id="cb62-304"><a href="#cb62-304" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(andrew.strftime(<span class="st">'%Y-%j'</span>))</span>
<span id="cb62-305"><a href="#cb62-305" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-306"><a href="#cb62-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-307"><a href="#cb62-307" aria-hidden="true" tabindex="-1"></a><span class="fu"># CHAPTER 2: COMBINING DATES AND TIMES {#sec-CHAPTER2}</span></span>
<span id="cb62-308"><a href="#cb62-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-309"><a href="#cb62-309" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 2.1: Adding time to the mix {#sec-Chapter2-1}</span></span>
<span id="cb62-310"><a href="#cb62-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-311"><a href="#cb62-311" aria-hidden="true" tabindex="-1"></a>In this chapter, you are going to move from only working with dates to working with both dates and times: the calendar day AND the time on the clock within that day.</span>
<span id="cb62-312"><a href="#cb62-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-313"><a href="#cb62-313" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dates and Times</span></span>
<span id="cb62-314"><a href="#cb62-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-315"><a href="#cb62-315" aria-hidden="true" tabindex="-1"></a>As always, let's start with an example. Here is an example of a date and a time together: October 1, 2017, at 3:23:25 PM. Unlike before, where we were only working with the date, we're now going to also include the time. Let's see how to represent this in Python.</span>
<span id="cb62-316"><a href="#cb62-316" aria-hidden="true" tabindex="-1"></a>The first thing we have to do is import the datetime class from the datetime package. Ideally, these would have different names, but unfortunately for historical reasons they have the same name. This is just something to get used to.</span>
<span id="cb62-317"><a href="#cb62-317" aria-hidden="true" tabindex="-1"></a>We're going to create a datetime called "dt" and populate the fields together. The first three arguments to the datetime class are exactly the same as the date class. Year, then month, then day, each as a number.</span>
<span id="cb62-318"><a href="#cb62-318" aria-hidden="true" tabindex="-1"></a>Next, we fill in the hour. Computers generally use 24 hour time, meaning that 3 PM is represented as hour 15 of 24.</span>
<span id="cb62-319"><a href="#cb62-319" aria-hidden="true" tabindex="-1"></a>We put in the minutes, 23 out of 60. And finally, the seconds. October 1, 2017 at 3:23:25PM is represented as a datetime in Python as 2017, 10, 1, 15, 23, 25). All of these arguments need to be whole numbers; if you want to represent point-5 seconds, you can add microseconds to your datetime. Here we've added 500,000 microseconds, or point-5 seconds. That is, Python breaks seconds down into millionths of a second for you when you need that kind of precision. If you need billionths of a second precision (which happens sometimes in science and finance) we'll cover nanoseconds when we get to Pandas at the end of this course. Python defaults to 0 microseconds if you don't include it.</span>
<span id="cb62-320"><a href="#cb62-320" aria-hidden="true" tabindex="-1"></a>That's a lot of arguments; if it helps, you can always be more explicit and use named arguments.</span>
<span id="cb62-321"><a href="#cb62-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-322"><a href="#cb62-322" aria-hidden="true" tabindex="-1"></a><span class="fu">### Replacing parts of a datetime</span></span>
<span id="cb62-323"><a href="#cb62-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-324"><a href="#cb62-324" aria-hidden="true" tabindex="-1"></a>We can also make new datetimes from existing ones by using the <span class="in">`replace()`</span> method. For example, we can take the datetime we just made, and make a new one which has the same date but is rounded down to the start of the hour. We call <span class="in">`dt.replace()`</span> and set minutes, seconds, and microseconds to 0. This creates a new datetime with the same values in all the other fields, but these ones changed.</span>
<span id="cb62-325"><a href="#cb62-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-326"><a href="#cb62-326" aria-hidden="true" tabindex="-1"></a><span class="fu">### Capital Bikeshare</span></span>
<span id="cb62-327"><a href="#cb62-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-328"><a href="#cb62-328" aria-hidden="true" tabindex="-1"></a>Before we wrap up, let's talk about the data we will use for the rest of this course. You will be working with data from Capital Bikeshare, the oldest municipal shared bike program in the United States. Throughout the Washington, DC area, you will find these special bike docks, where riders can pay to take a bike, ride it, and return to this or any other station in the network. We will be following one bike, ID number "W20529", on all the trips it took in October, November, and December of 2017. Each trip consisted of a date and time when a bike was undocked from a station, then some time passed, and the date and time when W20529 was docked again.</span>
<span id="cb62-329"><a href="#cb62-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-330"><a href="#cb62-330" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 2.1.1</span></span>
<span id="cb62-331"><a href="#cb62-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-332"><a href="#cb62-332" aria-hidden="true" tabindex="-1"></a><span class="fu">### Creating datetimes by hand</span></span>
<span id="cb62-333"><a href="#cb62-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-334"><a href="#cb62-334" aria-hidden="true" tabindex="-1"></a>Often you create <span class="in">`datetime`</span> objects based on outside data. Sometimes though, you want to create a <span class="in">`datetime`</span> object from scratch.</span>
<span id="cb62-335"><a href="#cb62-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-336"><a href="#cb62-336" aria-hidden="true" tabindex="-1"></a>You're going to create a few different <span class="in">`datetime`</span> objects from scratch to get the hang of that process. These come from the bikeshare data set that you'll use throughout the rest of the chapter.</span>
<span id="cb62-337"><a href="#cb62-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-338"><a href="#cb62-338" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-339"><a href="#cb62-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-340"><a href="#cb62-340" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Import the <span class="in">`datetime`</span> class.</span>
<span id="cb62-341"><a href="#cb62-341" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>Create a <span class="in">`datetime`</span> for October 1, 2017 at 15:26:26.</span>
<span id="cb62-342"><a href="#cb62-342" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>Print the results in ISO format.</span>
<span id="cb62-343"><a href="#cb62-343" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>Create a <span class="in">`datetime`</span> for December 31, 2017 at 15:19:13.</span>
<span id="cb62-344"><a href="#cb62-344" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>Print the results in ISO format.</span>
<span id="cb62-345"><a href="#cb62-345" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Create a new datetime by replacing the year in dt with 1917 (instead of 2017)</span>
<span id="cb62-346"><a href="#cb62-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-349"><a href="#cb62-349" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-350"><a href="#cb62-350" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a datetime object</span></span>
<span id="cb62-351"><a href="#cb62-351" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> datetime(<span class="dv">2017</span>, <span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">15</span>, <span class="dv">26</span>, <span class="dv">26</span>)</span>
<span id="cb62-352"><a href="#cb62-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-353"><a href="#cb62-353" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results in ISO 8601 format</span></span>
<span id="cb62-354"><a href="#cb62-354" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dt.isoformat())</span>
<span id="cb62-355"><a href="#cb62-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-356"><a href="#cb62-356" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a datetime object</span></span>
<span id="cb62-357"><a href="#cb62-357" aria-hidden="true" tabindex="-1"></a>dt1 <span class="op">=</span> datetime(<span class="dv">2017</span>, <span class="dv">12</span>, <span class="dv">31</span>, <span class="dv">15</span>, <span class="dv">19</span>, <span class="dv">13</span>)</span>
<span id="cb62-358"><a href="#cb62-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-359"><a href="#cb62-359" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results in ISO 8601 format</span></span>
<span id="cb62-360"><a href="#cb62-360" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dt1.isoformat())</span>
<span id="cb62-361"><a href="#cb62-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-362"><a href="#cb62-362" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace the year with 1917</span></span>
<span id="cb62-363"><a href="#cb62-363" aria-hidden="true" tabindex="-1"></a>dt_old <span class="op">=</span> dt1.replace(year<span class="op">=</span><span class="dv">1917</span>)</span>
<span id="cb62-364"><a href="#cb62-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-365"><a href="#cb62-365" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results in ISO 8601 format</span></span>
<span id="cb62-366"><a href="#cb62-366" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dt_old)</span>
<span id="cb62-367"><a href="#cb62-367" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-368"><a href="#cb62-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-369"><a href="#cb62-369" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 2.1.2</span></span>
<span id="cb62-370"><a href="#cb62-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-371"><a href="#cb62-371" aria-hidden="true" tabindex="-1"></a><span class="fu">### Counting events before and after noon</span></span>
<span id="cb62-372"><a href="#cb62-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-373"><a href="#cb62-373" aria-hidden="true" tabindex="-1"></a>In this chapter, you will be working with a list of all bike trips for one Capital Bikeshare bike, W20529, from October 1, 2017 to December 31, 2017. This list has been loaded as <span class="in">`onebike_datetimes`</span>.</span>
<span id="cb62-374"><a href="#cb62-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-375"><a href="#cb62-375" aria-hidden="true" tabindex="-1"></a>Each element of the list is a dictionary with two entries: <span class="in">`Start date`</span> is a <span class="in">`datetime`</span> object corresponding to the start of a trip (when a bike is removed from the dock) and <span class="in">`End date`</span> is a <span class="in">`datetime`</span> object corresponding to the end of a trip (when a bike is put back into a dock).</span>
<span id="cb62-376"><a href="#cb62-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-377"><a href="#cb62-377" aria-hidden="true" tabindex="-1"></a>You can use this data set to understand better how this bike was used. Did more trips start before noon or after noon?</span>
<span id="cb62-378"><a href="#cb62-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-379"><a href="#cb62-379" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-380"><a href="#cb62-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-381"><a href="#cb62-381" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Within the <span class="in">`for`</span> loop, complete the <span class="in">`if`</span> statement to check if the trip started before noon.</span>
<span id="cb62-382"><a href="#cb62-382" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Within the <span class="in">`for`</span> loop, increment <span class="in">`trip_counts['AM']`</span> if the trip started before noon, and <span class="in">`trip_counts['PM']`</span> if it started after noon.</span>
<span id="cb62-383"><a href="#cb62-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-386"><a href="#cb62-386" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-387"><a href="#cb62-387" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'start' and 'end' columns to datetime format</span></span>
<span id="cb62-388"><a href="#cb62-388" aria-hidden="true" tabindex="-1"></a>rides[<span class="st">'Start date'</span>] <span class="op">=</span> pd.to_datetime(rides[<span class="st">'Start date'</span>])</span>
<span id="cb62-389"><a href="#cb62-389" aria-hidden="true" tabindex="-1"></a>rides[<span class="st">'End date'</span>] <span class="op">=</span> pd.to_datetime(rides[<span class="st">'End date'</span>])</span>
<span id="cb62-390"><a href="#cb62-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-391"><a href="#cb62-391" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list of dictionaries with 'start' and 'end' keys</span></span>
<span id="cb62-392"><a href="#cb62-392" aria-hidden="true" tabindex="-1"></a>onebike_datetimes <span class="op">=</span> rides.<span class="bu">apply</span>(<span class="kw">lambda</span> row: {<span class="st">'Start date'</span>: row[<span class="st">'Start date'</span>], <span class="st">'End date'</span>: row[<span class="st">'End date'</span>]}, axis<span class="op">=</span><span class="dv">1</span>).tolist()</span>
<span id="cb62-393"><a href="#cb62-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-394"><a href="#cb62-394" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dictionary to hold results</span></span>
<span id="cb62-395"><a href="#cb62-395" aria-hidden="true" tabindex="-1"></a>trip_counts <span class="op">=</span> {<span class="st">'AM'</span>: <span class="dv">0</span>, <span class="st">'PM'</span>: <span class="dv">0</span>}</span>
<span id="cb62-396"><a href="#cb62-396" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-397"><a href="#cb62-397" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over all trips</span></span>
<span id="cb62-398"><a href="#cb62-398" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trip <span class="kw">in</span> onebike_datetimes:</span>
<span id="cb62-399"><a href="#cb62-399" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check to see if the trip starts before noon</span></span>
<span id="cb62-400"><a href="#cb62-400" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> trip[<span class="st">'Start date'</span>].hour <span class="op">&lt;</span> <span class="dv">12</span>:</span>
<span id="cb62-401"><a href="#cb62-401" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Increment the counter for before noon</span></span>
<span id="cb62-402"><a href="#cb62-402" aria-hidden="true" tabindex="-1"></a>    trip_counts[<span class="st">'AM'</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb62-403"><a href="#cb62-403" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb62-404"><a href="#cb62-404" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Increment the counter for after noon</span></span>
<span id="cb62-405"><a href="#cb62-405" aria-hidden="true" tabindex="-1"></a>    trip_counts[<span class="st">'PM'</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb62-406"><a href="#cb62-406" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-407"><a href="#cb62-407" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(trip_counts)</span>
<span id="cb62-408"><a href="#cb62-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-409"><a href="#cb62-409" aria-hidden="true" tabindex="-1"></a><span class="co"># It looks like this bike is used about twice as much after noon than it is before noon. One obvious follow up would be to see _which_ hours the bike is most likely to be taken out for a ride.</span></span>
<span id="cb62-410"><a href="#cb62-410" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-411"><a href="#cb62-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-412"><a href="#cb62-412" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 2.2: Printing and parsing datetimes</span></span>
<span id="cb62-413"><a href="#cb62-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-414"><a href="#cb62-414" aria-hidden="true" tabindex="-1"></a>Much like dates, datetimes can be printed in many ways. Python also has another trick: you can take a string and turn it directly into a datetime. Let's start with printing dates and then move on to asking Python to parse them.</span>
<span id="cb62-415"><a href="#cb62-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-416"><a href="#cb62-416" aria-hidden="true" tabindex="-1"></a><span class="fu">### Printing datetimes</span></span>
<span id="cb62-417"><a href="#cb62-417" aria-hidden="true" tabindex="-1"></a>First, let's create a datetime again. dt corresponds to December 30, 2017 at 15:19:13, the end of the last trip that W20529 takes in our data set. Just like with date objects, we use <span class="in">`strftime()`</span> to create a string with a particular format. First, we'll just print the year, month and date, using the same format codes we used for dates. % capital Y stands for the four digit year, % lowercase m for the month, and % lowercase d for the day of the month. Now we can add in the hours, minutes and seconds. Again, we print the year, month and day, and now we add three more format codes: % capital H gives us the hour, % capital M gives us the minute, and % capital S gives us the seconds. There are also format codes for 12-hour clocks, and for printing the correct AM or PM.</span>
<span id="cb62-418"><a href="#cb62-418" aria-hidden="true" tabindex="-1"></a>As before, we can make these formatting strings as complicated as we need. Here's another version of the previous string.</span>
<span id="cb62-419"><a href="#cb62-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-420"><a href="#cb62-420" aria-hidden="true" tabindex="-1"></a><span class="fu">### ISO 8601 Format</span></span>
<span id="cb62-421"><a href="#cb62-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-422"><a href="#cb62-422" aria-hidden="true" tabindex="-1"></a>Finally, we can use the <span class="in">`isoformat()`</span> method, just like with dates, to get a standards-compliant way of writing down a datetime. The officially correct way of writing a datetime is the year, month, day, then a capital T, then the time in 24 hour time, followed by the minute and second. When in doubt, this is a good format to use.</span>
<span id="cb62-423"><a href="#cb62-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-424"><a href="#cb62-424" aria-hidden="true" tabindex="-1"></a><span class="fu">### Parsing datetimes with strptime</span></span>
<span id="cb62-425"><a href="#cb62-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-426"><a href="#cb62-426" aria-hidden="true" tabindex="-1"></a>We can also parse dates from strings, using the same format codes we used for printing. You'll use this often when getting date and time data from the Internet since dates and times are often represented as strings. We start, as before, by importing the datetime class.</span>
<span id="cb62-427"><a href="#cb62-427" aria-hidden="true" tabindex="-1"></a>The method we're going to use is called <span class="in">`strptime()`</span>, which is short for string parse time. <span class="in">`strptime()`</span> takes two arguments: the first argument is the string to turn into a datetime, and the second argument is the format string that says how to do it.</span>
<span id="cb62-428"><a href="#cb62-428" aria-hidden="true" tabindex="-1"></a>First we pass the string we want to parse. In this case, a string representing December 30, 2017, at 15:19:13.</span>
<span id="cb62-429"><a href="#cb62-429" aria-hidden="true" tabindex="-1"></a>Then we pass the format string, which as mentioned before uses the same format codes we used with <span class="in">`strftime()`</span>. In this case, first the month, then the day, then the year, all separated by slashes, then a space, and then the hour, minutes, and seconds separated by colons. You usually need to figure this out once per data set.</span>
<span id="cb62-430"><a href="#cb62-430" aria-hidden="true" tabindex="-1"></a>If we look and see what kind of object we've made, by printing the type of <span class="in">`dt`</span>, we see that we've got a datetime. And if we print that datetime, we get a string representation of the datetime. We can see that the parsing worked correctly. We need an exact match to do a string conversion. For example, if we leave out how to parse the time, Python will throw an error. And similarly, if there is an errant comma or other symbols, <span class="in">`strptime()`</span> will not be happy.</span>
<span id="cb62-431"><a href="#cb62-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-432"><a href="#cb62-432" aria-hidden="true" tabindex="-1"></a><span class="fu">### Parsing datetimes with Python</span></span>
<span id="cb62-433"><a href="#cb62-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-434"><a href="#cb62-434" aria-hidden="true" tabindex="-1"></a>Finally, there is another kind of datetime you will sometimes encounter: the Unix timestamp. Many computers store datetime information behind the scenes as the number of seconds since January 1, 1970. This date is largely considered the birth of modern-style computers. To read a Unix timestamp, use the <span class="in">`datetime.fromtimestamp()`</span> method. Python will read your timestamp and return a datetime.</span>
<span id="cb62-435"><a href="#cb62-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-436"><a href="#cb62-436" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 2.2.1</span></span>
<span id="cb62-437"><a href="#cb62-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-438"><a href="#cb62-438" aria-hidden="true" tabindex="-1"></a><span class="fu">### Turning strings into datetimes</span></span>
<span id="cb62-439"><a href="#cb62-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-440"><a href="#cb62-440" aria-hidden="true" tabindex="-1"></a>When you download data from the Internet, dates and times usually come to you as strings. Often the first step is to turn those strings into <span class="in">`datetime`</span> objects.</span>
<span id="cb62-441"><a href="#cb62-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-442"><a href="#cb62-442" aria-hidden="true" tabindex="-1"></a>In this exercise, you will practice this transformation.</span>
<span id="cb62-443"><a href="#cb62-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-444"><a href="#cb62-444" aria-hidden="true" tabindex="-1"></a>|**Reference**|                        |</span>
<span id="cb62-445"><a href="#cb62-445" aria-hidden="true" tabindex="-1"></a>|-------------|------------------------|</span>
<span id="cb62-446"><a href="#cb62-446" aria-hidden="true" tabindex="-1"></a>|%Y           |4 digit year (0000-9999)|</span>
<span id="cb62-447"><a href="#cb62-447" aria-hidden="true" tabindex="-1"></a>|%m           |2 digit month (1-12)    |</span>
<span id="cb62-448"><a href="#cb62-448" aria-hidden="true" tabindex="-1"></a>|%d           |2 digit day (1-31)      |</span>
<span id="cb62-449"><a href="#cb62-449" aria-hidden="true" tabindex="-1"></a>|%H           |2 digit hour (0-23)     |</span>
<span id="cb62-450"><a href="#cb62-450" aria-hidden="true" tabindex="-1"></a>|%M           |2 digit minute (0-59)   |</span>
<span id="cb62-451"><a href="#cb62-451" aria-hidden="true" tabindex="-1"></a>|%S           |2 digit second (0-59)   |</span>
<span id="cb62-452"><a href="#cb62-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-453"><a href="#cb62-453" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions </span></span>
<span id="cb62-454"><a href="#cb62-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-455"><a href="#cb62-455" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Determine the format needed to convert <span class="in">`s`</span> to datetime and assign it to <span class="in">`fmt`</span>.</span>
<span id="cb62-456"><a href="#cb62-456" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>Convert the string s to datetime using fmt.</span>
<span id="cb62-457"><a href="#cb62-457" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Determine the format needed to convert <span class="in">`s1`</span> to datetime and assign it to <span class="in">`fmt1`</span>.</span>
<span id="cb62-458"><a href="#cb62-458" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>Convert the string <span class="in">`s1`</span> to datetime using <span class="in">`fmt1`</span>.</span>
<span id="cb62-459"><a href="#cb62-459" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Determine the format needed to convert <span class="in">`s2`</span> to datetime and assign it to <span class="in">`fmt2`</span>.</span>
<span id="cb62-460"><a href="#cb62-460" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>Convert the string <span class="in">`s2`</span> to datetime using <span class="in">`fmt2`</span></span>
<span id="cb62-461"><a href="#cb62-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-464"><a href="#cb62-464" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-465"><a href="#cb62-465" aria-hidden="true" tabindex="-1"></a><span class="co"># Starting string, in YYYY-MM-DD HH:MM:SS format</span></span>
<span id="cb62-466"><a href="#cb62-466" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> <span class="st">'2017-02-03 00:00:01'</span></span>
<span id="cb62-467"><a href="#cb62-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-468"><a href="#cb62-468" aria-hidden="true" tabindex="-1"></a><span class="co"># Write a format string to parse s</span></span>
<span id="cb62-469"><a href="#cb62-469" aria-hidden="true" tabindex="-1"></a>fmt <span class="op">=</span> <span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S'</span></span>
<span id="cb62-470"><a href="#cb62-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-471"><a href="#cb62-471" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a datetime object d</span></span>
<span id="cb62-472"><a href="#cb62-472" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> datetime.strptime(s, fmt)</span>
<span id="cb62-473"><a href="#cb62-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-474"><a href="#cb62-474" aria-hidden="true" tabindex="-1"></a><span class="co"># Print d</span></span>
<span id="cb62-475"><a href="#cb62-475" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(d)</span>
<span id="cb62-476"><a href="#cb62-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-477"><a href="#cb62-477" aria-hidden="true" tabindex="-1"></a><span class="co"># Starting string, in YYYY-MM-DD format</span></span>
<span id="cb62-478"><a href="#cb62-478" aria-hidden="true" tabindex="-1"></a>s1 <span class="op">=</span> <span class="st">'2030-10-15'</span></span>
<span id="cb62-479"><a href="#cb62-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-480"><a href="#cb62-480" aria-hidden="true" tabindex="-1"></a><span class="co"># Write a format string to parse s</span></span>
<span id="cb62-481"><a href="#cb62-481" aria-hidden="true" tabindex="-1"></a>fmt1 <span class="op">=</span> <span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span></span>
<span id="cb62-482"><a href="#cb62-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-483"><a href="#cb62-483" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a datetime object d</span></span>
<span id="cb62-484"><a href="#cb62-484" aria-hidden="true" tabindex="-1"></a>d1 <span class="op">=</span> datetime.strptime(s1, fmt1)</span>
<span id="cb62-485"><a href="#cb62-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-486"><a href="#cb62-486" aria-hidden="true" tabindex="-1"></a><span class="co"># Print d</span></span>
<span id="cb62-487"><a href="#cb62-487" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(d1)</span>
<span id="cb62-488"><a href="#cb62-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-489"><a href="#cb62-489" aria-hidden="true" tabindex="-1"></a><span class="co"># Starting string, in MM/DD/YYYY HH:MM:SS format</span></span>
<span id="cb62-490"><a href="#cb62-490" aria-hidden="true" tabindex="-1"></a>s2 <span class="op">=</span> <span class="st">'12/15/1986 08:00:00'</span></span>
<span id="cb62-491"><a href="#cb62-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-492"><a href="#cb62-492" aria-hidden="true" tabindex="-1"></a><span class="co"># Write a format string to parse s</span></span>
<span id="cb62-493"><a href="#cb62-493" aria-hidden="true" tabindex="-1"></a>fmt2 <span class="op">=</span> <span class="st">'%m/</span><span class="sc">%d</span><span class="st">/%Y %H:%M:%S'</span></span>
<span id="cb62-494"><a href="#cb62-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-495"><a href="#cb62-495" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a datetime object d</span></span>
<span id="cb62-496"><a href="#cb62-496" aria-hidden="true" tabindex="-1"></a>d2 <span class="op">=</span> datetime.strptime(s2, fmt2)</span>
<span id="cb62-497"><a href="#cb62-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-498"><a href="#cb62-498" aria-hidden="true" tabindex="-1"></a><span class="co"># Print d</span></span>
<span id="cb62-499"><a href="#cb62-499" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(d2)</span>
<span id="cb62-500"><a href="#cb62-500" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-501"><a href="#cb62-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-502"><a href="#cb62-502" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 2.2.2</span></span>
<span id="cb62-503"><a href="#cb62-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-504"><a href="#cb62-504" aria-hidden="true" tabindex="-1"></a><span class="fu">### Parsing pairs of strings as datetimes </span></span>
<span id="cb62-505"><a href="#cb62-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-506"><a href="#cb62-506" aria-hidden="true" tabindex="-1"></a>Up until now, you've been working with a pre-processed list of datetimes for W20529's trips. For this exercise, you're going to go one step back in the data cleaning pipeline and work with the strings that the data started as.</span>
<span id="cb62-507"><a href="#cb62-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-508"><a href="#cb62-508" aria-hidden="true" tabindex="-1"></a>Explore <span class="in">`onebike_datetime_strings`</span> in the IPython shell to determine the correct format.</span>
<span id="cb62-509"><a href="#cb62-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-510"><a href="#cb62-510" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-511"><a href="#cb62-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-512"><a href="#cb62-512" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Outside the <span class="in">`for`</span> loop, fill out the <span class="in">`fmt`</span> string with the correct parsing format for the data.</span>
<span id="cb62-513"><a href="#cb62-513" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Within the <span class="in">`for`</span> loop, parse the <span class="in">`start`</span> and <span class="in">`end`</span> strings into the <span class="in">`trip`</span> dictionary with <span class="in">`Start date`</span> and <span class="in">`End date`</span> keys and <span class="in">`datetime`</span> objects for values.</span>
<span id="cb62-514"><a href="#cb62-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-517"><a href="#cb62-517" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-518"><a href="#cb62-518" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert specific columns to lists</span></span>
<span id="cb62-519"><a href="#cb62-519" aria-hidden="true" tabindex="-1"></a>selected_columns <span class="op">=</span> [<span class="st">'Start date'</span>, <span class="st">'End date'</span>]</span>
<span id="cb62-520"><a href="#cb62-520" aria-hidden="true" tabindex="-1"></a>onebike_datetime_strings <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(rides[<span class="st">'Start date'</span>].astype(<span class="bu">str</span>), rides[<span class="st">'End date'</span>].astype(<span class="bu">str</span>)))</span>
<span id="cb62-521"><a href="#cb62-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-522"><a href="#cb62-522" aria-hidden="true" tabindex="-1"></a><span class="co"># Write down the format string</span></span>
<span id="cb62-523"><a href="#cb62-523" aria-hidden="true" tabindex="-1"></a>fmt <span class="op">=</span> <span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S"</span></span>
<span id="cb62-524"><a href="#cb62-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-525"><a href="#cb62-525" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize a list for holding the pairs of datetime objects</span></span>
<span id="cb62-526"><a href="#cb62-526" aria-hidden="true" tabindex="-1"></a>onebike_datetimes <span class="op">=</span> []</span>
<span id="cb62-527"><a href="#cb62-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-528"><a href="#cb62-528" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over all trips</span></span>
<span id="cb62-529"><a href="#cb62-529" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> start, end <span class="kw">in</span> onebike_datetime_strings:</span>
<span id="cb62-530"><a href="#cb62-530" aria-hidden="true" tabindex="-1"></a>  trip <span class="op">=</span> {<span class="st">'start'</span>: datetime.strptime(start, fmt),</span>
<span id="cb62-531"><a href="#cb62-531" aria-hidden="true" tabindex="-1"></a>          <span class="st">'end'</span>: datetime.strptime(end, fmt)}</span>
<span id="cb62-532"><a href="#cb62-532" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-533"><a href="#cb62-533" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Append the trip</span></span>
<span id="cb62-534"><a href="#cb62-534" aria-hidden="true" tabindex="-1"></a>  onebike_datetimes.append(trip)</span>
<span id="cb62-535"><a href="#cb62-535" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-536"><a href="#cb62-536" aria-hidden="true" tabindex="-1"></a>**Many complex data cleaning tasks follow this same format: start with a list, process each element, and add the processed data to a new list.**</span>
<span id="cb62-537"><a href="#cb62-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-538"><a href="#cb62-538" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 2.2.3</span></span>
<span id="cb62-539"><a href="#cb62-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-540"><a href="#cb62-540" aria-hidden="true" tabindex="-1"></a><span class="fu">### Recreating ISO format with strftime()</span></span>
<span id="cb62-541"><a href="#cb62-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-542"><a href="#cb62-542" aria-hidden="true" tabindex="-1"></a>In the last chapter, you used <span class="in">`strftime()`</span> to create strings from <span class="in">`date`</span> objects. Now that you know about <span class="in">`datetime`</span> objects, let's practice doing something similar.</span>
<span id="cb62-543"><a href="#cb62-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-544"><a href="#cb62-544" aria-hidden="true" tabindex="-1"></a>Re-create the <span class="in">`.isoformat()`</span> method, using <span class="in">`.strftime()`</span>, and print the first trip start in our data set.</span>
<span id="cb62-545"><a href="#cb62-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-546"><a href="#cb62-546" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-547"><a href="#cb62-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-548"><a href="#cb62-548" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Complete <span class="in">`fmt`</span> to match the format of ISO 8601.</span>
<span id="cb62-549"><a href="#cb62-549" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Print <span class="in">`first_start`</span> with both <span class="in">`.isoformat()`</span> and <span class="in">`.strftime()`</span>; they should match.</span>
<span id="cb62-550"><a href="#cb62-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-553"><a href="#cb62-553" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-554"><a href="#cb62-554" aria-hidden="true" tabindex="-1"></a><span class="co"># Pull out the start of the first trip</span></span>
<span id="cb62-555"><a href="#cb62-555" aria-hidden="true" tabindex="-1"></a>first_start <span class="op">=</span> onebike_datetimes[<span class="dv">0</span>][<span class="st">'start'</span>]</span>
<span id="cb62-556"><a href="#cb62-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-557"><a href="#cb62-557" aria-hidden="true" tabindex="-1"></a><span class="co"># Format to feed to strftime()</span></span>
<span id="cb62-558"><a href="#cb62-558" aria-hidden="true" tabindex="-1"></a>fmt <span class="op">=</span> <span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">T%H:%M:%S"</span></span>
<span id="cb62-559"><a href="#cb62-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-560"><a href="#cb62-560" aria-hidden="true" tabindex="-1"></a><span class="co"># Print out date with .isoformat(), then with .strftime() to compare</span></span>
<span id="cb62-561"><a href="#cb62-561" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(first_start.isoformat())</span>
<span id="cb62-562"><a href="#cb62-562" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(first_start.strftime(fmt))</span>
<span id="cb62-563"><a href="#cb62-563" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-564"><a href="#cb62-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-565"><a href="#cb62-565" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 2.2.4</span></span>
<span id="cb62-566"><a href="#cb62-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-567"><a href="#cb62-567" aria-hidden="true" tabindex="-1"></a><span class="fu">### Unix timestamps</span></span>
<span id="cb62-568"><a href="#cb62-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-569"><a href="#cb62-569" aria-hidden="true" tabindex="-1"></a>Datetimes are sometimes stored as Unix timestamps: the number of seconds since January 1, 1970. This is especially common with computer infrastructure, like the log files that websites keep when they get visitors.</span>
<span id="cb62-570"><a href="#cb62-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-571"><a href="#cb62-571" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-572"><a href="#cb62-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-573"><a href="#cb62-573" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Complete the <span class="in">`for`</span> loop to loop over <span class="in">`timestamps`</span>.</span>
<span id="cb62-574"><a href="#cb62-574" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Complete the code to turn each timestamp <span class="in">`ts`</span> into a <span class="in">`datetime`</span>.</span>
<span id="cb62-575"><a href="#cb62-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-578"><a href="#cb62-578" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-579"><a href="#cb62-579" aria-hidden="true" tabindex="-1"></a><span class="co"># Starting timestamps</span></span>
<span id="cb62-580"><a href="#cb62-580" aria-hidden="true" tabindex="-1"></a>timestamps <span class="op">=</span> [<span class="dv">1514665153</span>, <span class="dv">1514664543</span>]</span>
<span id="cb62-581"><a href="#cb62-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-582"><a href="#cb62-582" aria-hidden="true" tabindex="-1"></a><span class="co"># Datetime objects</span></span>
<span id="cb62-583"><a href="#cb62-583" aria-hidden="true" tabindex="-1"></a>dts <span class="op">=</span> []</span>
<span id="cb62-584"><a href="#cb62-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-585"><a href="#cb62-585" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop</span></span>
<span id="cb62-586"><a href="#cb62-586" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ts <span class="kw">in</span> timestamps:</span>
<span id="cb62-587"><a href="#cb62-587" aria-hidden="true" tabindex="-1"></a>  dts.append(datetime.fromtimestamp(ts))</span>
<span id="cb62-588"><a href="#cb62-588" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-589"><a href="#cb62-589" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb62-590"><a href="#cb62-590" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dts)</span>
<span id="cb62-591"><a href="#cb62-591" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-592"><a href="#cb62-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-593"><a href="#cb62-593" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 2.3: Working with durations</span></span>
<span id="cb62-594"><a href="#cb62-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-595"><a href="#cb62-595" aria-hidden="true" tabindex="-1"></a>Much like dates, datetimes have a kind of arithmetic; we can compare them, subtract them, and add intervals to them. Because we are working with both days and times, the logic for durations is a little more complicated, but not by much. Let's have a look.</span>
<span id="cb62-596"><a href="#cb62-596" aria-hidden="true" tabindex="-1"></a>Just as with dates, to get a sense for what's going on we put our datetimes on a timeline. These two datetimes here correspond to the start and end of one ride in our data set.</span>
<span id="cb62-597"><a href="#cb62-597" aria-hidden="true" tabindex="-1"></a>To follow along in Python, we'll load these two in as "start" and "end". When we subtract datetimes, we get a timedelta. A timedelta represents what is called a duration: the elapsed time between events.</span>
<span id="cb62-598"><a href="#cb62-598" aria-hidden="true" tabindex="-1"></a>When we call the method <span class="in">`total_seconds()`</span>, we get back the number of seconds that our timedelta represents. In this case, 1450 seconds elapsed between our start and end. 1450 seconds is 24 minutes and 10 seconds.</span>
<span id="cb62-599"><a href="#cb62-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-600"><a href="#cb62-600" aria-hidden="true" tabindex="-1"></a><span class="fu">### Creating timedeltas</span></span>
<span id="cb62-601"><a href="#cb62-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-602"><a href="#cb62-602" aria-hidden="true" tabindex="-1"></a>You can also create a timedelta by hand. You start by importing timedelta from datetime. To create a timedelta, you specify the amount of time which has elapsed. For example, we make delta1, a timedelta which corresponds to a one second duration.</span>
<span id="cb62-603"><a href="#cb62-603" aria-hidden="true" tabindex="-1"></a>Now when we add delta1 to start, we see that we get back a datetime which is one second later.</span>
<span id="cb62-604"><a href="#cb62-604" aria-hidden="true" tabindex="-1"></a>We also create a timedelta, delta2, which is one day and one second in duration. Now when we add it to start, we get a new datetime which is the next day and one second later. Timedeltas can be created with any number of weeks, days, minutes, hours, seconds, or microseconds, and can be as small as a microsecond or as large as 2-point-7 million years.</span>
<span id="cb62-605"><a href="#cb62-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-606"><a href="#cb62-606" aria-hidden="true" tabindex="-1"></a><span class="fu">### Negative timedeltas</span></span>
<span id="cb62-607"><a href="#cb62-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-608"><a href="#cb62-608" aria-hidden="true" tabindex="-1"></a>Timedeltas can also be negative. For example, if we create delta3, whose argument is -1 weeks, and we add it to start we get a datetime corresponding to one week earlier.</span>
<span id="cb62-609"><a href="#cb62-609" aria-hidden="true" tabindex="-1"></a>We can also subtract a positive timedelta and get the same result. We create delta4, which corresponds to a 1 week duration, and we subtract it from start. As you can see, we get the same answer as when we added a negative timedelta.</span>
<span id="cb62-610"><a href="#cb62-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-611"><a href="#cb62-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-612"><a href="#cb62-612" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 2.3.1</span></span>
<span id="cb62-613"><a href="#cb62-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-614"><a href="#cb62-614" aria-hidden="true" tabindex="-1"></a><span class="fu">### Turning pairs of datetimes into durations</span></span>
<span id="cb62-615"><a href="#cb62-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-616"><a href="#cb62-616" aria-hidden="true" tabindex="-1"></a>When working with timestamps, we often want to know how much time has elapsed between events. Thankfully, we can use <span class="in">`datetime`</span> arithmetic to ask Python to do the heavy lifting for us so we don't need to worry about day, month, or year boundaries. Let's calculate the number of seconds that the bike was out of the dock for each trip.</span>
<span id="cb62-617"><a href="#cb62-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-618"><a href="#cb62-618" aria-hidden="true" tabindex="-1"></a>Continuing our work from a previous coding exercise, the bike trip data has been loaded as the list <span class="in">`onebike_datetimes`</span>. Each element of the list consists of two datetime objects, corresponding to the <span class="in">`start`</span> and <span class="in">`end`</span> of a trip, respectively.</span>
<span id="cb62-619"><a href="#cb62-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-620"><a href="#cb62-620" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-621"><a href="#cb62-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-622"><a href="#cb62-622" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Within the loop:</span>
<span id="cb62-623"><a href="#cb62-623" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>Use arithmetic on the <span class="in">`start`</span> and <span class="in">`end`</span> elements to find the length of the trip</span>
<span id="cb62-624"><a href="#cb62-624" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>Save the results to <span class="in">`trip_duration`</span>.</span>
<span id="cb62-625"><a href="#cb62-625" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>Calculate <span class="in">`trip_length_seconds`</span> from <span class="in">`trip_duration`</span>.</span>
<span id="cb62-626"><a href="#cb62-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-629"><a href="#cb62-629" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-630"><a href="#cb62-630" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize a list for all the trip durations</span></span>
<span id="cb62-631"><a href="#cb62-631" aria-hidden="true" tabindex="-1"></a>onebike_durations <span class="op">=</span> []</span>
<span id="cb62-632"><a href="#cb62-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-633"><a href="#cb62-633" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trip <span class="kw">in</span> onebike_datetimes:</span>
<span id="cb62-634"><a href="#cb62-634" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a timedelta object corresponding to the length of the trip</span></span>
<span id="cb62-635"><a href="#cb62-635" aria-hidden="true" tabindex="-1"></a>  trip_duration <span class="op">=</span> trip[<span class="st">'end'</span>] <span class="op">-</span> trip[<span class="st">'start'</span>]</span>
<span id="cb62-636"><a href="#cb62-636" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-637"><a href="#cb62-637" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the total elapsed seconds in trip_duration</span></span>
<span id="cb62-638"><a href="#cb62-638" aria-hidden="true" tabindex="-1"></a>  trip_length_seconds <span class="op">=</span> trip_duration.total_seconds()</span>
<span id="cb62-639"><a href="#cb62-639" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-640"><a href="#cb62-640" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Append the results to our list</span></span>
<span id="cb62-641"><a href="#cb62-641" aria-hidden="true" tabindex="-1"></a>  onebike_durations.append(trip_length_seconds)</span>
<span id="cb62-642"><a href="#cb62-642" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-643"><a href="#cb62-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-644"><a href="#cb62-644" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 2.3.2</span></span>
<span id="cb62-645"><a href="#cb62-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-646"><a href="#cb62-646" aria-hidden="true" tabindex="-1"></a><span class="fu">### Average trip time</span></span>
<span id="cb62-647"><a href="#cb62-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-648"><a href="#cb62-648" aria-hidden="true" tabindex="-1"></a>W20529 took 291 trips in our data set. How long were the trips on average? We can use the built-in Python functions <span class="in">`sum()`</span> and <span class="in">`len()`</span> to make this calculation.</span>
<span id="cb62-649"><a href="#cb62-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-650"><a href="#cb62-650" aria-hidden="true" tabindex="-1"></a>Based on your last coding exercise, the data has been loaded as <span class="in">`onebike_durations`</span>. Each entry is a number of seconds that the bike was out of the dock.</span>
<span id="cb62-651"><a href="#cb62-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-652"><a href="#cb62-652" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-653"><a href="#cb62-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-654"><a href="#cb62-654" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Calculate <span class="in">`total_elapsed_time`</span> across all trips in <span class="in">`onebike_durations`</span>.</span>
<span id="cb62-655"><a href="#cb62-655" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Calculate <span class="in">`number_of_trips`</span> for <span class="in">`onebike_durations`</span>.</span>
<span id="cb62-656"><a href="#cb62-656" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Divide <span class="in">`total_elapsed_time`</span> by <span class="in">`number_of_trips`</span> to get the <span class="in">`average trip length`</span>.</span>
<span id="cb62-657"><a href="#cb62-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-660"><a href="#cb62-660" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-661"><a href="#cb62-661" aria-hidden="true" tabindex="-1"></a><span class="co"># What was the total duration of all trips?</span></span>
<span id="cb62-662"><a href="#cb62-662" aria-hidden="true" tabindex="-1"></a>total_elapsed_time <span class="op">=</span> <span class="bu">sum</span>(onebike_durations)</span>
<span id="cb62-663"><a href="#cb62-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-664"><a href="#cb62-664" aria-hidden="true" tabindex="-1"></a><span class="co"># What was the total number of trips?</span></span>
<span id="cb62-665"><a href="#cb62-665" aria-hidden="true" tabindex="-1"></a>number_of_trips <span class="op">=</span> <span class="bu">len</span>(onebike_durations)</span>
<span id="cb62-666"><a href="#cb62-666" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-667"><a href="#cb62-667" aria-hidden="true" tabindex="-1"></a><span class="co"># Divide the total duration by the number of trips</span></span>
<span id="cb62-668"><a href="#cb62-668" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(total_elapsed_time <span class="op">/</span> number_of_trips)</span>
<span id="cb62-669"><a href="#cb62-669" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-670"><a href="#cb62-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-671"><a href="#cb62-671" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 2.3.3</span></span>
<span id="cb62-672"><a href="#cb62-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-673"><a href="#cb62-673" aria-hidden="true" tabindex="-1"></a><span class="fu">### The long and the short of why time is hard</span></span>
<span id="cb62-674"><a href="#cb62-674" aria-hidden="true" tabindex="-1"></a>Out of 291 trips taken by W20529, how long was the longest? How short was the shortest? Does anything look fishy?</span>
<span id="cb62-675"><a href="#cb62-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-676"><a href="#cb62-676" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-677"><a href="#cb62-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-678"><a href="#cb62-678" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Calculate <span class="in">`shortest_trip`</span> from <span class="in">`onebike_durations`</span>.</span>
<span id="cb62-679"><a href="#cb62-679" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Calculate <span class="in">`longest_trip`</span> from <span class="in">`onebike_durations`</span>.</span>
<span id="cb62-680"><a href="#cb62-680" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Print the results, turning <span class="in">`shortest_trip`</span> and <span class="in">`longest_trip`</span> into strings so they can print.</span>
<span id="cb62-681"><a href="#cb62-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-684"><a href="#cb62-684" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-685"><a href="#cb62-685" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate shortest and longest trips</span></span>
<span id="cb62-686"><a href="#cb62-686" aria-hidden="true" tabindex="-1"></a>shortest_trip <span class="op">=</span> <span class="bu">min</span>(onebike_durations)</span>
<span id="cb62-687"><a href="#cb62-687" aria-hidden="true" tabindex="-1"></a>longest_trip <span class="op">=</span> <span class="bu">max</span>(onebike_durations)</span>
<span id="cb62-688"><a href="#cb62-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-689"><a href="#cb62-689" aria-hidden="true" tabindex="-1"></a><span class="co"># Print out the results</span></span>
<span id="cb62-690"><a href="#cb62-690" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The shortest trip was "</span> <span class="op">+</span> <span class="bu">str</span>(shortest_trip) <span class="op">+</span> <span class="st">" seconds"</span>)</span>
<span id="cb62-691"><a href="#cb62-691" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The longest trip was "</span> <span class="op">+</span> <span class="bu">str</span>(longest_trip) <span class="op">+</span> <span class="st">" seconds"</span>)</span>
<span id="cb62-692"><a href="#cb62-692" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-693"><a href="#cb62-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-694"><a href="#cb62-694" aria-hidden="true" tabindex="-1"></a><span class="fu"># CHAPTER 3: TIME ZONES AND DAYLIGHT SAVING {#sec-CHAPTER3}</span></span>
<span id="cb62-695"><a href="#cb62-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-696"><a href="#cb62-696" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 3.1: UTC offsets {#sec-Chapter3-1}</span></span>
<span id="cb62-697"><a href="#cb62-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-698"><a href="#cb62-698" aria-hidden="true" tabindex="-1"></a>Sometimes, you really need to know exactly when something happened. Up until now, the datetime objects you have worked with are what is called "naive", and can't be compared across different parts of the world. They don't know anything about their time zone.</span>
<span id="cb62-699"><a href="#cb62-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-700"><a href="#cb62-700" aria-hidden="true" tabindex="-1"></a><span class="fu">### Time zones</span></span>
<span id="cb62-701"><a href="#cb62-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-702"><a href="#cb62-702" aria-hidden="true" tabindex="-1"></a>Why does this matter? Before time zones, each town or city set its clock so that noon was directly overhead.</span>
<span id="cb62-703"><a href="#cb62-703" aria-hidden="true" tabindex="-1"></a>Another city 100 miles away would also set their clocks to be noon when the sun was overhead.</span>
<span id="cb62-704"><a href="#cb62-704" aria-hidden="true" tabindex="-1"></a>But this meant that these two cities had clocks that were different, by maybe 15 or 20 minutes. When people moved by foot or horseback, this wasn't a problem.</span>
<span id="cb62-705"><a href="#cb62-705" aria-hidden="true" tabindex="-1"></a>Then railroads, and later telegraphs, came into existence. Now you could move or communicate with someone 100 or even 1000 miles away fast enough that time had to be consistent.</span>
<span id="cb62-706"><a href="#cb62-706" aria-hidden="true" tabindex="-1"></a>Governments solved this problem by declaring that all clocks within a wide area would agree on the hour, even if some were ahead or behind of their solar time. The United States, for example, has 4 major time zones, plus one for Alaska and another for Hawaii. Our bike data was collected in Washington, DC, which observes Eastern time.</span>
<span id="cb62-707"><a href="#cb62-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-708"><a href="#cb62-708" aria-hidden="true" tabindex="-1"></a><span class="fu">### UTC</span></span>
<span id="cb62-709"><a href="#cb62-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-710"><a href="#cb62-710" aria-hidden="true" tabindex="-1"></a>But since we're not using the sun anymore, how do we know how to set the clock? Because the United Kingdom was the first to standardize its time, everyone in the world sets their clocks relative to the original historical UK standard. This standard time is called UTC. Because all clocks are set relative to UTC, we can compare time around the world. Generally, clocks west of the UK are set earlier than UTC, and clocks east of the UK are set later than UTC. For example, the eastern United States is typically UTC minus 5 hours, while India is typically UTC plus 5 hours 30 minutes.</span>
<span id="cb62-711"><a href="#cb62-711" aria-hidden="true" tabindex="-1"></a>Let's see this in code. As before, you import datetime and timedelta. Now you also import timezone. This will let you specify what timezone the clock was in when our data was recorded.</span>
<span id="cb62-712"><a href="#cb62-712" aria-hidden="true" tabindex="-1"></a>We create a timezone object, which accepts a timedelta that explains how to translate your datetime into UTC. In this case, since the clock that measured our bicycle data set was five hours behind UTC, we create ET to be at UTC-5. We can specify what time zone the clock was in when the last ride started in our data set. The clock that recorded the ride was 5 hours behind UTC. Now if you print it, your datetime includes the UTC offset.</span>
<span id="cb62-713"><a href="#cb62-713" aria-hidden="true" tabindex="-1"></a>Making a datetime "aware" of its timezone means you can ask Python new questions. For example, suppose you want to know what the date and time would have been if the clock had been set to India Standard Time instead. First, create a new timezone object set to UTC plus 5 hours 30 minutes. Now use the <span class="in">`astimezone()`</span> method to ask Python to create a new datetime object corresponding to the same moment, but adjusted to a different time zone. In this case, because clocks in India would have been set 10-point-5 hours ahead of clocks on the eastern US, the last ride would have taken place on December 31, at 1 hour, 39 minutes, and 3 seconds past midnight local time. Same moment, different clock.</span>
<span id="cb62-714"><a href="#cb62-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-715"><a href="#cb62-715" aria-hidden="true" tabindex="-1"></a><span class="fu">### Adjusting timezone vs changing tzinfo</span></span>
<span id="cb62-716"><a href="#cb62-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-717"><a href="#cb62-717" aria-hidden="true" tabindex="-1"></a>Finally, there is an important difference between adjusting timezones and changing the <span class="in">`tzinfo`</span> directly. You can set the <span class="in">`tzinfo`</span> directly, using the <span class="in">`replace()`</span> method. Here we've set the <span class="in">`tzinfo`</span> to be <span class="in">`timezone.utc`</span>, a convenient object with zero UTC offset. The clock stays the same, but the UTC offset has shifted. Or, just like before, you can call the <span class="in">`astimezone()`</span> method. Now if we adjust into UTC with astimezone(<span class="in">`timezone.utc`</span>), we change both the UTC offset and the clock itself.</span>
<span id="cb62-718"><a href="#cb62-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-719"><a href="#cb62-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-720"><a href="#cb62-720" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 3.1.1</span></span>
<span id="cb62-721"><a href="#cb62-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-722"><a href="#cb62-722" aria-hidden="true" tabindex="-1"></a><span class="fu">### Creating timezone aware datetimes</span></span>
<span id="cb62-723"><a href="#cb62-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-724"><a href="#cb62-724" aria-hidden="true" tabindex="-1"></a>In this exercise, you will practice setting timezones manually.</span>
<span id="cb62-725"><a href="#cb62-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-726"><a href="#cb62-726" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions </span></span>
<span id="cb62-727"><a href="#cb62-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-728"><a href="#cb62-728" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Import <span class="in">`timezone`</span>.</span>
<span id="cb62-729"><a href="#cb62-729" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>Set the <span class="in">`tzinfo`</span> to <span class="in">`UTC`</span>, without using <span class="in">`timedelta`</span>.</span>
<span id="cb62-730"><a href="#cb62-730" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Set <span class="in">`pst`</span> to be a timezone set for UTC-8.</span>
<span id="cb62-731"><a href="#cb62-731" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>Set <span class="in">`dt1`</span>'s timezone to be <span class="in">`pst`</span>.</span>
<span id="cb62-732"><a href="#cb62-732" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Set <span class="in">`aedt`</span> to be a timezone set for UTC+11.</span>
<span id="cb62-733"><a href="#cb62-733" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>Set <span class="in">`dt2`</span>'s timezone to be <span class="in">`aedt`</span>.</span>
<span id="cb62-734"><a href="#cb62-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-737"><a href="#cb62-737" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-738"><a href="#cb62-738" aria-hidden="true" tabindex="-1"></a><span class="co"># October 1, 2017 at 15:26:26, UTC</span></span>
<span id="cb62-739"><a href="#cb62-739" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> datetime(<span class="dv">2017</span>, <span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">15</span>, <span class="dv">26</span>, <span class="dv">26</span>, tzinfo<span class="op">=</span>timezone.utc)</span>
<span id="cb62-740"><a href="#cb62-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-741"><a href="#cb62-741" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb62-742"><a href="#cb62-742" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dt.isoformat())</span>
<span id="cb62-743"><a href="#cb62-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-744"><a href="#cb62-744" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a timezone for Pacific Standard Time, or UTC-8</span></span>
<span id="cb62-745"><a href="#cb62-745" aria-hidden="true" tabindex="-1"></a>pst <span class="op">=</span> timezone(timedelta(hours<span class="op">=-</span><span class="dv">8</span>))</span>
<span id="cb62-746"><a href="#cb62-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-747"><a href="#cb62-747" aria-hidden="true" tabindex="-1"></a><span class="co"># October 1, 2017 at 15:26:26, UTC-8</span></span>
<span id="cb62-748"><a href="#cb62-748" aria-hidden="true" tabindex="-1"></a>dt1 <span class="op">=</span> datetime(<span class="dv">2017</span>, <span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">15</span>, <span class="dv">26</span>, <span class="dv">26</span>, tzinfo<span class="op">=</span>pst)</span>
<span id="cb62-749"><a href="#cb62-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-750"><a href="#cb62-750" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb62-751"><a href="#cb62-751" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dt1.isoformat())</span>
<span id="cb62-752"><a href="#cb62-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-753"><a href="#cb62-753" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a timezone for Australian Eastern Daylight Time, or UTC+11</span></span>
<span id="cb62-754"><a href="#cb62-754" aria-hidden="true" tabindex="-1"></a>aedt <span class="op">=</span> timezone(timedelta(hours<span class="op">=</span><span class="dv">11</span>))</span>
<span id="cb62-755"><a href="#cb62-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-756"><a href="#cb62-756" aria-hidden="true" tabindex="-1"></a><span class="co"># October 1, 2017 at 15:26:26, UTC+11</span></span>
<span id="cb62-757"><a href="#cb62-757" aria-hidden="true" tabindex="-1"></a>dt2 <span class="op">=</span> datetime(<span class="dv">2017</span>, <span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">15</span>, <span class="dv">26</span>, <span class="dv">26</span>, tzinfo<span class="op">=</span>aedt)</span>
<span id="cb62-758"><a href="#cb62-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-759"><a href="#cb62-759" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb62-760"><a href="#cb62-760" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dt2.isoformat())</span>
<span id="cb62-761"><a href="#cb62-761" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-762"><a href="#cb62-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-763"><a href="#cb62-763" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 3.1.2</span></span>
<span id="cb62-764"><a href="#cb62-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-765"><a href="#cb62-765" aria-hidden="true" tabindex="-1"></a><span class="fu">### Setting timezones</span></span>
<span id="cb62-766"><a href="#cb62-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-767"><a href="#cb62-767" aria-hidden="true" tabindex="-1"></a>Now that you have the hang of setting timezones one at a time, let's look at setting them for the first ten trips that W20529 took.</span>
<span id="cb62-768"><a href="#cb62-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-769"><a href="#cb62-769" aria-hidden="true" tabindex="-1"></a>Make the change using <span class="in">`.replace()`</span></span>
<span id="cb62-770"><a href="#cb62-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-771"><a href="#cb62-771" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-772"><a href="#cb62-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-773"><a href="#cb62-773" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Create <span class="in">`edt`</span>, a <span class="in">`timezone`</span> object whose UTC offset is -4 hours.</span>
<span id="cb62-774"><a href="#cb62-774" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Within the <span class="in">`for`</span> loop:</span>
<span id="cb62-775"><a href="#cb62-775" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Set the <span class="in">`tzinfo`</span> for <span class="in">`trip['start']`</span>.</span>
<span id="cb62-776"><a href="#cb62-776" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Set the <span class="in">`tzinfo`</span> for <span class="in">`trip['end']`</span>.</span>
<span id="cb62-777"><a href="#cb62-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-780"><a href="#cb62-780" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-781"><a href="#cb62-781" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a timezone object corresponding to UTC-4</span></span>
<span id="cb62-782"><a href="#cb62-782" aria-hidden="true" tabindex="-1"></a>edt <span class="op">=</span> timezone(timedelta(hours<span class="op">=-</span><span class="dv">4</span>))</span>
<span id="cb62-783"><a href="#cb62-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-784"><a href="#cb62-784" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over trips, updating the start and end datetimes to be in UTC-4</span></span>
<span id="cb62-785"><a href="#cb62-785" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trip <span class="kw">in</span> onebike_datetimes[:<span class="dv">10</span>]:</span>
<span id="cb62-786"><a href="#cb62-786" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Update trip['start'] and trip['end']</span></span>
<span id="cb62-787"><a href="#cb62-787" aria-hidden="true" tabindex="-1"></a>  trip[<span class="st">'start'</span>] <span class="op">=</span> trip[<span class="st">'start'</span>].replace(tzinfo<span class="op">=</span>edt)</span>
<span id="cb62-788"><a href="#cb62-788" aria-hidden="true" tabindex="-1"></a>  trip[<span class="st">'end'</span>] <span class="op">=</span> trip[<span class="st">'end'</span>].replace(tzinfo<span class="op">=</span>edt)</span>
<span id="cb62-789"><a href="#cb62-789" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-790"><a href="#cb62-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-791"><a href="#cb62-791" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 3.1.3</span></span>
<span id="cb62-792"><a href="#cb62-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-793"><a href="#cb62-793" aria-hidden="true" tabindex="-1"></a><span class="fu">### What time did the bike leave in UTC?</span></span>
<span id="cb62-794"><a href="#cb62-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-795"><a href="#cb62-795" aria-hidden="true" tabindex="-1"></a>Having set the timezone for the first ten rides that W20529 took, let's see what time the bike left in UTC. </span>
<span id="cb62-796"><a href="#cb62-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-797"><a href="#cb62-797" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-798"><a href="#cb62-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-799"><a href="#cb62-799" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Within the <span class="in">`for`</span> loop, move <span class="in">`dt`</span> to be in UTC. Use <span class="in">`timezone.utc`</span> as a convenient shortcut for UTC.</span>
<span id="cb62-800"><a href="#cb62-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-803"><a href="#cb62-803" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-804"><a href="#cb62-804" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over the trips</span></span>
<span id="cb62-805"><a href="#cb62-805" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trip <span class="kw">in</span> onebike_datetimes[:<span class="dv">10</span>]:</span>
<span id="cb62-806"><a href="#cb62-806" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pull out the start</span></span>
<span id="cb62-807"><a href="#cb62-807" aria-hidden="true" tabindex="-1"></a>  dt3 <span class="op">=</span> trip[<span class="st">'start'</span>]</span>
<span id="cb62-808"><a href="#cb62-808" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Move dt to be in UTC</span></span>
<span id="cb62-809"><a href="#cb62-809" aria-hidden="true" tabindex="-1"></a>  dt3 <span class="op">=</span> dt3.astimezone(timezone.utc)</span>
<span id="cb62-810"><a href="#cb62-810" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the start time in UTC</span></span>
<span id="cb62-811"><a href="#cb62-811" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">'Original:'</span>, trip[<span class="st">'start'</span>], <span class="st">'| UTC:'</span>, dt3.isoformat())</span>
<span id="cb62-812"><a href="#cb62-812" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-813"><a href="#cb62-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-814"><a href="#cb62-814" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 3.2: Time zone database</span></span>
<span id="cb62-815"><a href="#cb62-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-816"><a href="#cb62-816" aria-hidden="true" tabindex="-1"></a>Now that you understand how UTC offsets work, it's time to talk about how you use timezones in practice.</span>
<span id="cb62-817"><a href="#cb62-817" aria-hidden="true" tabindex="-1"></a>This is a picture of all of the different time zones in the world, as of 2017. They cut across countries, and within countries, and sometimes one is even totally surrounded by another one. How could you possibly know all of these when you need to align your data to UTC? Do you need to look up the offset for each one in some big spreadsheet somewhere? Can't a computer help with this?</span>
<span id="cb62-818"><a href="#cb62-818" aria-hidden="true" tabindex="-1"></a>Thankfully, yes. There is a database called tz, updated 3-4 times a year as timezone rules change. This database is used by computer programs across many programming languages. Because timezone information changes so quickly, it doesn't make sense to bundle it directly into Python. Instead, you will use a package called <span class="in">`dateutil`</span>.</span>
<span id="cb62-819"><a href="#cb62-819" aria-hidden="true" tabindex="-1"></a>Let's start by making a <span class="in">`timezone`</span> object that corresponds to the eastern United States, where our bicycle data comes from. Within tz, time zones are defined first by the continent they are on, and then by the nearest major city. For example, the time zone used on the eastern seaboard of the United States is 'America/New York'. We fetch this <span class="in">`timezone`</span> by calling <span class="in">`tz.gettz()`</span>, and passing 'America/New York' as the string.</span>
<span id="cb62-820"><a href="#cb62-820" aria-hidden="true" tabindex="-1"></a>Here are a few more examples: 'America/Mexico_City'. 'Europe/London'. 'Africa/Accra'.</span>
<span id="cb62-821"><a href="#cb62-821" aria-hidden="true" tabindex="-1"></a>Let's look at our last ride again. Instead of specifying the UTC offset yourself, you pass the timezone you got from tz. Look at the result, and you can see that it's got the right UTC offset.</span>
<span id="cb62-822"><a href="#cb62-822" aria-hidden="true" tabindex="-1"></a>Even more excitingly, this same object will adjust the UTC offset depending on the date and time. If we call <span class="in">`datetime()`</span> with the time of our first ride, and pass in the same timezone info, we see that it gives us a different UTC offset. We will discuss daylight savings time in the next lesson, but suffice to say that in some places the clocks change twice a year. Instead of having to look up when these things change, we just ask the timezone database to know for us. tz includes rules for UTC offsets going all the way back to the late 1960s, and sometimes earlier. If you have data stretching over a long period of time, and you really care about getting the exact hours and minutes correct, you can use tz to put all of your date and timestamps on to a common scale.</span>
<span id="cb62-823"><a href="#cb62-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-824"><a href="#cb62-824" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 3.2.1</span></span>
<span id="cb62-825"><a href="#cb62-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-826"><a href="#cb62-826" aria-hidden="true" tabindex="-1"></a><span class="fu">### Putting the bike trips into the right time zone</span></span>
<span id="cb62-827"><a href="#cb62-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-828"><a href="#cb62-828" aria-hidden="true" tabindex="-1"></a>Instead of setting the timezones for W20529 by hand, let's assign them to their IANA timezone: 'America/New_York'. Since we know their political jurisdiction, we don't need to look up their UTC offset. Python will do that for us.</span>
<span id="cb62-829"><a href="#cb62-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-830"><a href="#cb62-830" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-831"><a href="#cb62-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-832"><a href="#cb62-832" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Import <span class="in">`tz`</span> from <span class="in">`dateutil`</span>.</span>
<span id="cb62-833"><a href="#cb62-833" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Assign <span class="in">`et`</span> to be the timezone <span class="in">`'America/New_York'`</span>.</span>
<span id="cb62-834"><a href="#cb62-834" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Within the <span class="in">`for`</span> loop, set <span class="in">`start`</span> and <span class="in">`end`</span> to have <span class="in">`et`</span> as their timezone (use <span class="in">`.replace()`</span>).</span>
<span id="cb62-835"><a href="#cb62-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-838"><a href="#cb62-838" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-839"><a href="#cb62-839" aria-hidden="true" tabindex="-1"></a> <span class="co"># Import tz</span></span>
<span id="cb62-840"><a href="#cb62-840" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dateutil <span class="im">import</span> tz </span>
<span id="cb62-841"><a href="#cb62-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-842"><a href="#cb62-842" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a timezone object for Eastern Time</span></span>
<span id="cb62-843"><a href="#cb62-843" aria-hidden="true" tabindex="-1"></a>et <span class="op">=</span> tz.gettz(<span class="st">'America/New_York'</span>)</span>
<span id="cb62-844"><a href="#cb62-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-845"><a href="#cb62-845" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over trips, updating the datetimes to be in Eastern Time</span></span>
<span id="cb62-846"><a href="#cb62-846" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trip <span class="kw">in</span> onebike_datetimes[:<span class="dv">10</span>]:</span>
<span id="cb62-847"><a href="#cb62-847" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Update trip['start'] and trip['end']</span></span>
<span id="cb62-848"><a href="#cb62-848" aria-hidden="true" tabindex="-1"></a>  trip[<span class="st">'start'</span>] <span class="op">=</span> trip[<span class="st">'start'</span>].replace(tzinfo<span class="op">=</span>et)</span>
<span id="cb62-849"><a href="#cb62-849" aria-hidden="true" tabindex="-1"></a>  trip[<span class="st">'end'</span>] <span class="op">=</span> trip[<span class="st">'end'</span>].replace(tzinfo<span class="op">=</span>et)</span>
<span id="cb62-850"><a href="#cb62-850" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-851"><a href="#cb62-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-852"><a href="#cb62-852" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 3.2.2</span></span>
<span id="cb62-853"><a href="#cb62-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-854"><a href="#cb62-854" aria-hidden="true" tabindex="-1"></a><span class="fu">### What time did the bike leave? (Global edition)</span></span>
<span id="cb62-855"><a href="#cb62-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-856"><a href="#cb62-856" aria-hidden="true" tabindex="-1"></a>When you need to move a datetime from one <span class="in">`timezone`</span> into another, use <span class="in">`.astimezone()`</span> and <span class="in">`tz`</span>. Often you will be moving things into UTC, but for fun let's try moving things from 'America/New_York' into a few different time zones.</span>
<span id="cb62-857"><a href="#cb62-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-858"><a href="#cb62-858" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions </span></span>
<span id="cb62-859"><a href="#cb62-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-860"><a href="#cb62-860" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Set <span class="in">`uk`</span> to be the timezone for the UK: 'Europe/London'.</span>
<span id="cb62-861"><a href="#cb62-861" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>Change <span class="in">`local`</span> to be in the <span class="in">`uk`</span> timezone and assign it to <span class="in">`notlocal`</span>.</span>
<span id="cb62-862"><a href="#cb62-862" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Set <span class="in">`ist`</span> to be the timezone for India: 'Asia/Kolkata'.</span>
<span id="cb62-863"><a href="#cb62-863" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>Change <span class="in">`local1`</span> to be in the <span class="in">`ist`</span> timezone and assign it to <span class="in">`notlocal1`</span>.</span>
<span id="cb62-864"><a href="#cb62-864" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Set <span class="in">`sm`</span> to be the timezone for Samoa: 'Pacific/Apia'.</span>
<span id="cb62-865"><a href="#cb62-865" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>Change <span class="in">`local2`</span> to be in the <span class="in">`sm`</span> timezone and assign it to <span class="in">`notlocal2`</span>.</span>
<span id="cb62-866"><a href="#cb62-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-869"><a href="#cb62-869" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-870"><a href="#cb62-870" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the timezone object</span></span>
<span id="cb62-871"><a href="#cb62-871" aria-hidden="true" tabindex="-1"></a>uk <span class="op">=</span> tz.gettz(<span class="st">'Europe/London'</span>)</span>
<span id="cb62-872"><a href="#cb62-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-873"><a href="#cb62-873" aria-hidden="true" tabindex="-1"></a><span class="co"># Pull out the start of the first trip</span></span>
<span id="cb62-874"><a href="#cb62-874" aria-hidden="true" tabindex="-1"></a>local <span class="op">=</span> onebike_datetimes[<span class="dv">0</span>][<span class="st">'start'</span>]</span>
<span id="cb62-875"><a href="#cb62-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-876"><a href="#cb62-876" aria-hidden="true" tabindex="-1"></a><span class="co"># What time was it in the UK?</span></span>
<span id="cb62-877"><a href="#cb62-877" aria-hidden="true" tabindex="-1"></a>notlocal <span class="op">=</span> local.astimezone(uk)</span>
<span id="cb62-878"><a href="#cb62-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-879"><a href="#cb62-879" aria-hidden="true" tabindex="-1"></a><span class="co"># Print them out and see the difference</span></span>
<span id="cb62-880"><a href="#cb62-880" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(local.isoformat())</span>
<span id="cb62-881"><a href="#cb62-881" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(notlocal.isoformat())</span>
<span id="cb62-882"><a href="#cb62-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-883"><a href="#cb62-883" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the timezone object</span></span>
<span id="cb62-884"><a href="#cb62-884" aria-hidden="true" tabindex="-1"></a>ist <span class="op">=</span> tz.gettz(<span class="st">'Asia/Kolkata'</span>)</span>
<span id="cb62-885"><a href="#cb62-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-886"><a href="#cb62-886" aria-hidden="true" tabindex="-1"></a><span class="co"># Pull out the start of the first trip</span></span>
<span id="cb62-887"><a href="#cb62-887" aria-hidden="true" tabindex="-1"></a>local1 <span class="op">=</span> onebike_datetimes[<span class="dv">0</span>][<span class="st">'start'</span>]</span>
<span id="cb62-888"><a href="#cb62-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-889"><a href="#cb62-889" aria-hidden="true" tabindex="-1"></a><span class="co"># What time was it in India?</span></span>
<span id="cb62-890"><a href="#cb62-890" aria-hidden="true" tabindex="-1"></a>notlocal1 <span class="op">=</span> local1.astimezone(ist)</span>
<span id="cb62-891"><a href="#cb62-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-892"><a href="#cb62-892" aria-hidden="true" tabindex="-1"></a><span class="co"># Print them out and see the difference</span></span>
<span id="cb62-893"><a href="#cb62-893" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(local1.isoformat())</span>
<span id="cb62-894"><a href="#cb62-894" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(notlocal1.isoformat())</span>
<span id="cb62-895"><a href="#cb62-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-896"><a href="#cb62-896" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the timezone object</span></span>
<span id="cb62-897"><a href="#cb62-897" aria-hidden="true" tabindex="-1"></a>sm <span class="op">=</span> tz.gettz(<span class="st">'Pacific/Apia'</span>)</span>
<span id="cb62-898"><a href="#cb62-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-899"><a href="#cb62-899" aria-hidden="true" tabindex="-1"></a><span class="co"># Pull out the start of the first trip</span></span>
<span id="cb62-900"><a href="#cb62-900" aria-hidden="true" tabindex="-1"></a>local2 <span class="op">=</span> onebike_datetimes[<span class="dv">0</span>][<span class="st">'start'</span>]</span>
<span id="cb62-901"><a href="#cb62-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-902"><a href="#cb62-902" aria-hidden="true" tabindex="-1"></a><span class="co"># What time was it in Samoa?</span></span>
<span id="cb62-903"><a href="#cb62-903" aria-hidden="true" tabindex="-1"></a>notlocal2 <span class="op">=</span> local2.astimezone(sm)</span>
<span id="cb62-904"><a href="#cb62-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-905"><a href="#cb62-905" aria-hidden="true" tabindex="-1"></a><span class="co"># Print them out and see the difference</span></span>
<span id="cb62-906"><a href="#cb62-906" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(local2.isoformat())</span>
<span id="cb62-907"><a href="#cb62-907" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(notlocal2.isoformat())</span>
<span id="cb62-908"><a href="#cb62-908" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-909"><a href="#cb62-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-910"><a href="#cb62-910" aria-hidden="true" tabindex="-1"></a><span class="fu">### Chapter 3.3: Starting Daylight Saving Time {#sec-Chapter3-3}</span></span>
<span id="cb62-911"><a href="#cb62-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-912"><a href="#cb62-912" aria-hidden="true" tabindex="-1"></a>Some places change their clocks twice a year to create longer summer evenings. This practice is called daylight saving time, but it would better be called daylight shifting time. In some countries it is called "summer time". Dealing with daylight saving time can be one of the most fiendish challenges in dealing with dates and times. To keep things simple, let's start with the situation where the clocks move forward in the spring. In the next lesson, we'll discuss handling the opposite case, when the clocks move back in the fall.</span>
<span id="cb62-913"><a href="#cb62-913" aria-hidden="true" tabindex="-1"></a>Let's look at an example. On March 12, 2017, in Washington, DC, the clock jumped straight from 1:59 am to 3 am. The clock "springs forward". It never officially struck 2 am anywhere on the East Coast of the United States that day.</span>
<span id="cb62-914"><a href="#cb62-914" aria-hidden="true" tabindex="-1"></a>Just like before, to make our clock in Washington, DC comparable to clocks in other places, we need to represent it with a UTC offset. Only now the UTC offset is going to change. On this date, at 1 AM in Washington, DC, we were in Eastern Standard Time. It was 6 AM UTC, a five-hour difference. At 3 AM in Washington, DC, we were in Eastern Daylight Time. It was 7 AM UTC, a four-hour difference.</span>
<span id="cb62-915"><a href="#cb62-915" aria-hidden="true" tabindex="-1"></a>Let's see the same thing in code. To be as clear as possible, let's create the UTC offsets by hand for now instead of using <span class="in">`dateutil.tz`</span>   . We start by creating a datetime object, spring_ahead_159am, for March 12th, at 1:59:59, without any <span class="in">`timezone`</span> information. We print the results out with <span class="in">`isoformat()`</span> to check that we have the time right, and we make another object for spring_ahead_3am. We subtract the two <span class="in">`datetime`</span> objects and ask how much time has elapsed by calling <span class="in">`total_seconds()`</span>. As expected, they're an hour and one second apart.</span>
<span id="cb62-916"><a href="#cb62-916" aria-hidden="true" tabindex="-1"></a>As before, to fix problems with comparing datetimes we start by creating timezone objects. We define Eastern Standard Time, or EST, using the <span class="in">`timezone`</span> constructor. We set the offset to -5 hours. Similarly, we define Eastern Daylight Time, or EDT, with an offset of -4 hours.</span>
<span id="cb62-917"><a href="#cb62-917" aria-hidden="true" tabindex="-1"></a>We assign our first timestamp, at 1:59 am to be in EST. When we call <span class="in">`isoformat()`</span>, we see it has the correct offset. We assign our second timestamp, at 3:00 am, to be in EDT, and again check the output with <span class="in">`isoformat()`</span>. When we subtract the two datetime objects, we see correctly that one second has elapsed. Putting things in terms of UTC once again allowed us to make proper comparisons.</span>
<span id="cb62-918"><a href="#cb62-918" aria-hidden="true" tabindex="-1"></a>But how do we know when the cutoff is without looking it up ourselves? <span class="in">`dateuti`</span>l to the rescue again. Just like before when it saved us from having to define <span class="in">`timezones`</span> by hand, <span class="in">`dateutil`</span> saves us from having to know daylight savings rules. We create a <span class="in">`timezone`</span> object by calling <span class="in">`tz.gettz()`</span> and pass our timezone description string. Recall that since Washington, DC is in the America/New_York time zone, that's what we use. Once again we create a datetime corresponding to 1:59 am on the day that the east coast of the US springs forward. This time though, we set the tzinfo to eastern time. Similarly, we create a datetime set to 3 am on March 12th, and when we set tzinfo to be eastern time, <span class="in">`dateutil`</span> figures out for us that it should be in EDT.</span>
<span id="cb62-919"><a href="#cb62-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-920"><a href="#cb62-920" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 3.3.1</span></span>
<span id="cb62-921"><a href="#cb62-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-922"><a href="#cb62-922" aria-hidden="true" tabindex="-1"></a><span class="fu">### How many hours elapsed around daylight saving?</span></span>
<span id="cb62-923"><a href="#cb62-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-924"><a href="#cb62-924" aria-hidden="true" tabindex="-1"></a>Since our bike data takes place in the fall, you'll have to do something else to learn about the start of daylight savings time.</span>
<span id="cb62-925"><a href="#cb62-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-926"><a href="#cb62-926" aria-hidden="true" tabindex="-1"></a>Let's look at March 12, 2017, in the Eastern United States, when Daylight Saving kicked in at 2 AM.</span>
<span id="cb62-927"><a href="#cb62-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-928"><a href="#cb62-928" aria-hidden="true" tabindex="-1"></a>If you create a <span class="in">`datetime`</span> for midnight that night, and add 6 hours to it, how much time will have elapsed?</span>
<span id="cb62-929"><a href="#cb62-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-930"><a href="#cb62-930" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions </span></span>
<span id="cb62-931"><a href="#cb62-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-932"><a href="#cb62-932" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You already have a <span class="in">`datetime`</span> called <span class="in">`start`</span>, set for March 12, 2017 at midnight, set to the timezone <span class="in">`'America/New_York'`</span>.</span>
<span id="cb62-933"><a href="#cb62-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-934"><a href="#cb62-934" aria-hidden="true" tabindex="-1"></a>Add six hours to <span class="in">`start`</span> and assign it to <span class="in">`end`</span>. Look at the UTC offset for the two results.</span>
<span id="cb62-935"><a href="#cb62-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-936"><a href="#cb62-936" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You added 6 hours, and got 6 AM, despite the fact that the clocks springing forward means only 5 hours would have actually elapsed!</span>
<span id="cb62-937"><a href="#cb62-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-938"><a href="#cb62-938" aria-hidden="true" tabindex="-1"></a>Calculate the time between <span class="in">`start`</span> and <span class="in">`end`</span>. How much time does Python think has elapsed?</span>
<span id="cb62-939"><a href="#cb62-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-940"><a href="#cb62-940" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Move your <span class="in">`datetime`</span> objects into UTC and calculate the elapsed time again.</span>
<span id="cb62-941"><a href="#cb62-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-942"><a href="#cb62-942" aria-hidden="true" tabindex="-1"></a>Once you're in UTC, what result do you get?</span>
<span id="cb62-943"><a href="#cb62-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-946"><a href="#cb62-946" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-947"><a href="#cb62-947" aria-hidden="true" tabindex="-1"></a><span class="co"># Start on March 12, 2017, midnight, then add 6 hours</span></span>
<span id="cb62-948"><a href="#cb62-948" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> datetime(<span class="dv">2017</span>, <span class="dv">3</span>, <span class="dv">12</span>, tzinfo <span class="op">=</span> tz.gettz(<span class="st">'America/New_York'</span>))</span>
<span id="cb62-949"><a href="#cb62-949" aria-hidden="true" tabindex="-1"></a>end <span class="op">=</span> start <span class="op">+</span>  timedelta(hours<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb62-950"><a href="#cb62-950" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(start.isoformat() <span class="op">+</span> <span class="st">" to "</span> <span class="op">+</span> end.isoformat())</span>
<span id="cb62-951"><a href="#cb62-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-952"><a href="#cb62-952" aria-hidden="true" tabindex="-1"></a><span class="co"># How many hours have elapsed?</span></span>
<span id="cb62-953"><a href="#cb62-953" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>((end <span class="op">-</span> start).total_seconds()<span class="op">/</span>(<span class="dv">60</span><span class="op">*</span><span class="dv">60</span>))</span>
<span id="cb62-954"><a href="#cb62-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-955"><a href="#cb62-955" aria-hidden="true" tabindex="-1"></a><span class="co"># What if we move to UTC?</span></span>
<span id="cb62-956"><a href="#cb62-956" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>((end.astimezone(timezone.utc) <span class="op">-</span> start.astimezone(timezone.utc))<span class="op">\</span></span>
<span id="cb62-957"><a href="#cb62-957" aria-hidden="true" tabindex="-1"></a>      .total_seconds()<span class="op">/</span>(<span class="dv">60</span><span class="op">*</span><span class="dv">60</span>))</span>
<span id="cb62-958"><a href="#cb62-958" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-959"><a href="#cb62-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-960"><a href="#cb62-960" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 3.3.2</span></span>
<span id="cb62-961"><a href="#cb62-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-962"><a href="#cb62-962" aria-hidden="true" tabindex="-1"></a><span class="fu">### March 29, throughout a decade</span></span>
<span id="cb62-963"><a href="#cb62-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-964"><a href="#cb62-964" aria-hidden="true" tabindex="-1"></a>Daylight Saving rules are complicated: they're different in different places, they change over time, and they usually start on a Sunday (and so they move around the calendar).</span>
<span id="cb62-965"><a href="#cb62-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-966"><a href="#cb62-966" aria-hidden="true" tabindex="-1"></a>For example, in the United Kingdom, as of the time this lesson was written, Daylight Saving begins on the last Sunday in March. Let's look at the UTC offset for March 29, at midnight, for the years 2000 to 2010.</span>
<span id="cb62-967"><a href="#cb62-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-968"><a href="#cb62-968" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-969"><a href="#cb62-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-970"><a href="#cb62-970" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Using <span class="in">`tz`</span>, set the timezone for dt to be <span class="in">`'Europe/London'`</span>.</span>
<span id="cb62-971"><a href="#cb62-971" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Within the <span class="in">`for`</span> loop:</span>
<span id="cb62-972"><a href="#cb62-972" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use the <span class="in">`.replace()`</span> method to change the year for <span class="in">`dt4`</span> to be <span class="in">`y`</span>.</span>
<span id="cb62-973"><a href="#cb62-973" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Call <span class="in">`.isoformat()`</span> on the result to observe the results.</span>
<span id="cb62-974"><a href="#cb62-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-977"><a href="#cb62-977" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-978"><a href="#cb62-978" aria-hidden="true" tabindex="-1"></a><span class="co"># Create starting date</span></span>
<span id="cb62-979"><a href="#cb62-979" aria-hidden="true" tabindex="-1"></a>dt4 <span class="op">=</span> datetime(<span class="dv">2000</span>, <span class="dv">3</span>, <span class="dv">29</span>, tzinfo <span class="op">=</span> tz.gettz(<span class="st">'Europe/London'</span>))</span>
<span id="cb62-980"><a href="#cb62-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-981"><a href="#cb62-981" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over the dates, replacing the year, and print the ISO timestamp</span></span>
<span id="cb62-982"><a href="#cb62-982" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2000</span>, <span class="dv">2011</span>):</span>
<span id="cb62-983"><a href="#cb62-983" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(dt4.replace(year<span class="op">=</span>y).isoformat())</span>
<span id="cb62-984"><a href="#cb62-984" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-985"><a href="#cb62-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-986"><a href="#cb62-986" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 3.4: Ending Daylight Saving Time</span></span>
<span id="cb62-987"><a href="#cb62-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-988"><a href="#cb62-988" aria-hidden="true" tabindex="-1"></a>In the previous lesson @sec-Chapter3-3, we discussed how to handle when the clock "springs ahead" and we enter daylight saving. In the fall, when the clocks are reset back to standard time, an interesting wrinkle occurs. In this lesson, we'll finish our discussion of daylight saving time by showing what happens when we "fall back", and also talk about how to unambiguously handle events which bridge a daylight savings jump.</span>
<span id="cb62-989"><a href="#cb62-989" aria-hidden="true" tabindex="-1"></a>Let's look back at our example in Washington, DC, on the day that daylight saving time ended. On November 5th, 2017, at 2 AM the clocks jumped back an hour. That means there were two 1 AMs! We've represented this by "folding" over our timeline to show the repeat.</span>
<span id="cb62-990"><a href="#cb62-990" aria-hidden="true" tabindex="-1"></a>As before, in order to make sense of this situation, we need to map everything back to UTC. The first 1 AM maps to 5 AM UTC. This is the minus 4 hour UTC offset for Eastern Daylight Time we discussed in the previous lesson. At 1:59:59 local time, we're at 5:59:59 UTC. The next moment, our local clock jumps back, but since time has not actually gone backward, the clock continues to tick in UTC. We switch to a UTC offset of minus 5 hours (colored in blue), and the second 1 AM corresponds to 6 AM UTC.</span>
<span id="cb62-991"><a href="#cb62-991" aria-hidden="true" tabindex="-1"></a>First, let's make a <span class="in">`tzinfo`</span> object corresponding to our bike data's <span class="in">`timezone`</span>. We make a datetime for November 5th and 1 am. Let's check and see if this time is ambiguous, meaning we need to tell it apart somehow. We call <span class="in">`tz.datetime_ambiguous()`</span>, and see that, yes, this is a time which could occur at two different UTC moments in this <span class="in">`timezone`</span> Now we create a second datetime, with the same date and time. This time, we call <span class="in">`tz.enfold()`</span>, which takes the argument of the datetime we want to mark. enfold says, this datetime belongs to the *second* time the wall clock struck 1 AM this day, and not the first.</span>
<span id="cb62-992"><a href="#cb62-992" aria-hidden="true" tabindex="-1"></a>The thing is, enfold by itself doesn't change any of the behavior of a datetime. You can see here that Python doesn't take it into account when doing datetime arithmetic. Fold is just a placeholder, and it's up to further parts of the program to pay attention to fold and do something with it. What are we going to do?! We need to convert to UTC, which is unambiguous. When we really want to make sure that everything is accounted for, putting everything into UTC is the way to do it. Now when we ask Python to take the difference, we see that it correctly tells us these two timestamps are an hour apart. In general, whenever we really want to be sure of the duration between events that might cross a daylight saving boundary, we need to do our math in UTC.</span>
<span id="cb62-993"><a href="#cb62-993" aria-hidden="true" tabindex="-1"></a>We've covered how to handle springing forward and falling back, both with hand-coded UTC offsets and with <span class="in">`dateutil`</span>. Python often tries to be helpful by glossing over daylight saving time difference, and oftentimes that's what you want. However, when you do care about it, use <span class="in">`dateutil`</span> to set the <span class="in">`timezone`</span> information correctly and then switch into UTC for the most accurate comparisons between events.</span>
<span id="cb62-994"><a href="#cb62-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-995"><a href="#cb62-995" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 3.4.1</span></span>
<span id="cb62-996"><a href="#cb62-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-997"><a href="#cb62-997" aria-hidden="true" tabindex="-1"></a><span class="fu">### Finding ambiguous datetimes</span></span>
<span id="cb62-998"><a href="#cb62-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-999"><a href="#cb62-999" aria-hidden="true" tabindex="-1"></a>At the end of lesson 2(@sec-CHAPTER2), we saw something anomalous in our bike trip duration data. Let's see if we can identify what the problem might be.</span>
<span id="cb62-1000"><a href="#cb62-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1001"><a href="#cb62-1001" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-1002"><a href="#cb62-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1003"><a href="#cb62-1003" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Loop over the trips in <span class="in">`onebike_datetimes`</span>:</span>
<span id="cb62-1004"><a href="#cb62-1004" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>Print any rides whose start is ambiguous.</span>
<span id="cb62-1005"><a href="#cb62-1005" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>Print any rides whose end is ambiguous.</span>
<span id="cb62-1006"><a href="#cb62-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1009"><a href="#cb62-1009" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-1010"><a href="#cb62-1010" aria-hidden="true" tabindex="-1"></a><span class="co"># To add a tzinfo (timezone information) field to a list of dictionaries with two key values in Python, you can follow these steps:</span></span>
<span id="cb62-1011"><a href="#cb62-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1012"><a href="#cb62-1012" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.Import the required library</span></span>
<span id="cb62-1013"><a href="#cb62-1013" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pytz</span>
<span id="cb62-1014"><a href="#cb62-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1015"><a href="#cb62-1015" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.Timezone object for America/New_York</span></span>
<span id="cb62-1016"><a href="#cb62-1016" aria-hidden="true" tabindex="-1"></a>ny_tz <span class="op">=</span> pytz.timezone(<span class="st">'America/New_York'</span>)</span>
<span id="cb62-1017"><a href="#cb62-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1018"><a href="#cb62-1018" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.Iterate over each dictionary and add tzinfo to 'start' and 'end' keys</span></span>
<span id="cb62-1019"><a href="#cb62-1019" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trip <span class="kw">in</span> onebike_datetimes:</span>
<span id="cb62-1020"><a href="#cb62-1020" aria-hidden="true" tabindex="-1"></a>    trip[<span class="st">'start'</span>] <span class="op">=</span> trip[<span class="st">'start'</span>].replace(tzinfo<span class="op">=</span><span class="va">None</span>)  <span class="co"># Remove existing timezone info</span></span>
<span id="cb62-1021"><a href="#cb62-1021" aria-hidden="true" tabindex="-1"></a>    trip[<span class="st">'end'</span>] <span class="op">=</span> trip[<span class="st">'end'</span>].replace(tzinfo<span class="op">=</span><span class="va">None</span>)      <span class="co"># Remove existing timezone info</span></span>
<span id="cb62-1022"><a href="#cb62-1022" aria-hidden="true" tabindex="-1"></a>    trip[<span class="st">'start'</span>] <span class="op">=</span> ny_tz.localize(trip[<span class="st">'start'</span>])  <span class="co"># Add timezone info to 'start'</span></span>
<span id="cb62-1023"><a href="#cb62-1023" aria-hidden="true" tabindex="-1"></a>    trip[<span class="st">'end'</span>] <span class="op">=</span> ny_tz.localize(trip[<span class="st">'end'</span>])      <span class="co"># Add timezone info to 'end'</span></span>
<span id="cb62-1024"><a href="#cb62-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1025"><a href="#cb62-1025" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over trips</span></span>
<span id="cb62-1026"><a href="#cb62-1026" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trip <span class="kw">in</span> onebike_datetimes:</span>
<span id="cb62-1027"><a href="#cb62-1027" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rides with ambiguous start</span></span>
<span id="cb62-1028"><a href="#cb62-1028" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> tz.datetime_ambiguous(trip[<span class="st">'start'</span>]):</span>
<span id="cb62-1029"><a href="#cb62-1029" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Ambiguous start at "</span> <span class="op">+</span> <span class="bu">str</span>(trip[<span class="st">'start'</span>]))</span>
<span id="cb62-1030"><a href="#cb62-1030" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rides with ambiguous end</span></span>
<span id="cb62-1031"><a href="#cb62-1031" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> tz.datetime_ambiguous(trip[<span class="st">'end'</span>]):</span>
<span id="cb62-1032"><a href="#cb62-1032" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Ambiguous end at "</span> <span class="op">+</span> <span class="bu">str</span>(trip[<span class="st">'end'</span>]))</span>
<span id="cb62-1033"><a href="#cb62-1033" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1034"><a href="#cb62-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1035"><a href="#cb62-1035" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 3.4.2</span></span>
<span id="cb62-1036"><a href="#cb62-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1037"><a href="#cb62-1037" aria-hidden="true" tabindex="-1"></a><span class="fu">### Cleaning daylight saving data with fold</span></span>
<span id="cb62-1038"><a href="#cb62-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1039"><a href="#cb62-1039" aria-hidden="true" tabindex="-1"></a>As we've just discovered, there is a ride in our data set which is being messed up by a Daylight Savings shift. Let's clean up the data set so we actually have a correct minimum ride length. We can use the fact that we know the end of the ride happened after the beginning to fix up the duration messed up by the shift out of Daylight Savings.</span>
<span id="cb62-1040"><a href="#cb62-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1041"><a href="#cb62-1041" aria-hidden="true" tabindex="-1"></a>Since Python does not handle <span class="in">`tz.enfold()`</span> when doing arithmetic, we must put our datetime objects into UTC, where ambiguities have been resolved.</span>
<span id="cb62-1042"><a href="#cb62-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1043"><a href="#cb62-1043" aria-hidden="true" tabindex="-1"></a><span class="in">`onebike_datetimes`</span> is already loaded and in the right timezone. <span class="in">`tz`</span> and <span class="in">`timezone`</span> have been imported. Use <span class="in">`tz.UTC`</span> for the timezone.</span>
<span id="cb62-1044"><a href="#cb62-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1045"><a href="#cb62-1045" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-1046"><a href="#cb62-1046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1047"><a href="#cb62-1047" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Complete the <span class="in">`if`</span> statement to be true only when a ride's <span class="in">`start`</span> comes after its <span class="in">`end`</span>.</span>
<span id="cb62-1048"><a href="#cb62-1048" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When <span class="in">`start`</span> is after <span class="in">`end`</span>, call <span class="in">`tz.enfold()`</span> on the <span class="in">`end`</span> so you know it refers to the one after the daylight savings time change.</span>
<span id="cb62-1049"><a href="#cb62-1049" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>After the <span class="in">`if`</span> statement, convert the start and end to UTC so you can make a proper comparison.</span>
<span id="cb62-1050"><a href="#cb62-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1053"><a href="#cb62-1053" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-1054"><a href="#cb62-1054" aria-hidden="true" tabindex="-1"></a>trip_durations <span class="op">=</span> []</span>
<span id="cb62-1055"><a href="#cb62-1055" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> trip <span class="kw">in</span> onebike_datetimes:</span>
<span id="cb62-1056"><a href="#cb62-1056" aria-hidden="true" tabindex="-1"></a>  <span class="co"># When the start is later than the end, set the fold to be 1</span></span>
<span id="cb62-1057"><a href="#cb62-1057" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> trip[<span class="st">'start'</span>] <span class="op">&gt;</span> trip[<span class="st">'end'</span>]:</span>
<span id="cb62-1058"><a href="#cb62-1058" aria-hidden="true" tabindex="-1"></a>    trip[<span class="st">'end'</span>] <span class="op">=</span> tz.enfold(trip[<span class="st">'end'</span>])</span>
<span id="cb62-1059"><a href="#cb62-1059" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to UTC</span></span>
<span id="cb62-1060"><a href="#cb62-1060" aria-hidden="true" tabindex="-1"></a>  start <span class="op">=</span> trip[<span class="st">'start'</span>].astimezone(tz.UTC)</span>
<span id="cb62-1061"><a href="#cb62-1061" aria-hidden="true" tabindex="-1"></a>  end <span class="op">=</span> trip[<span class="st">'end'</span>].astimezone(tz.UTC)</span>
<span id="cb62-1062"><a href="#cb62-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1063"><a href="#cb62-1063" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Subtract the difference</span></span>
<span id="cb62-1064"><a href="#cb62-1064" aria-hidden="true" tabindex="-1"></a>  trip_length_seconds <span class="op">=</span> (end<span class="op">-</span>start).total_seconds()</span>
<span id="cb62-1065"><a href="#cb62-1065" aria-hidden="true" tabindex="-1"></a>  trip_durations.append(trip_length_seconds)</span>
<span id="cb62-1066"><a href="#cb62-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1067"><a href="#cb62-1067" aria-hidden="true" tabindex="-1"></a><span class="co"># Take the shortest trip duration</span></span>
<span id="cb62-1068"><a href="#cb62-1068" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Shortest trip: "</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">min</span>(trip_durations)))</span>
<span id="cb62-1069"><a href="#cb62-1069" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1070"><a href="#cb62-1070" aria-hidden="true" tabindex="-1"></a>**To give a sense for how tricky these things are: we actually still don't know how long the rides are which only started or ended in our ambiguous hour but not both. If you're collecting data, store it in UTC or with a fixed UTC offset!**</span>
<span id="cb62-1071"><a href="#cb62-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1072"><a href="#cb62-1072" aria-hidden="true" tabindex="-1"></a><span class="fu"># CHAPTER 4: EASY AND POWERFUL: DATES AND TIMES IN PANDAS</span></span>
<span id="cb62-1073"><a href="#cb62-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1074"><a href="#cb62-1074" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter 4.1: Reading date and time data in Pandas</span></span>
<span id="cb62-1075"><a href="#cb62-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1076"><a href="#cb62-1076" aria-hidden="true" tabindex="-1"></a>In this chapter, you will use the Pandas library to work with dates and times. You should have encountered Pandas before, but now we will add datetimes to the mix.</span>
<span id="cb62-1077"><a href="#cb62-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1078"><a href="#cb62-1078" aria-hidden="true" tabindex="-1"></a><span class="fu">### A simple Pandas example</span></span>
<span id="cb62-1079"><a href="#cb62-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1080"><a href="#cb62-1080" aria-hidden="true" tabindex="-1"></a>To start with, let's load data with Pandas. First, we import pandas, and as is customary we use the alias pd. Our data is in a csv file, so we load it with the <span class="in">`read_csv()`</span> function. <span class="in">`pd.read_csv()`</span> has one required argument, the name of the file to load, which in this case is capital-onebike-dot-csv. We save the result to the variable rides. Let's print the first three rows to see what we've got.</span>
<span id="cb62-1081"><a href="#cb62-1081" aria-hidden="true" tabindex="-1"></a>Note that the index, listed all the way to the left, starts with zero. Because the table is too wide, it wraps around. Each of these three rows has a start date, an end date, a start station, and end station, the bike number, and whether the ride was from someone who is a member or someone who walked up to the kiosk and bought a ride on the spot.</span>
<span id="cb62-1082"><a href="#cb62-1082" aria-hidden="true" tabindex="-1"></a>We can also select a particular column by using the brackets, as here where we call <span class="in">`rides['Start date']`</span>. And we can get a particular row with <span class="in">`.iloc[]`</span>, in this case row number 2. Because we didn't tell Pandas to treat the start date and end date columns as <span class="in">`datetimes`</span>, they are simply strings or objects. We want them to be <span class="in">`datetimes`</span> so we can work with them effectively, using the tools from the first three chapters of this course.</span>
<span id="cb62-1083"><a href="#cb62-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1084"><a href="#cb62-1084" aria-hidden="true" tabindex="-1"></a><span class="fu">### Loading datetimes with parse_dates</span></span>
<span id="cb62-1085"><a href="#cb62-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1086"><a href="#cb62-1086" aria-hidden="true" tabindex="-1"></a>If we want Pandas to treat these columns as <span class="in">`datetimes`</span>, we can make use of the argument <span class="in">`parse_dates`</span> in <span class="in">`read_csv()`</span>, and set it to be a list of column names, passed as strings. Now Pandas will read these columns and convert them for us to datetimes. Pandas will try and be intelligent and figure out the format of your datetime strings. In the rare case that this doesn't work, you can use the <span class="in">`to_datetime()`</span> method that lets you specify the format manually. For more details, see the Pandas documentation.</span>
<span id="cb62-1087"><a href="#cb62-1087" aria-hidden="true" tabindex="-1"></a>Now when we again ask for the Start date for row 2, we get back a Pandas Timestamp, which for essentially all purposes you can imagine is a Python Datetime object with a different name. They behave basically exactly the same.</span>
<span id="cb62-1088"><a href="#cb62-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1089"><a href="#cb62-1089" aria-hidden="true" tabindex="-1"></a><span class="fu">### Timezone-aware arithmetic</span></span>
<span id="cb62-1090"><a href="#cb62-1090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1091"><a href="#cb62-1091" aria-hidden="true" tabindex="-1"></a>Since our Start date and End date columns are now datetimes, we can deal with them the way we usually deal with datetimes. For example, we can create a new column, Duration, by subtracting Start date from End date. Because each of these columns are datetimes, when we subtract them we get <span class="in">`timedeltas`</span>. If we print out the first 5 rows, we get that the first ride lasted for only 3 minutes and 1 second, the second ride lasted for 2 hours and 7 minutes, the third ride lasted for 5 minutes 43 seconds, and so on.</span>
<span id="cb62-1092"><a href="#cb62-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1093"><a href="#cb62-1093" aria-hidden="true" tabindex="-1"></a><span class="fu">### Loading datetimes with parse_dates</span></span>
<span id="cb62-1094"><a href="#cb62-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1095"><a href="#cb62-1095" aria-hidden="true" tabindex="-1"></a>Pandas has two features worth noting here. Let's see an example of converting our Duration to seconds, and looking at the first 5 rows. First, Pandas code is often written in a "method chaining" style, where we call a method, and then another, and then another. For readability, it's common to break them up with a backslash and a linebreak at the end of each. Second, you can access all of the typical <span class="in">`datetime`</span> methods within the namespace <span class="in">`.dt`</span>. For example, we can convert our <span class="in">`timedeltas`</span> into numbers with <span class="in">`.dt.total_seconds()`</span>. Now when we look at the results, we see that we've got seconds instead of <span class="in">`timedeltas`</span>. Our first ride lasted 181 seconds, our second ride 7622 seconds, and so on.</span>
<span id="cb62-1096"><a href="#cb62-1096" aria-hidden="true" tabindex="-1"></a>Reading date and time data in Pandas</span>
<span id="cb62-1097"><a href="#cb62-1097" aria-hidden="true" tabindex="-1"></a>In this lesson, we discussed loading data in Pandas, and handling basic datetime elements. We talked about using slashes to continue lines, and selecting subsets of rows. Time to practice!</span>
<span id="cb62-1098"><a href="#cb62-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1099"><a href="#cb62-1099" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 4.1.1</span></span>
<span id="cb62-1100"><a href="#cb62-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1101"><a href="#cb62-1101" aria-hidden="true" tabindex="-1"></a><span class="fu">### Loading a csv file in Pandas</span></span>
<span id="cb62-1102"><a href="#cb62-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1103"><a href="#cb62-1103" aria-hidden="true" tabindex="-1"></a>The <span class="in">`capital_onebike.csv`</span> file covers the October, November and December rides of the Capital Bikeshare bike W20529.</span>
<span id="cb62-1104"><a href="#cb62-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1105"><a href="#cb62-1105" aria-hidden="true" tabindex="-1"></a>Here are the first two columns:</span>
<span id="cb62-1106"><a href="#cb62-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1107"><a href="#cb62-1107" aria-hidden="true" tabindex="-1"></a>|Start date            |End date             |....|</span>
<span id="cb62-1108"><a href="#cb62-1108" aria-hidden="true" tabindex="-1"></a>|----------------------|---------------------|----|</span>
<span id="cb62-1109"><a href="#cb62-1109" aria-hidden="true" tabindex="-1"></a>|2017-10-01 15:23:25   |2017-10-01 15:26:26  |....|</span>
<span id="cb62-1110"><a href="#cb62-1110" aria-hidden="true" tabindex="-1"></a>|2017-10-01 15:42:57   |2017-10-01 17:49:59  |....|</span>
<span id="cb62-1111"><a href="#cb62-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1112"><a href="#cb62-1112" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-1113"><a href="#cb62-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1114"><a href="#cb62-1114" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Import Pandas.</span>
<span id="cb62-1115"><a href="#cb62-1115" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Complete the call to <span class="in">`read_csv()`</span> so that it correctly parses the date columns <span class="in">`Start date`</span> and <span class="in">`End date`</span>.</span>
<span id="cb62-1116"><a href="#cb62-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1119"><a href="#cb62-1119" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-1120"><a href="#cb62-1120" aria-hidden="true" tabindex="-1"></a><span class="co"># Import pandas</span></span>
<span id="cb62-1121"><a href="#cb62-1121" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb62-1122"><a href="#cb62-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1123"><a href="#cb62-1123" aria-hidden="true" tabindex="-1"></a><span class="co"># Load CSV into the rides variable</span></span>
<span id="cb62-1124"><a href="#cb62-1124" aria-hidden="true" tabindex="-1"></a>rides <span class="op">=</span> pd.read_csv(<span class="st">'datasets/capital-onebike.csv'</span>, </span>
<span id="cb62-1125"><a href="#cb62-1125" aria-hidden="true" tabindex="-1"></a>                    parse_dates <span class="op">=</span> [<span class="st">'Start date'</span>, <span class="st">'End date'</span>])</span>
<span id="cb62-1126"><a href="#cb62-1126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1127"><a href="#cb62-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1128"><a href="#cb62-1128" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 4.1.2</span></span>
<span id="cb62-1129"><a href="#cb62-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1130"><a href="#cb62-1130" aria-hidden="true" tabindex="-1"></a><span class="fu">### Making timedelta columns</span></span>
<span id="cb62-1131"><a href="#cb62-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1132"><a href="#cb62-1132" aria-hidden="true" tabindex="-1"></a>Earlier in this course, you wrote a loop to subtract <span class="in">`datetime`</span> objects and determine how long our sample bike had been out of the docks. Now you'll do the same thing with Pandas.</span>
<span id="cb62-1133"><a href="#cb62-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1134"><a href="#cb62-1134" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-1135"><a href="#cb62-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1136"><a href="#cb62-1136" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Subtract the <span class="in">`Start date`</span> column from the <span class="in">`End date`</span> column to get a Series of timedeltas; assign the result to <span class="in">`ride_durations`</span>.</span>
<span id="cb62-1137"><a href="#cb62-1137" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Convert <span class="in">`ride_durations`</span> into seconds and assign the result to the <span class="in">`'Duration'`</span> column of <span class="in">`rides`</span>.</span>
<span id="cb62-1138"><a href="#cb62-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1141"><a href="#cb62-1141" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-1142"><a href="#cb62-1142" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the initial (0th) row</span></span>
<span id="cb62-1143"><a href="#cb62-1143" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rides.iloc[<span class="dv">0</span>])</span>
<span id="cb62-1144"><a href="#cb62-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1145"><a href="#cb62-1145" aria-hidden="true" tabindex="-1"></a><span class="co"># Subtract the start date from the end date</span></span>
<span id="cb62-1146"><a href="#cb62-1146" aria-hidden="true" tabindex="-1"></a>ride_durations <span class="op">=</span> rides[<span class="st">'End date'</span>] <span class="op">-</span> rides[<span class="st">'Start date'</span>]</span>
<span id="cb62-1147"><a href="#cb62-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1148"><a href="#cb62-1148" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the results to seconds</span></span>
<span id="cb62-1149"><a href="#cb62-1149" aria-hidden="true" tabindex="-1"></a>rides[<span class="st">'Duration'</span>] <span class="op">=</span> ride_durations.dt.total_seconds()</span>
<span id="cb62-1150"><a href="#cb62-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1151"><a href="#cb62-1151" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rides[<span class="st">'Duration'</span>].head())</span>
<span id="cb62-1152"><a href="#cb62-1152" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1153"><a href="#cb62-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1154"><a href="#cb62-1154" aria-hidden="true" tabindex="-1"></a><span class="fu">## CHAPTER 4.2: Summarizing datetime data in Pandas</span></span>
<span id="cb62-1155"><a href="#cb62-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1156"><a href="#cb62-1156" aria-hidden="true" tabindex="-1"></a>In this lesson, we will discuss how to summarize Pandas tables, especially when we have datetime columns. One note: Pandas continues to evolve quickly. Many of the techniques in this chapter don't work on versions of Pandas more than a few years old. If anything breaks on your personal computer, make sure you're using at least Pandas version 0.23.</span>
<span id="cb62-1157"><a href="#cb62-1157" aria-hidden="true" tabindex="-1"></a>Summarizing data in Pandas</span>
<span id="cb62-1158"><a href="#cb62-1158" aria-hidden="true" tabindex="-1"></a>First things first, let's review some general principles for summarizing data in Pandas. You can call <span class="in">`.mean()`</span>, <span class="in">`.median()`</span>, <span class="in">`.sum()`</span> and so on, on any column where it makes sense. For example, <span class="in">`rides['Duration'].mean()`</span> returns that the average time the bike was out of the dock was 19 minutes and 38 seconds. We also can ask: how much is this column in total? By using the <span class="in">`.sum()`</span> method, we can see that the bike was out of the dock for a total of 3 days, 22 hours, 58 minutes and 10 seconds during this time period.</span>
<span id="cb62-1159"><a href="#cb62-1159" aria-hidden="true" tabindex="-1"></a>The output of Pandas operations mix perfectly well with the rest of Python. For example, if we divide this sum by 91 days (the number of days from October 1 to December 31), we see that the bike was out about 4.3% of the time, meaning about 96% of the time the bike was in the dock.</span>
<span id="cb62-1160"><a href="#cb62-1160" aria-hidden="true" tabindex="-1"></a>For non-numeric columns, we have other ways of making summaries. The <span class="in">`.value_counts()`</span> method tells us how many times a given value appears. In this case, we want to know how often the Member type is Member or Casual. 236 rides were from Members, and 54 were from Casual riders, who bought a ride at the bike kiosk without a membership. We can also divide by the total number of rides, using <span class="in">`len(rides)`</span>, and Pandas handles the division for us across our result. 81.4% of rides were from members, whereas 18.6% of rides were from casual riders.</span>
<span id="cb62-1161"><a href="#cb62-1161" aria-hidden="true" tabindex="-1"></a>To make this next section easy, let's make a column called 'Duration seconds', which will be the original column 'Duration' converted to seconds. Pandas has powerful ways to group rows together. First, we can group by values in any column, using the <span class="in">`.groupby()`</span> method. <span class="in">`.groupby()`</span> takes a column name and does all subsequent operations on each group. For example, we can groupby Member type, and ask for the mean duration in seconds for each member type. Rides from casual members last nearly twice as long on average.</span>
<span id="cb62-1162"><a href="#cb62-1162" aria-hidden="true" tabindex="-1"></a>Second, we can also group by time, using the <span class="in">`.resample()`</span> method. <span class="in">`.resample()`</span> takes a unit of time (for example, 'M' for month), and a datetime column to group on, in this case 'Start date'. From this we can see that, in the month ending on October 31st, average rides were 1886 seconds, or about 30 minutes, whereas for the month ending December 31, average rides were 635 seconds, or closer to ten minutes.</span>
<span id="cb62-1163"><a href="#cb62-1163" aria-hidden="true" tabindex="-1"></a>There are also others methods which operate on groups. For example, we can call <span class="in">`.size()`</span> to get the size of each group. Or we can call <span class="in">`.first()`</span> to get the first row of each group.</span>
<span id="cb62-1164"><a href="#cb62-1164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1165"><a href="#cb62-1165" aria-hidden="true" tabindex="-1"></a>Pandas also makes it easy to plot results. Just add the <span class="in">`.plot()`</span> method at the end of your call and it will pass the results to the Python plotting library Matplotlib. It will usually have sensible defaults, though if you want to change things further you can.</span>
<span id="cb62-1166"><a href="#cb62-1166" aria-hidden="true" tabindex="-1"></a>We can also change the resampling rate from 'M' for months to 'D' for days, and plot again. Now we can see that there is at least one big outlier skewing our data: some ride in the middle of October was 25000 seconds long, or nearly 7 hours. We identified this ride in an earlier chapter as possibly a bike repair. Now we can see that it happened after many days with zero rides, which lends strength to that idea. If the bike was broken and sitting in the dock for awhile, eventually it would have been removed for repairs, then returned.</span>
<span id="cb62-1167"><a href="#cb62-1167" aria-hidden="true" tabindex="-1"></a>In this lesson, we discussed how to use basic Pandas operations, such as <span class="in">`.mean()`</span>, <span class="in">`.median()`</span> and <span class="in">`.sum()`</span>, and also <span class="in">`.groupby()`</span> and <span class="in">`.resample()`</span> to combine our rows into different groups. Time to practice what you've learned!</span>
<span id="cb62-1168"><a href="#cb62-1168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1169"><a href="#cb62-1169" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 4.2.1</span></span>
<span id="cb62-1170"><a href="#cb62-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1171"><a href="#cb62-1171" aria-hidden="true" tabindex="-1"></a><span class="fu">### How many joyrides?</span></span>
<span id="cb62-1172"><a href="#cb62-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1173"><a href="#cb62-1173" aria-hidden="true" tabindex="-1"></a>Suppose you have a theory that some people take long bike rides before putting their bike back in the same dock. Let's call these rides "joyrides".</span>
<span id="cb62-1174"><a href="#cb62-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1175"><a href="#cb62-1175" aria-hidden="true" tabindex="-1"></a>You only have data on one bike, so while you can't draw any bigger conclusions, it's certainly worth a look.</span>
<span id="cb62-1176"><a href="#cb62-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1177"><a href="#cb62-1177" aria-hidden="true" tabindex="-1"></a>Are there many joyrides? How long were they in our data set? Use the median instead of the mean, because we know there are some very long trips in our data set that might skew the answer, and the median is less sensitive to outliers.</span>
<span id="cb62-1178"><a href="#cb62-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1179"><a href="#cb62-1179" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-1180"><a href="#cb62-1180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1181"><a href="#cb62-1181" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Create a Pandas Series which is <span class="in">`True`</span> when <span class="in">`Start station`</span> and <span class="in">`End station`</span> are the same, and assign the result to <span class="in">`joyrides`</span>.</span>
<span id="cb62-1182"><a href="#cb62-1182" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Calculate the median duration of all rides.</span>
<span id="cb62-1183"><a href="#cb62-1183" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Calculate the median duration of <span class="in">`joyrides`</span>.</span>
<span id="cb62-1184"><a href="#cb62-1184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1187"><a href="#cb62-1187" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-1188"><a href="#cb62-1188" aria-hidden="true" tabindex="-1"></a><span class="co"># Create joyrides</span></span>
<span id="cb62-1189"><a href="#cb62-1189" aria-hidden="true" tabindex="-1"></a>joyrides <span class="op">=</span> (rides[<span class="st">'Start station'</span>] <span class="op">==</span> rides[<span class="st">'End station'</span>])</span>
<span id="cb62-1190"><a href="#cb62-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1191"><a href="#cb62-1191" aria-hidden="true" tabindex="-1"></a><span class="co"># Total number of joyrides</span></span>
<span id="cb62-1192"><a href="#cb62-1192" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="sc">{}</span><span class="st"> rides were joyrides"</span>.<span class="bu">format</span>(joyrides.<span class="bu">sum</span>()))</span>
<span id="cb62-1193"><a href="#cb62-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1194"><a href="#cb62-1194" aria-hidden="true" tabindex="-1"></a><span class="co"># Median of all rides</span></span>
<span id="cb62-1195"><a href="#cb62-1195" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The median duration overall was </span><span class="sc">{:.2f}</span><span class="st"> seconds"</span>\</span>
<span id="cb62-1196"><a href="#cb62-1196" aria-hidden="true" tabindex="-1"></a>      .<span class="bu">format</span>(rides[<span class="st">'Duration'</span>].median()))</span>
<span id="cb62-1197"><a href="#cb62-1197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1198"><a href="#cb62-1198" aria-hidden="true" tabindex="-1"></a><span class="co"># Median of joyrides</span></span>
<span id="cb62-1199"><a href="#cb62-1199" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The median duration for joyrides was </span><span class="sc">{:.2f}</span><span class="st"> seconds"</span>\</span>
<span id="cb62-1200"><a href="#cb62-1200" aria-hidden="true" tabindex="-1"></a>      .<span class="bu">format</span>(rides[joyrides][<span class="st">'Duration'</span>].median()))</span>
<span id="cb62-1201"><a href="#cb62-1201" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1202"><a href="#cb62-1202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1203"><a href="#cb62-1203" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 4.2.2</span></span>
<span id="cb62-1204"><a href="#cb62-1204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1205"><a href="#cb62-1205" aria-hidden="true" tabindex="-1"></a>It's getting cold outside, W20529</span>
<span id="cb62-1206"><a href="#cb62-1206" aria-hidden="true" tabindex="-1"></a>Washington, D.C. has mild weather overall, but the average high temperature in October (68ºF / 20ºC) is certainly higher than the average high temperature in December (47ºF / 8ºC). People also travel more in December, and they work fewer days so they commute less.</span>
<span id="cb62-1207"><a href="#cb62-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1208"><a href="#cb62-1208" aria-hidden="true" tabindex="-1"></a>How might the weather or the season have affected the length of bike trips?</span>
<span id="cb62-1209"><a href="#cb62-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1210"><a href="#cb62-1210" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions </span></span>
<span id="cb62-1211"><a href="#cb62-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1212"><a href="#cb62-1212" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Resample <span class="in">`rides`</span> to the daily level, based on the <span class="in">`Start date`</span> column.</span>
<span id="cb62-1213"><a href="#cb62-1213" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>Plot the <span class="in">`.size()`</span> of each result.</span>
<span id="cb62-1214"><a href="#cb62-1214" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Since the daily time series is so noisy for this one bike, change the resampling to be monthly.</span>
<span id="cb62-1215"><a href="#cb62-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1218"><a href="#cb62-1218" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-1219"><a href="#cb62-1219" aria-hidden="true" tabindex="-1"></a><span class="co"># Import matplotlib</span></span>
<span id="cb62-1220"><a href="#cb62-1220" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb62-1221"><a href="#cb62-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1222"><a href="#cb62-1222" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample rides to daily, take the size, plot the results</span></span>
<span id="cb62-1223"><a href="#cb62-1223" aria-hidden="true" tabindex="-1"></a>rides.resample(<span class="st">'D'</span>, on <span class="op">=</span> <span class="st">'Start date'</span>)<span class="op">\</span></span>
<span id="cb62-1224"><a href="#cb62-1224" aria-hidden="true" tabindex="-1"></a>  .size()<span class="op">\</span></span>
<span id="cb62-1225"><a href="#cb62-1225" aria-hidden="true" tabindex="-1"></a>  .plot(ylim <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">15</span>])</span>
<span id="cb62-1226"><a href="#cb62-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1227"><a href="#cb62-1227" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the results</span></span>
<span id="cb62-1228"><a href="#cb62-1228" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb62-1229"><a href="#cb62-1229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1230"><a href="#cb62-1230" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample rides to monthly, take the size, plot the results</span></span>
<span id="cb62-1231"><a href="#cb62-1231" aria-hidden="true" tabindex="-1"></a>rides.resample(<span class="st">'M'</span>, on <span class="op">=</span> <span class="st">'Start date'</span>)<span class="op">\</span></span>
<span id="cb62-1232"><a href="#cb62-1232" aria-hidden="true" tabindex="-1"></a>  .size()<span class="op">\</span></span>
<span id="cb62-1233"><a href="#cb62-1233" aria-hidden="true" tabindex="-1"></a>  .plot(ylim <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">150</span>])</span>
<span id="cb62-1234"><a href="#cb62-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1235"><a href="#cb62-1235" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the results</span></span>
<span id="cb62-1236"><a href="#cb62-1236" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb62-1237"><a href="#cb62-1237" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1238"><a href="#cb62-1238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1239"><a href="#cb62-1239" aria-hidden="true" tabindex="-1"></a>**The pattern is clearer at the monthly level: there were fewer rides in November, and then fewer still in December, possibly because the temperature got colder.**</span>
<span id="cb62-1240"><a href="#cb62-1240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1241"><a href="#cb62-1241" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 4.2.3</span></span>
<span id="cb62-1242"><a href="#cb62-1242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1243"><a href="#cb62-1243" aria-hidden="true" tabindex="-1"></a><span class="fu">### Members vs casual riders over time</span></span>
<span id="cb62-1244"><a href="#cb62-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1245"><a href="#cb62-1245" aria-hidden="true" tabindex="-1"></a>Riders can either be <span class="in">`"Members"`</span>, meaning they pay yearly for the ability to take a bike at any time, or <span class="in">`"Casual"`</span>, meaning they pay at the kiosk attached to the bike dock.</span>
<span id="cb62-1246"><a href="#cb62-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1247"><a href="#cb62-1247" aria-hidden="true" tabindex="-1"></a>Do members and casual riders drop off at the same rate over October to December, or does one drop off faster than the other?</span>
<span id="cb62-1248"><a href="#cb62-1248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1249"><a href="#cb62-1249" aria-hidden="true" tabindex="-1"></a>As before, <span class="in">`rides`</span> has been loaded for you. You're going to use the Pandas method <span class="in">`.value_counts()`</span>, which returns the number of instances of each value in a Series. In this case, the counts of <span class="in">`"Member"`</span> or <span class="in">`"Casual`</span>.</span>
<span id="cb62-1250"><a href="#cb62-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1251"><a href="#cb62-1251" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-1252"><a href="#cb62-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1253"><a href="#cb62-1253" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Set <span class="in">`monthly_rides`</span> to be a resampled version of <span class="in">`rides`</span>, by month, based on start date.</span>
<span id="cb62-1254"><a href="#cb62-1254" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use the method <span class="in">`.value_counts()`</span> to find out how many Member and Casual rides there were, and divide them by the total number of rides per month.</span>
<span id="cb62-1255"><a href="#cb62-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1258"><a href="#cb62-1258" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-1259"><a href="#cb62-1259" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample rides to be monthly on the basis of Start date</span></span>
<span id="cb62-1260"><a href="#cb62-1260" aria-hidden="true" tabindex="-1"></a>monthly_rides <span class="op">=</span> rides.resample(<span class="st">'M'</span>, on <span class="op">=</span> (<span class="st">'Start date'</span>))[<span class="st">'Member type'</span>]</span>
<span id="cb62-1261"><a href="#cb62-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1262"><a href="#cb62-1262" aria-hidden="true" tabindex="-1"></a><span class="co"># Take the ratio of the .value_counts() over the total number of rides</span></span>
<span id="cb62-1263"><a href="#cb62-1263" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(monthly_rides.value_counts() <span class="op">/</span> monthly_rides.size())</span>
<span id="cb62-1264"><a href="#cb62-1264" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1265"><a href="#cb62-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1266"><a href="#cb62-1266" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 4.2.4</span></span>
<span id="cb62-1267"><a href="#cb62-1267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1268"><a href="#cb62-1268" aria-hidden="true" tabindex="-1"></a><span class="fu">### Combining groupby() and resample()</span></span>
<span id="cb62-1269"><a href="#cb62-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1270"><a href="#cb62-1270" aria-hidden="true" tabindex="-1"></a>A very powerful method in Pandas is <span class="in">`.groupby()`</span>. Whereas <span class="in">`.resample()`</span> groups rows by some time or date information, <span class="in">`.groupby()`</span> groups rows based on the values in one or more columns. For example, <span class="in">`rides.groupby('Member type').size()`</span> would tell us how many rides there were by member type in our entire DataFrame.</span>
<span id="cb62-1271"><a href="#cb62-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1272"><a href="#cb62-1272" aria-hidden="true" tabindex="-1"></a><span class="in">`.resample()`</span> can be called after <span class="in">`.groupby()`</span>. For example, how long was the median ride by month, and by Membership type?</span>
<span id="cb62-1273"><a href="#cb62-1273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1274"><a href="#cb62-1274" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-1275"><a href="#cb62-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1276"><a href="#cb62-1276" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Complete the <span class="in">`.groupby()`</span> call to group by <span class="in">`'Member type'`</span>, and the <span class="in">`.resample()`</span> call to resample according to <span class="in">`'Start date'`</span>, by month.</span>
<span id="cb62-1277"><a href="#cb62-1277" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Print the median <span class="in">`Duration`</span> for each group.</span>
<span id="cb62-1278"><a href="#cb62-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1281"><a href="#cb62-1281" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-1282"><a href="#cb62-1282" aria-hidden="true" tabindex="-1"></a><span class="co"># Group rides by member type, and resample to the month</span></span>
<span id="cb62-1283"><a href="#cb62-1283" aria-hidden="true" tabindex="-1"></a>grouped <span class="op">=</span> rides.groupby(<span class="st">'Member type'</span>)<span class="op">\</span></span>
<span id="cb62-1284"><a href="#cb62-1284" aria-hidden="true" tabindex="-1"></a>  .resample(<span class="st">'M'</span>, on <span class="op">=</span> (<span class="st">'Start date'</span>))</span>
<span id="cb62-1285"><a href="#cb62-1285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1286"><a href="#cb62-1286" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the median duration for each group</span></span>
<span id="cb62-1287"><a href="#cb62-1287" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(grouped[<span class="st">'Duration'</span>].median())</span>
<span id="cb62-1288"><a href="#cb62-1288" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1289"><a href="#cb62-1289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1290"><a href="#cb62-1290" aria-hidden="true" tabindex="-1"></a><span class="fu">## CHAPTER 4.3: Additional datetime methods in Pandas</span></span>
<span id="cb62-1291"><a href="#cb62-1291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1292"><a href="#cb62-1292" aria-hidden="true" tabindex="-1"></a>In this final lesson, we will cover some additional Pandas methods for working with dates and times. By the end of this lesson, you will understand how to handle timezones in Pandas, as well as other common datetime operations.</span>
<span id="cb62-1293"><a href="#cb62-1293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1294"><a href="#cb62-1294" aria-hidden="true" tabindex="-1"></a><span class="fu">### Timezones in Pandas</span></span>
<span id="cb62-1295"><a href="#cb62-1295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1296"><a href="#cb62-1296" aria-hidden="true" tabindex="-1"></a>First, a reminder of the importance of timezones. If we ask Pandas to tell us the smallest ride duration in seconds, using the <span class="in">`dt.total_seconds()`</span> method and then the <span class="in">`.min()`</span> method, we get -3346 seconds, or -55 minutes. Yikes! Something is wrong, since our ride durations shouldn't ever be negative.</span>
<span id="cb62-1297"><a href="#cb62-1297" aria-hidden="true" tabindex="-1"></a>The answer, as it was when we looked at this data set in standard Python, is Daylight Saving. Just like with standard Python, these datetime objects start off as timezone-naive. They're not tied to any absolute time with a UTC offset. Let's see the first three Start dates so we can see how they're displayed and check that there is no UTC offset. To start, we want those same three datetimes to be put into a timezone. The method for this in Pandas is <span class="in">`dt.tz_localize()`</span>. Now when we look at the localized datetimes, we can see that they have a UTC offset.</span>
<span id="cb62-1298"><a href="#cb62-1298" aria-hidden="true" tabindex="-1"></a>However, if we try to convert our entire Start date column to the America/New_York timezone, Pandas will throw an AmbiguousTimeError. As expected, we have one datetime that occurs during the Daylight Saving shift. Following the advice of the error message, we can set the ambiguous argument in the <span class="in">`dt.tz_localize()`</span> method. By default, it raises an error, as we saw before. We also can pass the string 'NaT', which says that if the converter gets confused, it should set the bad result as Not a Time. Pandas is smart enough to skip over NaTs when it sees them, so our <span class="in">`.min()`</span> and other methods will just ignore this one row.</span>
<span id="cb62-1299"><a href="#cb62-1299" aria-hidden="true" tabindex="-1"></a>Now that we've fixed the timezones, we should recalculate our durations, in case any rides had been across Daylight Saving boundaries. This time, when we take Durations, convert it to seconds, and take the minimum, we get a much more sensible 116.0 seconds, or about two minutes.</span>
<span id="cb62-1300"><a href="#cb62-1300" aria-hidden="true" tabindex="-1"></a>Just to know what we're looking at, let's pull up our problematic row. Here, both the start and end time were ambiguous, so they've been set to NaT. As a result, our Duration, since it's the difference of two undefined times, is also NaT.</span>
<span id="cb62-1301"><a href="#cb62-1301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1302"><a href="#cb62-1302" aria-hidden="true" tabindex="-1"></a><span class="fu">### Other datetime operations in Pandas</span></span>
<span id="cb62-1303"><a href="#cb62-1303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1304"><a href="#cb62-1304" aria-hidden="true" tabindex="-1"></a>There are other datetime operations you should know about too. The simplest are ones you're already familiar with: .year, .month, and so on. In Pandas, these are accessed with dt-dot-year, dt-dot-month, etc. For example, here is the year of the first three rows. There are other useful things that Pandas gives you, some of which are not available in standard Python. For example, the method <span class="in">`dt.day_name()`</span> gives you the day of the week for each element in a datetime Series. You can even specify if you want weekday names in a language other than English. These results can be aggregated with <span class="in">`.groupby()`</span> call, to summarize data by year, month, day of the week, and so on.</span>
<span id="cb62-1305"><a href="#cb62-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1306"><a href="#cb62-1306" aria-hidden="true" tabindex="-1"></a><span class="fu">### Other parts of Pandas</span></span>
<span id="cb62-1307"><a href="#cb62-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1308"><a href="#cb62-1308" aria-hidden="true" tabindex="-1"></a>Pandas also lets you shift rows up or down with the <span class="in">`.shift()`</span> method. Here we've shifted the rides one row forward so that our zeroth row is now NaT, and our first row has the same value that our zeroth row had before. This is useful if you want to, for example, line up the end times of each row with the start time of the next one. Now you can answer questions about how each ride compares to the previous one! You'll cover this in an exercise shortly.</span>
<span id="cb62-1309"><a href="#cb62-1309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1310"><a href="#cb62-1310" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 4.3.1</span></span>
<span id="cb62-1311"><a href="#cb62-1311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1312"><a href="#cb62-1312" aria-hidden="true" tabindex="-1"></a><span class="fu">### Timezones in Pandas</span></span>
<span id="cb62-1313"><a href="#cb62-1313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1314"><a href="#cb62-1314" aria-hidden="true" tabindex="-1"></a>Earlier in this course, you assigned a timezone to each <span class="in">`datetime`</span> in a list. Now with Pandas you can do that with a single method call.</span>
<span id="cb62-1315"><a href="#cb62-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1316"><a href="#cb62-1316" aria-hidden="true" tabindex="-1"></a>(Note that, just as before, your data set actually includes some ambiguous datetimes on account of daylight saving; for now, we'll tell Pandas to not even try on those ones. Figuring them out would require more work.)</span>
<span id="cb62-1317"><a href="#cb62-1317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1318"><a href="#cb62-1318" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions </span></span>
<span id="cb62-1319"><a href="#cb62-1319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1320"><a href="#cb62-1320" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Make the <span class="in">`Start date`</span> column timezone aware by localizing it to <span class="in">`'America/New_York'`</span> while ignoring any ambiguous datetimes.</span>
<span id="cb62-1321"><a href="#cb62-1321" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Now switch the <span class="in">`Start date`</span> column to the timezone <span class="in">`'Europe/London'`</span> using the <span class="in">`.dt.tz_convert()`</span> method.</span>
<span id="cb62-1322"><a href="#cb62-1322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1325"><a href="#cb62-1325" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-1326"><a href="#cb62-1326" aria-hidden="true" tabindex="-1"></a><span class="co"># Localize the Start date column to America/New_York</span></span>
<span id="cb62-1327"><a href="#cb62-1327" aria-hidden="true" tabindex="-1"></a>rides[<span class="st">'Start date'</span>] <span class="op">=</span> rides[<span class="st">'Start date'</span>]<span class="op">\</span></span>
<span id="cb62-1328"><a href="#cb62-1328" aria-hidden="true" tabindex="-1"></a>.dt.tz_localize(<span class="st">'America/New_York'</span>, ambiguous<span class="op">=</span> <span class="st">'NaT'</span>)</span>
<span id="cb62-1329"><a href="#cb62-1329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1330"><a href="#cb62-1330" aria-hidden="true" tabindex="-1"></a><span class="co"># Localize the End date column to America/New_York</span></span>
<span id="cb62-1331"><a href="#cb62-1331" aria-hidden="true" tabindex="-1"></a>rides[<span class="st">'End date'</span>] <span class="op">=</span> rides[<span class="st">'End date'</span>]<span class="op">\</span></span>
<span id="cb62-1332"><a href="#cb62-1332" aria-hidden="true" tabindex="-1"></a>.dt.tz_localize(<span class="st">'America/New_York'</span>, ambiguous<span class="op">=</span> <span class="st">'NaT'</span>)</span>
<span id="cb62-1333"><a href="#cb62-1333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1334"><a href="#cb62-1334" aria-hidden="true" tabindex="-1"></a><span class="co"># Print first value</span></span>
<span id="cb62-1335"><a href="#cb62-1335" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rides[<span class="st">'Start date'</span>].iloc[<span class="dv">0</span>])</span>
<span id="cb62-1336"><a href="#cb62-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1337"><a href="#cb62-1337" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the Start date column to Europe/London</span></span>
<span id="cb62-1338"><a href="#cb62-1338" aria-hidden="true" tabindex="-1"></a>rides[<span class="st">'Start date'</span>] <span class="op">=</span> rides[<span class="st">'Start date'</span>].dt.tz_convert(<span class="st">'Europe/London'</span>)</span>
<span id="cb62-1339"><a href="#cb62-1339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1340"><a href="#cb62-1340" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the new value</span></span>
<span id="cb62-1341"><a href="#cb62-1341" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rides[<span class="st">'Start date'</span>].iloc[<span class="dv">0</span>])</span>
<span id="cb62-1342"><a href="#cb62-1342" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1343"><a href="#cb62-1343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1344"><a href="#cb62-1344" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 4.3.2</span></span>
<span id="cb62-1345"><a href="#cb62-1345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1346"><a href="#cb62-1346" aria-hidden="true" tabindex="-1"></a><span class="fu">### How long per weekday?</span></span>
<span id="cb62-1347"><a href="#cb62-1347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1348"><a href="#cb62-1348" aria-hidden="true" tabindex="-1"></a>Pandas has a number of datetime-related attributes within the <span class="in">`.dt`</span> accessor. Many of them are ones you've encountered before, like <span class="in">`.dt.month`</span>. Others are convenient and save time compared to standard Python, like <span class="in">`.dt.day_name()`</span>.</span>
<span id="cb62-1349"><a href="#cb62-1349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1350"><a href="#cb62-1350" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-1351"><a href="#cb62-1351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1352"><a href="#cb62-1352" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Add a new column to <span class="in">`rides`</span> called <span class="in">`'Ride start weekday'`</span>, which is the weekday of the <span class="in">`Start date`</span>.</span>
<span id="cb62-1353"><a href="#cb62-1353" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Print the median ride duration for each weekday.</span>
<span id="cb62-1354"><a href="#cb62-1354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1357"><a href="#cb62-1357" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-1358"><a href="#cb62-1358" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a column for the weekday of the start of the ride</span></span>
<span id="cb62-1359"><a href="#cb62-1359" aria-hidden="true" tabindex="-1"></a>rides[<span class="st">'Ride start weekday'</span>] <span class="op">=</span> rides[<span class="st">'Start date'</span>].dt.day_name()</span>
<span id="cb62-1360"><a href="#cb62-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1361"><a href="#cb62-1361" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the median trip time per weekday</span></span>
<span id="cb62-1362"><a href="#cb62-1362" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rides.groupby(<span class="st">'Ride start weekday'</span>)[<span class="st">'Duration'</span>].median())</span>
<span id="cb62-1363"><a href="#cb62-1363" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1364"><a href="#cb62-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1365"><a href="#cb62-1365" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise 4.3.3</span></span>
<span id="cb62-1366"><a href="#cb62-1366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1367"><a href="#cb62-1367" aria-hidden="true" tabindex="-1"></a><span class="fu">### How long between rides?</span></span>
<span id="cb62-1368"><a href="#cb62-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1369"><a href="#cb62-1369" aria-hidden="true" tabindex="-1"></a>For your final exercise, let's take advantage of Pandas indexing to do something interesting. How much time elapsed between rides?</span>
<span id="cb62-1370"><a href="#cb62-1370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1371"><a href="#cb62-1371" aria-hidden="true" tabindex="-1"></a><span class="fu">### Instructions</span></span>
<span id="cb62-1372"><a href="#cb62-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1373"><a href="#cb62-1373" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Calculate the difference in the <span class="in">`Start date`</span> of the current row and the <span class="in">`End date`</span> of the previous row and assign it to <span class="in">`rides['Time since']`</span>.</span>
<span id="cb62-1374"><a href="#cb62-1374" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Convert <span class="in">`rides['Time since']`</span> to seconds to make it easier to work with.</span>
<span id="cb62-1375"><a href="#cb62-1375" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Resample <span class="in">`rides`</span> to be in monthly buckets according to the <span class="in">`Start date`</span>.</span>
<span id="cb62-1376"><a href="#cb62-1376" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Divide the average by (60*60) to get the number of hours on average that W20529 waited in the dock before being picked up again.</span>
<span id="cb62-1377"><a href="#cb62-1377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1380"><a href="#cb62-1380" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb62-1381"><a href="#cb62-1381" aria-hidden="true" tabindex="-1"></a><span class="co"># Shift the index of the end date up one; now subract it from the start date</span></span>
<span id="cb62-1382"><a href="#cb62-1382" aria-hidden="true" tabindex="-1"></a>rides[<span class="st">'Time since'</span>] <span class="op">=</span> rides[<span class="st">'Start date'</span>] <span class="op">-</span> (rides[<span class="st">'End date'</span>].shift(<span class="dv">1</span>))</span>
<span id="cb62-1383"><a href="#cb62-1383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1384"><a href="#cb62-1384" aria-hidden="true" tabindex="-1"></a><span class="co"># Move from a timedelta to a number of seconds, which is easier to work with</span></span>
<span id="cb62-1385"><a href="#cb62-1385" aria-hidden="true" tabindex="-1"></a>rides[<span class="st">'Time since'</span>] <span class="op">=</span> rides[<span class="st">'Time since'</span>].dt.total_seconds()</span>
<span id="cb62-1386"><a href="#cb62-1386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1387"><a href="#cb62-1387" aria-hidden="true" tabindex="-1"></a><span class="co"># Resample to the month</span></span>
<span id="cb62-1388"><a href="#cb62-1388" aria-hidden="true" tabindex="-1"></a>monthly <span class="op">=</span> rides.resample(<span class="st">'M'</span>, on<span class="op">=</span><span class="st">'Start date'</span>)</span>
<span id="cb62-1389"><a href="#cb62-1389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1390"><a href="#cb62-1390" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the average hours between rides each month</span></span>
<span id="cb62-1391"><a href="#cb62-1391" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(monthly[<span class="st">'Time since'</span>].mean()<span class="op">/</span>(<span class="dv">60</span><span class="op">*</span><span class="dv">60</span>))</span>
<span id="cb62-1392"><a href="#cb62-1392" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1393"><a href="#cb62-1393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1394"><a href="#cb62-1394" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb62-1395"><a href="#cb62-1395" aria-hidden="true" tabindex="-1"></a>Note that by default, <span class="in">`.resample()`</span> labels Monthly resampling with the last day in the month and not the first. It certainly looks like the fraction of Casual riders went down as the number of rides dropped. With a little more digging, you could figure out if keeping Member rides only would be enough to stabilize the usage numbers throughout the fall.</span>
<span id="cb62-1396"><a href="#cb62-1396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1397"><a href="#cb62-1397" aria-hidden="true" tabindex="-1"></a>It looks like casual riders consistently took longer rides, but that both groups took shorter rides as the months went by. Note that, by combining grouping and resampling, you can answer a lot of questions about nearly any data set that includes time as a feature. Keep in mind that you can also group by more than one column at once.</span>
<span id="cb62-1398"><a href="#cb62-1398" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-1399"><a href="#cb62-1399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1400"><a href="#cb62-1400" aria-hidden="true" tabindex="-1"></a><span class="fu"># Explore Datasets</span></span>
<span id="cb62-1401"><a href="#cb62-1401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1402"><a href="#cb62-1402" aria-hidden="true" tabindex="-1"></a>Use the DataFrames imported in the first code cell to explore the data and practice your skills!</span>
<span id="cb62-1403"><a href="#cb62-1403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1404"><a href="#cb62-1404" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Count how many hurricanes made landfall each year in Florida using <span class="in">`florida_hurricane_dates`</span>.</span>
<span id="cb62-1405"><a href="#cb62-1405" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Reload the dataset <span class="in">`datasets/capital-onebike.csv`</span> so that it correctly parses date and time columns.</span>
<span id="cb62-1406"><a href="#cb62-1406" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Calculate the average trip duration of bike rentals on weekends in <span class="in">`rides`</span>. Compare it with the average trip duration of bike rentals on weekdays.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>